{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\@vssue\\api-gitlab-v4\\lib\\index.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\@vssue\\api-gitlab-v4\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkM6L1VzZXJzL0FkbWluaXN0cmF0b3IvRGVza3RvcC9xZC9ibG9nL3Z1ZXByZXNzLWJsb2ctZGVtby94Y3VpLWJsb2cvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3NsaWNlZFRvQXJyYXkiOwppbXBvcnQgX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIgZnJvbSAiQzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL3FkL2Jsb2cvdnVlcHJlc3MtYmxvZy1kZW1vL3hjdWktYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvcWQvYmxvZy92dWVwcmVzcy1ibG9nLWRlbW8veGN1aS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvcWQvYmxvZy92dWVwcmVzcy1ibG9nLWRlbW8veGN1aS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL3FkL2Jsb2cvdnVlcHJlc3MtYmxvZy1kZW1vL3hjdWktYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQuanMiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBidWlsZFF1ZXJ5LCBidWlsZFVSTCwgY29uY2F0VVJMLCBnZXRDbGVhblVSTCwgcGFyc2VRdWVyeSB9IGZyb20gJ0B2c3N1ZS91dGlscyc7CmltcG9ydCB7IG5vcm1hbGl6ZVVzZXIsIG5vcm1hbGl6ZUlzc3VlLCBub3JtYWxpemVDb21tZW50LCBub3JtYWxpemVSZWFjdGlvbnMsIG1hcFJlYWN0aW9uTmFtZSB9IGZyb20gJy4vdXRpbHMnOwovKioKICogR2l0TGFiIEFQSSBWNAogKgogKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS8KICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvb2F1dGgyLmh0bWwKICovCgp2YXIgR2l0bGFiVjQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEdpdGxhYlY0KF9yZWYpIHsKICAgIHZhciBfcmVmJGJhc2VVUkwgPSBfcmVmLmJhc2VVUkwsCiAgICAgICAgYmFzZVVSTCA9IF9yZWYkYmFzZVVSTCA9PT0gdm9pZCAwID8gJ2h0dHBzOi8vZ2l0bGFiLmNvbScgOiBfcmVmJGJhc2VVUkwsCiAgICAgICAgb3duZXIgPSBfcmVmLm93bmVyLAogICAgICAgIHJlcG8gPSBfcmVmLnJlcG8sCiAgICAgICAgbGFiZWxzID0gX3JlZi5sYWJlbHMsCiAgICAgICAgY2xpZW50SWQgPSBfcmVmLmNsaWVudElkLAogICAgICAgIHN0YXRlID0gX3JlZi5zdGF0ZTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2l0bGFiVjQpOwoKICAgIHRoaXMuYmFzZVVSTCA9IGJhc2VVUkw7CiAgICB0aGlzLm93bmVyID0gb3duZXI7CiAgICB0aGlzLnJlcG8gPSByZXBvOwogICAgdGhpcy5sYWJlbHMgPSBsYWJlbHM7CiAgICB0aGlzLmNsaWVudElkID0gY2xpZW50SWQ7CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7IC8vIEBzZWUgaHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vY2UvYXBpL1JFQURNRS5odG1sI25hbWVzcGFjZWQtcGF0aC1lbmNvZGluZwoKICAgIHRoaXMuX2VuY29kZWRSZXBvID0gZW5jb2RlVVJJQ29tcG9uZW50KCIiLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8pKTsKICAgIHRoaXMuJGh0dHAgPSBheGlvcy5jcmVhdGUoewogICAgICBiYXNlVVJMOiBjb25jYXRVUkwoYmFzZVVSTCwgJ2FwaS92NCcpLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicKICAgICAgfQogICAgfSk7CiAgfQogIC8qKgogICAqIFRoZSBwbGF0Zm9ybSBhcGkgaW5mbwogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEdpdGxhYlY0LCBbewogICAga2V5OiAicGxhdGZvcm0iLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogJ0dpdExhYicsCiAgICAgICAgbGluazogdGhpcy5iYXNlVVJMLAogICAgICAgIHZlcnNpb246ICd2NCcsCiAgICAgICAgbWV0YTogewogICAgICAgICAgcmVhY3RhYmxlOiB0cnVlLAogICAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFJlZGlyZWN0IHRvIHRoZSBhdXRob3JpemF0aW9uIHBhZ2Ugb2YgcGxhdGZvcm0uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvb2F1dGgyLmh0bWwjMS1yZXF1ZXN0aW5nLWF1dGhvcml6YXRpb24tY29kZQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlZGlyZWN0QXV0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVkaXJlY3RBdXRoKCkgewogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGJ1aWxkVVJMKGNvbmNhdFVSTCh0aGlzLmJhc2VVUkwsICdvYXV0aC9hdXRob3JpemUnKSwgewogICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICByZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICAgIHJlc3BvbnNlX3R5cGU6ICd0b2tlbicsCiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZSBhdXRob3JpemF0aW9uLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vY2UvYXBpL29hdXRoMi5odG1sI2ltcGxpY2l0LWdyYW50LWZsb3cKICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogSWYgdGhlIGBhY2Nlc3NfdG9rZW5gIGFuZCBgc3RhdGVgIGV4aXN0IGluIHRoZSBxdWVyeSwgYW5kIHRoZSBgc3RhdGVgIG1hdGNoZXMsIHJlbW92ZSB0aGVtIGZyb20gcXVlcnksIGFuZCByZXR1cm4gdGhlIGFjY2VzcyB0b2tlbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVBdXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaGFuZGxlQXV0aCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgaGFzaCwgYWNjZXNzVG9rZW4sIGhhc2hTdHJpbmcsIG5ld0hhc2gsIHJlcGxhY2VVUkw7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaGFzaCA9IHBhcnNlUXVlcnkod2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkpOwoKICAgICAgICAgICAgICAgIGlmICghKCFoYXNoLmFjY2Vzc190b2tlbiB8fCBoYXNoLnN0YXRlICE9PSB0aGlzLnN0YXRlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gaGFzaC5hY2Nlc3NfdG9rZW47CiAgICAgICAgICAgICAgICBkZWxldGUgaGFzaC5hY2Nlc3NfdG9rZW47CiAgICAgICAgICAgICAgICBkZWxldGUgaGFzaC50b2tlbl90eXBlOwogICAgICAgICAgICAgICAgZGVsZXRlIGhhc2guZXhwaXJlc19pbjsKICAgICAgICAgICAgICAgIGRlbGV0ZSBoYXNoLnN0YXRlOwogICAgICAgICAgICAgICAgaGFzaFN0cmluZyA9IGJ1aWxkUXVlcnkoaGFzaCk7CiAgICAgICAgICAgICAgICBuZXdIYXNoID0gaGFzaFN0cmluZyA/ICIjIi5jb25jYXQoaGFzaFN0cmluZykgOiAnJzsKICAgICAgICAgICAgICAgIHJlcGxhY2VVUkwgPSAiIi5jb25jYXQoZ2V0Q2xlYW5VUkwod2luZG93LmxvY2F0aW9uLmhyZWYpKS5jb25jYXQod2luZG93LmxvY2F0aW9uLnNlYXJjaCkuY29uY2F0KG5ld0hhc2gpOwogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICcnLCByZXBsYWNlVVJMKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGFjY2Vzc1Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBoYW5kbGVBdXRoKCkgewogICAgICAgIHJldHVybiBfaGFuZGxlQXV0aC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaGFuZGxlQXV0aDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxvZ2dlZC1pbiB1c2VyIHdpdGggYWNjZXNzIHRva2VuLgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFVzZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRVc2VyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihfcmVmMikgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMi5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLmdldCgndXNlcicsIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRnZXQuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVVc2VyKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0VXNlcihfeCkgewogICAgICAgIHJldHVybiBfZ2V0VXNlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0VXNlcjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgaXNzdWUgb2YgdGhpcyBwYWdlIGFjY29yZGluZyB0byB0aGUgaXNzdWUgaWQgb3IgdGhlIGlzc3VlIHRpdGxlCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvaXNzdWVzLmh0bWwjc2luZ2xlLWlzc3VlCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS9pc3N1ZXMuaHRtbCNsaXN0LWlzc3VlcwogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvUkVBRE1FLmh0bWwjcGFnaW5hdGlvbgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9yZWYzKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBpc3N1ZVRpdGxlLCBvcHRpb25zLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQyLCBkYXRhLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQzLCBfZGF0YSwgaXNzdWU7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYzLmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjMuaXNzdWVJZCwgaXNzdWVUaXRsZSA9IF9yZWYzLmlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghaXNzdWVJZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDMucHJldiA9IDQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInByb2plY3RzLyIuY29uY2F0KHRoaXMuX2VuY29kZWRSZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCksIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQyID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0Mi5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5wcmV2ID0gMTI7CiAgICAgICAgICAgICAgICBfY29udGV4dDMudDAgPSBfY29udGV4dDNbImNhdGNoIl0oNCk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQzLnQwLnJlc3BvbnNlICYmIF9jb250ZXh0My50MC5yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAxODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQzLnQwOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyODsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgIGxhYmVsczogdGhpcy5sYWJlbHMuam9pbignLCcpLAogICAgICAgICAgICAgICAgICBvcmRlcl9ieTogJ2NyZWF0ZWRfYXQnLAogICAgICAgICAgICAgICAgICBzb3J0OiAnYXNjJywKICAgICAgICAgICAgICAgICAgc2VhcmNoOiBpc3N1ZVRpdGxlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLmdldCgicHJvamVjdHMvIi5jb25jYXQodGhpcy5fZW5jb2RlZFJlcG8sICIvaXNzdWVzIiksIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0MyA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgX2RhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRnZXQzLmRhdGE7CiAgICAgICAgICAgICAgICBpc3N1ZSA9IF9kYXRhLm1hcChub3JtYWxpemVJc3N1ZSkuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50aXRsZSA9PT0gaXNzdWVUaXRsZTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIGlzc3VlIHx8IG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzLCBbWzQsIDEyXV0pOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRJc3N1ZShfeDIpIHsKICAgICAgICByZXR1cm4gX2dldElzc3VlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRJc3N1ZTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgaXNzdWUKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS9pc3N1ZXMuaHRtbCNuZXctaXNzdWUKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0SXNzdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWY0KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCB0aXRsZSwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNC5hY2Nlc3NUb2tlbiwgdGl0bGUgPSBfcmVmNC50aXRsZSwgY29udGVudCA9IF9yZWY0LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJwcm9qZWN0cy8iLmNvbmNhdCh0aGlzLl9lbmNvZGVkUmVwbywgIi9pc3N1ZXMiKSwgewogICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBjb250ZW50LAogICAgICAgICAgICAgICAgICBsYWJlbHM6IHRoaXMubGFiZWxzLmpvaW4oJywnKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogIkJlYXJlciAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvcyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvcy5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdElzc3VlKF94MykgewogICAgICAgIHJldHVybiBfcG9zdElzc3VlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IGNvbW1lbnRzIG9mIHRoaXMgcGFnZSBhY2NvcmRpbmcgdG8gdGhlIGlzc3VlIGlkCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvbm90ZXMuaHRtbCNsaXN0LXByb2plY3QtaXNzdWUtbm90ZXMKICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vY2UvYXBpL1JFQURNRS5odG1sI3BhZ2luYXRpb24KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogQ2Fubm90IGdldCB0aGUgSFRNTCBjb250ZW50IGFuZCB0aGUgcmVhY3Rpb25zIChhd2FyZF9lbW9qaSkgaGVyZS4KICAgICAqIFNvIGhhdmUgdG8gcmVxdWVzdCB0aGVtIHZpYSBgbWFya2Rvd25gIGFuZCBgYXdhcmRfZW1vamlgIEFQSS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb21tZW50cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldENvbW1lbnRzID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhfcmVmNSkgewogICAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgaXNzdWVJZCwgX3JlZjUkcXVlcnksIF9yZWY1JHF1ZXJ5JHBhZ2UsIHBhZ2UsIF9yZWY1JHF1ZXJ5JHBlclBhZ2UsIHBlclBhZ2UsIF9yZWY1JHF1ZXJ5JHNvcnQsIHNvcnQsIG9wdGlvbnMsIHJlc3BvbnNlLCBjb21tZW50c1JhdywgZ2V0Q29tbWVudHNNZXRhLCBfaXRlcmF0b3IsIF9zdGVwLCBfbG9vcDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjUuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNS5pc3N1ZUlkLCBfcmVmNSRxdWVyeSA9IF9yZWY1LnF1ZXJ5OwogICAgICAgICAgICAgICAgX3JlZjUkcXVlcnkgPSBfcmVmNSRxdWVyeSA9PT0gdm9pZCAwID8ge30gOiBfcmVmNSRxdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY1JHF1ZXJ5JHBhZ2UgPSBfcmVmNSRxdWVyeS5wYWdlLCBwYWdlID0gX3JlZjUkcXVlcnkkcGFnZSA9PT0gdm9pZCAwID8gMSA6IF9yZWY1JHF1ZXJ5JHBhZ2UsIF9yZWY1JHF1ZXJ5JHBlclBhZ2UgPSBfcmVmNSRxdWVyeS5wZXJQYWdlLCBwZXJQYWdlID0gX3JlZjUkcXVlcnkkcGVyUGFnZSA9PT0gdm9pZCAwID8gMTAgOiBfcmVmNSRxdWVyeSRwZXJQYWdlLCBfcmVmNSRxdWVyeSRzb3J0ID0gX3JlZjUkcXVlcnkuc29ydCwgc29ydCA9IF9yZWY1JHF1ZXJ5JHNvcnQgPT09IHZvaWQgMCA/ICdkZXNjJyA6IF9yZWY1JHF1ZXJ5JHNvcnQ7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyBwYWdpbmF0aW9uCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgICAgICAgICAgICBwZXJfcGFnZTogcGVyUGFnZSwKICAgICAgICAgICAgICAgICAgICBvcmRlcl9ieTogJ2NyZWF0ZWRfYXQnLAogICAgICAgICAgICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCJwcm9qZWN0cy8iLmNvbmNhdCh0aGlzLl9lbmNvZGVkUmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQsICIvbm90ZXMiKSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQ3LnNlbnQ7CiAgICAgICAgICAgICAgICBjb21tZW50c1JhdyA9IHJlc3BvbnNlLmRhdGE7IC8vIGdpdGxhYiBhcGkgdjQgc2hvdWxkIGdldCBwYXJzZWQgbWFya2Rvd24gY29udGVudCBhbmQgcmVhY3Rpb25zIGJ5IG90aGVyIGFwaQogICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBwb3RlbnRpYWxseSB0byBjYXVzZSA0MjkgVG9vIE1hbnkgUmVxdWVzdHMKCiAgICAgICAgICAgICAgICBnZXRDb21tZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgICAgIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKGNvbW1lbnRzUmF3KTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkgewogICAgICAgICAgICAgICAgICAgIHZhciBjb21tZW50ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgZ2V0Q29tbWVudHNNZXRhLnB1c2goX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLmdldE1hcmtkb3duQ29udGVudCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRSYXc6IGNvbW1lbnQuYm9keQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1lbnQuYm9keV9odG1sID0gX2NvbnRleHQ1LnNlbnQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgICAgICAgICAgICAgICAgfSkpKCkpOwogICAgICAgICAgICAgICAgICAgIGdldENvbW1lbnRzTWV0YS5wdXNoKF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRDb21tZW50UmVhY3Rpb25zKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNzdWVJZDogaXNzdWVJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnQuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50LnJlYWN0aW9ucyA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSwgX2NhbGxlZTYpOwogICAgICAgICAgICAgICAgICAgIH0pKSgpKTsKICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICAgICAgICAgICAgX2xvb3AoKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZ2V0Q29tbWVudHNNZXRhKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIGNvdW50OiBOdW1iZXIocmVzcG9uc2UuaGVhZGVyc1sneC10b3RhbCddKSwKICAgICAgICAgICAgICAgICAgcGFnZTogTnVtYmVyKHJlc3BvbnNlLmhlYWRlcnNbJ3gtcGFnZSddKSwKICAgICAgICAgICAgICAgICAgcGVyUGFnZTogTnVtYmVyKHJlc3BvbnNlLmhlYWRlcnNbJ3gtcGVyLXBhZ2UnXSksCiAgICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnRzUmF3Lm1hcChub3JtYWxpemVDb21tZW50KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50cyhfeDQpIHsKICAgICAgICByZXR1cm4gX2dldENvbW1lbnRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRDb21tZW50czsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmdpdGxhYi5jb20vY2UvYXBpL25vdGVzLmh0bWwjY3JlYXRlLW5ldy1pc3N1ZS1ub3RlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdENvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0Q29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoX3JlZjgpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHBvczIsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY4LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjguaXNzdWVJZCwgY29udGVudCA9IF9yZWY4LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJwcm9qZWN0cy8iLmNvbmNhdCh0aGlzLl9lbmNvZGVkUmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQsICIvbm90ZXMiKSwgewogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMiA9IF9jb250ZXh0OC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczIuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVDb21tZW50KGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnQoX3g1KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogRWRpdCBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS9ub3Rlcy5odG1sI21vZGlmeS1leGlzdGluZy1pc3N1ZS1ub3RlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicHV0Q29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3B1dENvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWY5KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb21tZW50SWQsIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHB1dCwgZGF0YSwgX3lpZWxkJFByb21pc2UkYWxsLCBfeWllbGQkUHJvbWlzZSRhbGwyLCBjb250ZW50SFRNTCwgcmVhY3Rpb25zOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOS5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWY5Lmlzc3VlSWQsIGNvbW1lbnRJZCA9IF9yZWY5LmNvbW1lbnRJZCwgY29udGVudCA9IF9yZWY5LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wdXQoInByb2plY3RzLyIuY29uY2F0KHRoaXMuX2VuY29kZWRSZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCwgIi9ub3Rlcy8iKS5jb25jYXQoY29tbWVudElkKSwgewogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcHV0ID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcHV0LmRhdGE7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0TWFya2Rvd25Db250ZW50KHsKICAgICAgICAgICAgICAgICAgYWNjZXNzVG9rZW46IGFjY2Vzc1Rva2VuLAogICAgICAgICAgICAgICAgICBjb250ZW50UmF3OiBkYXRhLmJvZHkKICAgICAgICAgICAgICAgIH0pLCB0aGlzLmdldENvbW1lbnRSZWFjdGlvbnMoewogICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW4sCiAgICAgICAgICAgICAgICAgIGlzc3VlSWQ6IGlzc3VlSWQsCiAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZDogZGF0YS5pZAogICAgICAgICAgICAgICAgfSldKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX3lpZWxkJFByb21pc2UkYWxsID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBfeWllbGQkUHJvbWlzZSRhbGwyID0gX3NsaWNlZFRvQXJyYXkoX3lpZWxkJFByb21pc2UkYWxsLCAyKTsKICAgICAgICAgICAgICAgIGNvbnRlbnRIVE1MID0gX3lpZWxkJFByb21pc2UkYWxsMlswXTsKICAgICAgICAgICAgICAgIHJlYWN0aW9ucyA9IF95aWVsZCRQcm9taXNlJGFsbDJbMV07CiAgICAgICAgICAgICAgICBkYXRhLmJvZHlfaHRtbCA9IGNvbnRlbnRIVE1MOwogICAgICAgICAgICAgICAgZGF0YS5yZWFjdGlvbnMgPSByZWFjdGlvbnM7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwdXRDb21tZW50KF94NikgewogICAgICAgIHJldHVybiBfcHV0Q29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcHV0Q29tbWVudDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBEZWxldGUgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvbm90ZXMuaHRtbCNkZWxldGUtYW4taXNzdWUtbm90ZQogICAgICovCgogIH0sIHsKICAgIGtleTogImRlbGV0ZUNvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9kZWxldGVDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoX3JlZjEwKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb21tZW50SWQsIF95aWVsZCR0aGlzJCRodHRwJGRlbCwgc3RhdHVzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjEwLmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjEwLmlzc3VlSWQsIGNvbW1lbnRJZCA9IF9yZWYxMC5jb21tZW50SWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHBbImRlbGV0ZSJdKCJwcm9qZWN0cy8iLmNvbmNhdCh0aGlzLl9lbmNvZGVkUmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQsICIvbm90ZXMvIikuY29uY2F0KGNvbW1lbnRJZCksIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRkZWwgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBzdGF0dXMgPSBfeWllbGQkdGhpcyQkaHR0cCRkZWwuc3RhdHVzOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBzdGF0dXMgPT09IDIwNCk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZGVsZXRlQ29tbWVudChfeDcpIHsKICAgICAgICByZXR1cm4gX2RlbGV0ZUNvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRlbGV0ZUNvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHJlYWN0aW9ucyBvZiBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS9hd2FyZF9lbW9qaS5odG1sI2xpc3QtYW4tYXdhcmRhYmxlcy1hd2FyZC1lbW9qaQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbW1lbnRSZWFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50UmVhY3Rpb25zID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoX3JlZjExKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb21tZW50SWQsIF95aWVsZCR0aGlzJCRodHRwJGdldDQsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMTEuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmMTEuaXNzdWVJZCwgY29tbWVudElkID0gX3JlZjExLmNvbW1lbnRJZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInByb2plY3RzLyIuY29uY2F0KHRoaXMuX2VuY29kZWRSZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCwgIi9ub3Rlcy8iKS5jb25jYXQoY29tbWVudElkLCAiL2F3YXJkX2Vtb2ppIiksIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQ0ID0gX2NvbnRleHQxMS5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJGdldDQuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplUmVhY3Rpb25zKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50UmVhY3Rpb25zKF94OCkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudFJlYWN0aW9ucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Q29tbWVudFJlYWN0aW9uczsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcmVhY3Rpb24gb2YgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RvY3MuZ2l0bGFiLmNvbS9jZS9hcGkvYXdhcmRfZW1vamkuaHRtbCNhd2FyZC1hLW5ldy1lbW9qaQogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RDb21tZW50UmVhY3Rpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0Q29tbWVudFJlYWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoX3JlZjEyKSB7CiAgICAgICAgdmFyIGlzc3VlSWQsIGNvbW1lbnRJZCwgcmVhY3Rpb24sIGFjY2Vzc1Rva2VuLCByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGlzc3VlSWQgPSBfcmVmMTIuaXNzdWVJZCwgY29tbWVudElkID0gX3JlZjEyLmNvbW1lbnRJZCwgcmVhY3Rpb24gPSBfcmVmMTIucmVhY3Rpb24sIGFjY2Vzc1Rva2VuID0gX3JlZjEyLmFjY2Vzc1Rva2VuOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMi5wcmV2ID0gMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJwcm9qZWN0cy8iLmNvbmNhdCh0aGlzLl9lbmNvZGVkUmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQsICIvbm90ZXMvIikuY29uY2F0KGNvbW1lbnRJZCwgIi9hd2FyZF9lbW9qaSIpLCB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IG1hcFJlYWN0aW9uTmFtZShyZWFjdGlvbikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJCZWFyZXIgIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTIuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDEpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLnByZXYgPSA4OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMi50MCA9IF9jb250ZXh0MTJbImNhdGNoIl0oMSk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQxMi50MC5yZXNwb25zZSAmJiBfY29udGV4dDEyLnQwLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAxNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCBmYWxzZSk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDEyLnQwOwoKICAgICAgICAgICAgICBjYXNlIDE1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIsIHRoaXMsIFtbMSwgOF1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnRSZWFjdGlvbihfeDkpIHsKICAgICAgICByZXR1cm4gX3Bvc3RDb21tZW50UmVhY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50UmVhY3Rpb247CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHRoZSBwYXJzZSBIVE1MIG9mIG1hcmtkb3duIGNvbnRlbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5naXRsYWIuY29tL2NlL2FwaS9tYXJrZG93bi5odG1sCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0TWFya2Rvd25Db250ZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0TWFya2Rvd25Db250ZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoX3JlZjEzKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb250ZW50UmF3LCBvcHRpb25zLCBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjEzLmFjY2Vzc1Rva2VuLCBjb250ZW50UmF3ID0gX3JlZjEzLmNvbnRlbnRSYXc7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiQmVhcmVyICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTMubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJtYXJrZG93biIsIHsKICAgICAgICAgICAgICAgICAgdGV4dDogY29udGVudFJhdywKICAgICAgICAgICAgICAgICAgZ2ZtOiB0cnVlCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMyA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIGRhdGEuaHRtbCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0TWFya2Rvd25Db250ZW50KF94MTApIHsKICAgICAgICByZXR1cm4gX2dldE1hcmtkb3duQ29udGVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0TWFya2Rvd25Db250ZW50OwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gR2l0bGFiVjQ7Cn0oKTsKCmV4cG9ydCB7IEdpdGxhYlY0IGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildQuery, buildURL, concatURL, getCleanURL, parseQuery, } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * GitLab API V4\n *\n * @see https://docs.gitlab.com/ce/api/\n * @see https://docs.gitlab.com/ce/api/oauth2.html\n */\nexport default class GitlabV4 {\n    constructor({ baseURL = 'https://gitlab.com', owner, repo, labels, clientId, state, }) {\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.state = state;\n        // @see https://docs.gitlab.com/ce/api/README.html#namespaced-path-encoding\n        this._encodedRepo = encodeURIComponent(`${this.owner}/${this.repo}`);\n        this.$http = axios.create({\n            baseURL: concatURL(baseURL, 'api/v4'),\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitLab',\n            link: this.baseURL,\n            version: 'v4',\n            meta: {\n                reactable: true,\n                sortable: true,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://docs.gitlab.com/ce/api/oauth2.html#1-requesting-authorization-code\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            response_type: 'token',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://docs.gitlab.com/ce/api/oauth2.html#implicit-grant-flow\n     *\n     * @remarks\n     * If the `access_token` and `state` exist in the query, and the `state` matches, remove them from query, and return the access token.\n     */\n    async handleAuth() {\n        const hash = parseQuery(window.location.hash.slice(1));\n        if (!hash.access_token || hash.state !== this.state) {\n            return null;\n        }\n        const accessToken = hash.access_token;\n        delete hash.access_token;\n        delete hash.token_type;\n        delete hash.expires_in;\n        delete hash.state;\n        const hashString = buildQuery(hash);\n        const newHash = hashString ? `#${hashString}` : '';\n        const replaceURL = `${getCleanURL(window.location.href)}${window.location.search}${newHash}`;\n        window.history.replaceState(null, '', replaceURL);\n        return accessToken;\n    }\n    /**\n     * Get the logged-in user with access token.\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.get('user', {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        return normalizeUser(data);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://docs.gitlab.com/ce/api/issues.html#single-issue\n     * @see https://docs.gitlab.com/ce/api/issues.html#list-issues\n     * @see https://docs.gitlab.com/ce/api/README.html#pagination\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `Bearer ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                const { data } = await this.$http.get(`projects/${this._encodedRepo}/issues/${issueId}`, options);\n                return normalizeIssue(data);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            options.params = {\n                labels: this.labels.join(','),\n                order_by: 'created_at',\n                sort: 'asc',\n                search: issueTitle,\n            };\n            const { data } = await this.$http.get(`projects/${this._encodedRepo}/issues`, options);\n            const issue = data\n                .map(normalizeIssue)\n                .find(item => item.title === issueTitle);\n            return issue || null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://docs.gitlab.com/ce/api/issues.html#new-issue\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`projects/${this._encodedRepo}/issues`, {\n            title,\n            description: content,\n            labels: this.labels.join(','),\n        }, {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://docs.gitlab.com/ce/api/notes.html#list-project-issue-notes\n     * @see https://docs.gitlab.com/ce/api/README.html#pagination\n     *\n     * @remarks\n     * Cannot get the HTML content and the reactions (award_emoji) here.\n     * So have to request them via `markdown` and `award_emoji` API.\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10, sort = 'desc' } = {}, }) {\n        const options = {\n            params: {\n                // pagination\n                page: page,\n                per_page: perPage,\n                order_by: 'created_at',\n                sort: sort,\n            },\n        };\n        if (accessToken) {\n            options.headers = {\n                Authorization: `Bearer ${accessToken}`,\n            };\n        }\n        const response = await this.$http.get(`projects/${this._encodedRepo}/issues/${issueId}/notes`, options);\n        const commentsRaw = response.data;\n        // gitlab api v4 should get parsed markdown content and reactions by other api\n        // this is potentially to cause 429 Too Many Requests\n        const getCommentsMeta = [];\n        for (const comment of commentsRaw) {\n            getCommentsMeta.push((async () => {\n                comment.body_html = await this.getMarkdownContent({\n                    accessToken: accessToken,\n                    contentRaw: comment.body,\n                });\n            })());\n            getCommentsMeta.push((async () => {\n                comment.reactions = await this.getCommentReactions({\n                    accessToken: accessToken,\n                    issueId: issueId,\n                    commentId: comment.id,\n                });\n            })());\n        }\n        await Promise.all(getCommentsMeta);\n        return {\n            count: Number(response.headers['x-total']),\n            page: Number(response.headers['x-page']),\n            perPage: Number(response.headers['x-per-page']),\n            data: commentsRaw.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://docs.gitlab.com/ce/api/notes.html#create-new-issue-note\n     */\n    async postComment({ accessToken, issueId, content, }) {\n        const { data } = await this.$http.post(`projects/${this._encodedRepo}/issues/${issueId}/notes`, {\n            body: content,\n        }, {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://docs.gitlab.com/ce/api/notes.html#modify-existing-issue-note\n     */\n    async putComment({ accessToken, issueId, commentId, content, }) {\n        const { data } = await this.$http.put(`projects/${this._encodedRepo}/issues/${issueId}/notes/${commentId}`, {\n            body: content,\n        }, {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        const [contentHTML, reactions] = await Promise.all([\n            this.getMarkdownContent({\n                accessToken: accessToken,\n                contentRaw: data.body,\n            }),\n            this.getCommentReactions({\n                accessToken: accessToken,\n                issueId: issueId,\n                commentId: data.id,\n            }),\n        ]);\n        data.body_html = contentHTML;\n        data.reactions = reactions;\n        return normalizeComment(data);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://docs.gitlab.com/ce/api/notes.html#delete-an-issue-note\n     */\n    async deleteComment({ accessToken, issueId, commentId, }) {\n        const { status } = await this.$http.delete(`projects/${this._encodedRepo}/issues/${issueId}/notes/${commentId}`, {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        return status === 204;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @see https://docs.gitlab.com/ce/api/award_emoji.html#list-an-awardables-award-emoji\n     */\n    async getCommentReactions({ accessToken, issueId, commentId, }) {\n        const { data } = await this.$http.get(`projects/${this._encodedRepo}/issues/${issueId}/notes/${commentId}/award_emoji`, {\n            headers: { Authorization: `Bearer ${accessToken}` },\n        });\n        return normalizeReactions(data);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://docs.gitlab.com/ce/api/award_emoji.html#award-a-new-emoji\n     */\n    async postCommentReaction({ issueId, commentId, reaction, accessToken, }) {\n        try {\n            const response = await this.$http.post(`projects/${this._encodedRepo}/issues/${issueId}/notes/${commentId}/award_emoji`, {\n                name: mapReactionName(reaction),\n            }, {\n                headers: {\n                    Authorization: `Bearer ${accessToken}`,\n                },\n            });\n            return response.status === 201;\n        }\n        catch (e) {\n            // it could be a bug of gitlab\n            // if a reaction (award emoji) has already existed, it returns a 404 response with a buggy message\n            // have submitted an issue: https://gitlab.com/gitlab-org/gitlab-ce/issues/56147\n            /* istanbul ignore next */\n            if (e.response && e.response.status === 404) {\n                return false;\n            }\n            else {\n                throw e;\n            }\n        }\n    }\n    /**\n     * Get the parse HTML of markdown content\n     *\n     * @see https://docs.gitlab.com/ce/api/markdown.html\n     */\n    async getMarkdownContent({ accessToken, contentRaw, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `Bearer ${accessToken}`,\n            };\n        }\n        const { data } = await this.$http.post(`markdown`, {\n            text: contentRaw,\n            gfm: true,\n        }, options);\n        return data.html;\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}