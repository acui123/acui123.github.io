{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\vue-i18n\\dist\\vue-i18n.esm.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\vue-i18n\\dist\\vue-i18n.esm.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiQzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL3FkL2Jsb2cvdnVlcHJlc3MtYmxvZy1kZW1vL3hjdWktYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaXMtYXJyYXkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5kZXgtb2YuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5ldmVyeS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuY3JlYXRlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucGFyc2UtaW50LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJldmVyc2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMuanMiOwoKLyohCiAqIHZ1ZS1pMThuIHY4LjIyLjQgCiAqIChjKSAyMDIxIGthenV5YSBrYXdhZ3VjaGkKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KCi8qICAqLwoKLyoqCiAqIGNvbnN0YW50cwogKi8KdmFyIG51bWJlckZvcm1hdEtleXMgPSBbJ2NvbXBhY3REaXNwbGF5JywgJ2N1cnJlbmN5JywgJ2N1cnJlbmN5RGlzcGxheScsICdjdXJyZW5jeVNpZ24nLCAnbG9jYWxlTWF0Y2hlcicsICdub3RhdGlvbicsICdudW1iZXJpbmdTeXN0ZW0nLCAnc2lnbkRpc3BsYXknLCAnc3R5bGUnLCAndW5pdCcsICd1bml0RGlzcGxheScsICd1c2VHcm91cGluZycsICdtaW5pbXVtSW50ZWdlckRpZ2l0cycsICdtaW5pbXVtRnJhY3Rpb25EaWdpdHMnLCAnbWF4aW11bUZyYWN0aW9uRGlnaXRzJywgJ21pbmltdW1TaWduaWZpY2FudERpZ2l0cycsICdtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHMnXTsKLyoqCiAqIHV0aWxpdGllcwogKi8KCmZ1bmN0aW9uIHdhcm4obXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLndhcm4oJ1t2dWUtaTE4bl0gJyArIG1zZyk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICBpZiAoZXJyKSB7CiAgICAgIGNvbnNvbGUud2FybihlcnIuc3RhY2spOwogICAgfQogIH0KfQoKZnVuY3Rpb24gZXJyb3IobXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLmVycm9yKCdbdnVlLWkxOG5dICcgKyBtc2cpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgaWYgKGVycikgewogICAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7CiAgICB9CiAgfQp9Cgp2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgpmdW5jdGlvbiBpc09iamVjdChvYmopIHsKICByZXR1cm4gb2JqICE9PSBudWxsICYmIF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCc7Cn0KCmZ1bmN0aW9uIGlzQm9vbGVhbih2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ2Jvb2xlYW4nOwp9CgpmdW5jdGlvbiBpc1N0cmluZyh2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ3N0cmluZyc7Cn0KCnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CnZhciBPQkpFQ1RfU1RSSU5HID0gJ1tvYmplY3QgT2JqZWN0XSc7CgpmdW5jdGlvbiBpc1BsYWluT2JqZWN0KG9iaikgewogIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT09IE9CSkVDVF9TVFJJTkc7Cn0KCmZ1bmN0aW9uIGlzTnVsbCh2YWwpIHsKICByZXR1cm4gdmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkOwp9CgpmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbCkgewogIHJldHVybiB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nOwp9CgpmdW5jdGlvbiBwYXJzZUFyZ3MoKSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgd2hpbGUgKGxlbi0tKSB7CiAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICB9CgogIHZhciBsb2NhbGUgPSBudWxsOwogIHZhciBwYXJhbXMgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc09iamVjdChhcmdzWzBdKSB8fCBpc0FycmF5KGFyZ3NbMF0pKSB7CiAgICAgIHBhcmFtcyA9IGFyZ3NbMF07CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgewogICAgICBsb2NhbGUgPSBhcmdzWzBdOwogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHsKICAgICAgbG9jYWxlID0gYXJnc1swXTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoaXNPYmplY3QoYXJnc1sxXSkgfHwgaXNBcnJheShhcmdzWzFdKSkgewogICAgICBwYXJhbXMgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgcGFyYW1zOiBwYXJhbXMKICB9Owp9CgpmdW5jdGlvbiBsb29zZUNsb25lKG9iaikgewogIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwp9CgpmdW5jdGlvbiByZW1vdmUoYXJyLCBpdGVtKSB7CiAgaWYgKGFyci5sZW5ndGgpIHsKICAgIHZhciBpbmRleCA9IGFyci5pbmRleE9mKGl0ZW0pOwoKICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgIHJldHVybiBhcnIuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGluY2x1ZGVzKGFyciwgaXRlbSkgewogIHJldHVybiAhIX5hcnIuaW5kZXhPZihpdGVtKTsKfQoKdmFyIGhhc093blByb3BlcnR5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKCmZ1bmN0aW9uIGhhc093bihvYmosIGtleSkgewogIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKfQoKZnVuY3Rpb24gbWVyZ2UodGFyZ2V0KSB7CiAgdmFyIGFyZ3VtZW50cyQxID0gYXJndW1lbnRzOwogIHZhciBvdXRwdXQgPSBPYmplY3QodGFyZ2V0KTsKCiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHMkMVtpXTsKCiAgICBpZiAoc291cmNlICE9PSB1bmRlZmluZWQgJiYgc291cmNlICE9PSBudWxsKSB7CiAgICAgIHZhciBrZXkgPSB2b2lkIDA7CgogICAgICBmb3IgKGtleSBpbiBzb3VyY2UpIHsKICAgICAgICBpZiAoaGFzT3duKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgaWYgKGlzT2JqZWN0KHNvdXJjZVtrZXldKSkgewogICAgICAgICAgICBvdXRwdXRba2V5XSA9IG1lcmdlKG91dHB1dFtrZXldLCBzb3VyY2Vba2V5XSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvdXRwdXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIG91dHB1dDsKfQoKZnVuY3Rpb24gbG9vc2VFcXVhbChhLCBiKSB7CiAgaWYgKGEgPT09IGIpIHsKICAgIHJldHVybiB0cnVlOwogIH0KCiAgdmFyIGlzT2JqZWN0QSA9IGlzT2JqZWN0KGEpOwogIHZhciBpc09iamVjdEIgPSBpc09iamVjdChiKTsKCiAgaWYgKGlzT2JqZWN0QSAmJiBpc09iamVjdEIpIHsKICAgIHRyeSB7CiAgICAgIHZhciBpc0FycmF5QSA9IGlzQXJyYXkoYSk7CiAgICAgIHZhciBpc0FycmF5QiA9IGlzQXJyYXkoYik7CgogICAgICBpZiAoaXNBcnJheUEgJiYgaXNBcnJheUIpIHsKICAgICAgICByZXR1cm4gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuZXZlcnkoZnVuY3Rpb24gKGUsIGkpIHsKICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGUsIGJbaV0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKCFpc0FycmF5QSAmJiAhaXNBcnJheUIpIHsKICAgICAgICB2YXIga2V5c0EgPSBPYmplY3Qua2V5cyhhKTsKICAgICAgICB2YXIga2V5c0IgPSBPYmplY3Qua2V5cyhiKTsKICAgICAgICByZXR1cm4ga2V5c0EubGVuZ3RoID09PSBrZXlzQi5sZW5ndGggJiYga2V5c0EuZXZlcnkoZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgcmV0dXJuIGxvb3NlRXF1YWwoYVtrZXldLCBiW2tleV0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9IGVsc2UgaWYgKCFpc09iamVjdEEgJiYgIWlzT2JqZWN0QikgewogICAgcmV0dXJuIFN0cmluZyhhKSA9PT0gU3RyaW5nKGIpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9Ci8qKgogKiBTYW5pdGl6ZXMgaHRtbCBzcGVjaWFsIGNoYXJhY3RlcnMgZnJvbSBpbnB1dCBzdHJpbmdzLiBGb3IgbWl0aWdhdGluZyByaXNrIG9mIFhTUyBhdHRhY2tzLgogKiBAcGFyYW0gcmF3VGV4dCBUaGUgcmF3IGlucHV0IGZyb20gdGhlIHVzZXIgdGhhdCBzaG91bGQgYmUgZXNjYXBlZC4KICovCgoKZnVuY3Rpb24gZXNjYXBlSHRtbChyYXdUZXh0KSB7CiAgcmV0dXJuIHJhd1RleHQucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKS5yZXBsYWNlKC8iL2csICcmcXVvdDsnKS5yZXBsYWNlKC8nL2csICcmYXBvczsnKTsKfQovKioKICogRXNjYXBlcyBodG1sIHRhZ3MgYW5kIHNwZWNpYWwgc3ltYm9scyBmcm9tIGFsbCBwcm92aWRlZCBwYXJhbXMgd2hpY2ggd2VyZSByZXR1cm5lZCBmcm9tIHBhcnNlQXJncygpLnBhcmFtcy4KICogVGhpcyBtZXRob2QgcGVyZm9ybXMgYW4gaW4tcGxhY2Ugb3BlcmF0aW9uIG9uIHRoZSBwYXJhbXMgb2JqZWN0LgogKgogKiBAcGFyYW0ge2FueX0gcGFyYW1zIFBhcmFtZXRlcnMgYXMgcHJvdmlkZWQgZnJvbSBgcGFyc2VBcmdzKCkucGFyYW1zYC4KICogICAgICAgICAgICAgICAgICAgICBNYXkgYmUgZWl0aGVyIGFuIGFycmF5IG9mIHN0cmluZ3Mgb3IgYSBzdHJpbmctPmFueSBtYXAuCiAqCiAqIEByZXR1cm5zIFRoZSBtYW5pcHVsYXRlZCBgcGFyYW1zYCBvYmplY3QuCiAqLwoKCmZ1bmN0aW9uIGVzY2FwZVBhcmFtcyhwYXJhbXMpIHsKICBpZiAocGFyYW1zICE9IG51bGwpIHsKICAgIE9iamVjdC5rZXlzKHBhcmFtcykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIGlmICh0eXBlb2YgcGFyYW1zW2tleV0gPT0gJ3N0cmluZycpIHsKICAgICAgICBwYXJhbXNba2V5XSA9IGVzY2FwZUh0bWwocGFyYW1zW2tleV0pOwogICAgICB9CiAgICB9KTsKICB9CgogIHJldHVybiBwYXJhbXM7Cn0KLyogICovCgoKZnVuY3Rpb24gZXh0ZW5kKFZ1ZSkgewogIGlmICghVnVlLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSgnJGkxOG4nKSkgewogICAgLy8gJEZsb3dGaXhNZQogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckaTE4bicsIHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuX2kxOG47CiAgICAgIH0KICAgIH0pOwogIH0KCiAgVnVlLnByb3RvdHlwZS4kdCA9IGZ1bmN0aW9uIChrZXkpIHsKICAgIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogICAgfQoKICAgIHZhciBpMThuID0gdGhpcy4kaTE4bjsKICAgIHJldHVybiBpMThuLl90LmFwcGx5KGkxOG4sIFtrZXksIGkxOG4ubG9jYWxlLCBpMThuLl9nZXRNZXNzYWdlcygpLCB0aGlzXS5jb25jYXQodmFsdWVzKSk7CiAgfTsKCiAgVnVlLnByb3RvdHlwZS4kdGMgPSBmdW5jdGlvbiAoa2V5LCBjaG9pY2UpIHsKICAgIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMjsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDJdOwogICAgfQoKICAgIHZhciBpMThuID0gdGhpcy4kaTE4bjsKICAgIHJldHVybiBpMThuLl90Yy5hcHBseShpMThuLCBba2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgdGhpcywgY2hvaWNlXS5jb25jYXQodmFsdWVzKSk7CiAgfTsKCiAgVnVlLnByb3RvdHlwZS4kdGUgPSBmdW5jdGlvbiAoa2V5LCBsb2NhbGUpIHsKICAgIHZhciBpMThuID0gdGhpcy4kaTE4bjsKICAgIHJldHVybiBpMThuLl90ZShrZXksIGkxOG4ubG9jYWxlLCBpMThuLl9nZXRNZXNzYWdlcygpLCBsb2NhbGUpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJGQgPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhciByZWY7CiAgICB2YXIgYXJncyA9IFtdLAogICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICAgIHdoaWxlIChsZW4tLSA+IDApIHsKICAgICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogICAgfQoKICAgIHJldHVybiAocmVmID0gdGhpcy4kaTE4bikuZC5hcHBseShyZWYsIFt2YWx1ZV0uY29uY2F0KGFyZ3MpKTsKICB9OwoKICBWdWUucHJvdG90eXBlLiRuID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICB2YXIgcmVmOwogICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICAgIH0KCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuJGkxOG4pLm4uYXBwbHkocmVmLCBbdmFsdWVdLmNvbmNhdChhcmdzKSk7CiAgfTsKfQovKiAgKi8KCgp2YXIgbWl4aW4gPSB7CiAgYmVmb3JlQ3JlYXRlOiBmdW5jdGlvbiBiZWZvcmVDcmVhdGUoKSB7CiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuJG9wdGlvbnM7CiAgICBvcHRpb25zLmkxOG4gPSBvcHRpb25zLmkxOG4gfHwgKG9wdGlvbnMuX19pMThuID8ge30gOiBudWxsKTsKCiAgICBpZiAob3B0aW9ucy5pMThuKSB7CiAgICAgIGlmIChvcHRpb25zLmkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgICAgLy8gaW5pdCBsb2NhbGUgbWVzc2FnZXMgdmlhIGN1c3RvbSBibG9ja3MKICAgICAgICBpZiAob3B0aW9ucy5fX2kxOG4pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBsb2NhbGVNZXNzYWdlcyA9IG9wdGlvbnMuaTE4biAmJiBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPyBvcHRpb25zLmkxOG4ubWVzc2FnZXMgOiB7fTsKCiAgICAgICAgICAgIG9wdGlvbnMuX19pMThuLmZvckVhY2goZnVuY3Rpb24gKHJlc291cmNlKSB7CiAgICAgICAgICAgICAgbG9jYWxlTWVzc2FnZXMgPSBtZXJnZShsb2NhbGVNZXNzYWdlcywgSlNPTi5wYXJzZShyZXNvdXJjZSkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIE9iamVjdC5rZXlzKGxvY2FsZU1lc3NhZ2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgICAgICAgICBvcHRpb25zLmkxOG4ubWVyZ2VMb2NhbGVNZXNzYWdlKGxvY2FsZSwgbG9jYWxlTWVzc2FnZXNbbG9jYWxlXSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgIGVycm9yKCJDYW5ub3QgcGFyc2UgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzLiIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9pMThuID0gb3B0aW9ucy5pMThuOwogICAgICAgIHRoaXMuX2kxOG5XYXRjaGVyID0gdGhpcy5faTE4bi53YXRjaEkxOG5EYXRhKCk7CiAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChvcHRpb25zLmkxOG4pKSB7CiAgICAgICAgdmFyIHJvb3RJMThuID0gdGhpcy4kcm9vdCAmJiB0aGlzLiRyb290LiRpMThuICYmIHRoaXMuJHJvb3QuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuID8gdGhpcy4kcm9vdC4kaTE4biA6IG51bGw7IC8vIGNvbXBvbmVudCBsb2NhbCBpMThuCgogICAgICAgIGlmIChyb290STE4bikgewogICAgICAgICAgb3B0aW9ucy5pMThuLnJvb3QgPSB0aGlzLiRyb290OwogICAgICAgICAgb3B0aW9ucy5pMThuLmZvcm1hdHRlciA9IHJvb3RJMThuLmZvcm1hdHRlcjsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5mYWxsYmFja0xvY2FsZSA9IHJvb3RJMThuLmZhbGxiYWNrTG9jYWxlOwogICAgICAgICAgb3B0aW9ucy5pMThuLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMgPSByb290STE4bi5mb3JtYXRGYWxsYmFja01lc3NhZ2VzOwogICAgICAgICAgb3B0aW9ucy5pMThuLnNpbGVudFRyYW5zbGF0aW9uV2FybiA9IHJvb3RJMThuLnNpbGVudFRyYW5zbGF0aW9uV2FybjsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5zaWxlbnRGYWxsYmFja1dhcm4gPSByb290STE4bi5zaWxlbnRGYWxsYmFja1dhcm47CiAgICAgICAgICBvcHRpb25zLmkxOG4ucGx1cmFsaXphdGlvblJ1bGVzID0gcm9vdEkxOG4ucGx1cmFsaXphdGlvblJ1bGVzOwogICAgICAgICAgb3B0aW9ucy5pMThuLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9IHJvb3RJMThuLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudDsKICAgICAgICB9IC8vIGluaXQgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzCgoKICAgICAgICBpZiAob3B0aW9ucy5fX2kxOG4pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZhciBsb2NhbGVNZXNzYWdlcyQxID0gb3B0aW9ucy5pMThuICYmIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA/IG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA6IHt9OwoKICAgICAgICAgICAgb3B0aW9ucy5fX2kxOG4uZm9yRWFjaChmdW5jdGlvbiAocmVzb3VyY2UpIHsKICAgICAgICAgICAgICBsb2NhbGVNZXNzYWdlcyQxID0gbWVyZ2UobG9jYWxlTWVzc2FnZXMkMSwgSlNPTi5wYXJzZShyZXNvdXJjZSkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA9IGxvY2FsZU1lc3NhZ2VzJDE7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICAgICAgd2FybigiQ2Fubm90IHBhcnNlIGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2Nrcy4iLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIHJlZiA9IG9wdGlvbnMuaTE4bjsKICAgICAgICB2YXIgc2hhcmVkTWVzc2FnZXMgPSByZWYuc2hhcmVkTWVzc2FnZXM7CgogICAgICAgIGlmIChzaGFyZWRNZXNzYWdlcyAmJiBpc1BsYWluT2JqZWN0KHNoYXJlZE1lc3NhZ2VzKSkgewogICAgICAgICAgb3B0aW9ucy5pMThuLm1lc3NhZ2VzID0gbWVyZ2Uob3B0aW9ucy5pMThuLm1lc3NhZ2VzLCBzaGFyZWRNZXNzYWdlcyk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLl9pMThuID0gbmV3IFZ1ZUkxOG4ob3B0aW9ucy5pMThuKTsKICAgICAgICB0aGlzLl9pMThuV2F0Y2hlciA9IHRoaXMuX2kxOG4ud2F0Y2hJMThuRGF0YSgpOwoKICAgICAgICBpZiAob3B0aW9ucy5pMThuLnN5bmMgPT09IHVuZGVmaW5lZCB8fCAhIW9wdGlvbnMuaTE4bi5zeW5jKSB7CiAgICAgICAgICB0aGlzLl9sb2NhbGVXYXRjaGVyID0gdGhpcy4kaTE4bi53YXRjaExvY2FsZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJvb3RJMThuKSB7CiAgICAgICAgICByb290STE4bi5vbkNvbXBvbmVudEluc3RhbmNlQ3JlYXRlZCh0aGlzLl9pMThuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIHdhcm4oIkNhbm5vdCBiZSBpbnRlcnByZXRlZCAnaTE4bicgb3B0aW9uLiIpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICh0aGlzLiRyb290ICYmIHRoaXMuJHJvb3QuJGkxOG4gJiYgdGhpcy4kcm9vdC4kaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgLy8gcm9vdCBpMThuCiAgICAgIHRoaXMuX2kxOG4gPSB0aGlzLiRyb290LiRpMThuOwogICAgfSBlbHNlIGlmIChvcHRpb25zLnBhcmVudCAmJiBvcHRpb25zLnBhcmVudC4kaTE4biAmJiBvcHRpb25zLnBhcmVudC4kaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgLy8gcGFyZW50IGkxOG4KICAgICAgdGhpcy5faTE4biA9IG9wdGlvbnMucGFyZW50LiRpMThuOwogICAgfQogIH0sCiAgYmVmb3JlTW91bnQ6IGZ1bmN0aW9uIGJlZm9yZU1vdW50KCkgewogICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOwogICAgb3B0aW9ucy5pMThuID0gb3B0aW9ucy5pMThuIHx8IChvcHRpb25zLl9faTE4biA/IHt9IDogbnVsbCk7CgogICAgaWYgKG9wdGlvbnMuaTE4bikgewogICAgICBpZiAob3B0aW9ucy5pMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICAgIC8vIGluaXQgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzCiAgICAgICAgdGhpcy5faTE4bi5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodGhpcyk7CgogICAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KG9wdGlvbnMuaTE4bikpIHsKICAgICAgICB0aGlzLl9pMThuLnN1YnNjcmliZURhdGFDaGFuZ2luZyh0aGlzKTsKCiAgICAgICAgdGhpcy5fc3Vic2NyaWJpbmcgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJDYW5ub3QgYmUgaW50ZXJwcmV0ZWQgJ2kxOG4nIG9wdGlvbi4iKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodGhpcy4kcm9vdCAmJiB0aGlzLiRyb290LiRpMThuICYmIHRoaXMuJHJvb3QuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgdGhpcy5fc3Vic2NyaWJpbmcgPSB0cnVlOwogICAgfSBlbHNlIGlmIChvcHRpb25zLnBhcmVudCAmJiBvcHRpb25zLnBhcmVudC4kaTE4biAmJiBvcHRpb25zLnBhcmVudC4kaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgdGhpcy5faTE4bi5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodGhpcyk7CgogICAgICB0aGlzLl9zdWJzY3JpYmluZyA9IHRydWU7CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgaWYgKCF0aGlzLl9pMThuKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzZWxmLl9zdWJzY3JpYmluZykgewogICAgICAgIHNlbGYuX2kxOG4udW5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcoc2VsZik7CgogICAgICAgIGRlbGV0ZSBzZWxmLl9zdWJzY3JpYmluZzsKICAgICAgfQoKICAgICAgaWYgKHNlbGYuX2kxOG5XYXRjaGVyKSB7CiAgICAgICAgc2VsZi5faTE4bldhdGNoZXIoKTsKCiAgICAgICAgc2VsZi5faTE4bi5kZXN0cm95Vk0oKTsKCiAgICAgICAgZGVsZXRlIHNlbGYuX2kxOG5XYXRjaGVyOwogICAgICB9CgogICAgICBpZiAoc2VsZi5fbG9jYWxlV2F0Y2hlcikgewogICAgICAgIHNlbGYuX2xvY2FsZVdhdGNoZXIoKTsKCiAgICAgICAgZGVsZXRlIHNlbGYuX2xvY2FsZVdhdGNoZXI7CiAgICAgIH0KICAgIH0pOwogIH0KfTsKLyogICovCgp2YXIgaW50ZXJwb2xhdGlvbkNvbXBvbmVudCA9IHsKICBuYW1lOiAnaTE4bicsCiAgZnVuY3Rpb25hbDogdHJ1ZSwKICBwcm9wczogewogICAgdGFnOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEJvb2xlYW4sIE9iamVjdF0sCiAgICAgICJkZWZhdWx0IjogJ3NwYW4nCiAgICB9LAogICAgcGF0aDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgbG9jYWxlOiB7CiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIHBsYWNlczogewogICAgICB0eXBlOiBbQXJyYXksIE9iamVjdF0KICAgIH0KICB9LAogIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGgsIHJlZikgewogICAgdmFyIGRhdGEgPSByZWYuZGF0YTsKICAgIHZhciBwYXJlbnQgPSByZWYucGFyZW50OwogICAgdmFyIHByb3BzID0gcmVmLnByb3BzOwogICAgdmFyIHNsb3RzID0gcmVmLnNsb3RzOwogICAgdmFyICRpMThuID0gcGFyZW50LiRpMThuOwoKICAgIGlmICghJGkxOG4pIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCdDYW5ub3QgZmluZCBWdWVJMThuIGluc3RhbmNlIScpOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHBhdGggPSBwcm9wcy5wYXRoOwogICAgdmFyIGxvY2FsZSA9IHByb3BzLmxvY2FsZTsKICAgIHZhciBwbGFjZXMgPSBwcm9wcy5wbGFjZXM7CiAgICB2YXIgcGFyYW1zID0gc2xvdHMoKTsKICAgIHZhciBjaGlsZHJlbiA9ICRpMThuLmkocGF0aCwgbG9jYWxlLCBvbmx5SGFzRGVmYXVsdFBsYWNlKHBhcmFtcykgfHwgcGxhY2VzID8gdXNlTGVnYWN5UGxhY2VzKHBhcmFtc1siZGVmYXVsdCJdLCBwbGFjZXMpIDogcGFyYW1zKTsKICAgIHZhciB0YWcgPSAhIXByb3BzLnRhZyAmJiBwcm9wcy50YWcgIT09IHRydWUgfHwgcHJvcHMudGFnID09PSBmYWxzZSA/IHByb3BzLnRhZyA6ICdzcGFuJzsKICAgIHJldHVybiB0YWcgPyBoKHRhZywgZGF0YSwgY2hpbGRyZW4pIDogY2hpbGRyZW47CiAgfQp9OwoKZnVuY3Rpb24gb25seUhhc0RlZmF1bHRQbGFjZShwYXJhbXMpIHsKICB2YXIgcHJvcDsKCiAgZm9yIChwcm9wIGluIHBhcmFtcykgewogICAgaWYgKHByb3AgIT09ICdkZWZhdWx0JykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICByZXR1cm4gQm9vbGVhbihwcm9wKTsKfQoKZnVuY3Rpb24gdXNlTGVnYWN5UGxhY2VzKGNoaWxkcmVuLCBwbGFjZXMpIHsKICB2YXIgcGFyYW1zID0gcGxhY2VzID8gY3JlYXRlUGFyYW1zRnJvbVBsYWNlcyhwbGFjZXMpIDoge307CgogIGlmICghY2hpbGRyZW4pIHsKICAgIHJldHVybiBwYXJhbXM7CiAgfSAvLyBGaWx0ZXIgZW1wdHkgdGV4dCBub2RlcwoKCiAgY2hpbGRyZW4gPSBjaGlsZHJlbi5maWx0ZXIoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICByZXR1cm4gY2hpbGQudGFnIHx8IGNoaWxkLnRleHQudHJpbSgpICE9PSAnJzsKICB9KTsKICB2YXIgZXZlcnlQbGFjZSA9IGNoaWxkcmVuLmV2ZXJ5KHZub2RlSGFzUGxhY2VBdHRyaWJ1dGUpOwoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBldmVyeVBsYWNlKSB7CiAgICB3YXJuKCdgcGxhY2VgIGF0dHJpYnV0ZSBpcyBkZXByZWNhdGVkIGluIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHN3aXRjaCB0byBWdWUgc2xvdHMuJyk7CiAgfQoKICByZXR1cm4gY2hpbGRyZW4ucmVkdWNlKGV2ZXJ5UGxhY2UgPyBhc3NpZ25DaGlsZFBsYWNlIDogYXNzaWduQ2hpbGRJbmRleCwgcGFyYW1zKTsKfQoKZnVuY3Rpb24gY3JlYXRlUGFyYW1zRnJvbVBsYWNlcyhwbGFjZXMpIHsKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgd2FybignYHBsYWNlc2AgcHJvcCBpcyBkZXByZWNhdGVkIGluIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHN3aXRjaCB0byBWdWUgc2xvdHMuJyk7CiAgfQoKICByZXR1cm4gQXJyYXkuaXNBcnJheShwbGFjZXMpID8gcGxhY2VzLnJlZHVjZShhc3NpZ25DaGlsZEluZGV4LCB7fSkgOiBPYmplY3QuYXNzaWduKHt9LCBwbGFjZXMpOwp9CgpmdW5jdGlvbiBhc3NpZ25DaGlsZFBsYWNlKHBhcmFtcywgY2hpbGQpIHsKICBpZiAoY2hpbGQuZGF0YSAmJiBjaGlsZC5kYXRhLmF0dHJzICYmIGNoaWxkLmRhdGEuYXR0cnMucGxhY2UpIHsKICAgIHBhcmFtc1tjaGlsZC5kYXRhLmF0dHJzLnBsYWNlXSA9IGNoaWxkOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQoKZnVuY3Rpb24gYXNzaWduQ2hpbGRJbmRleChwYXJhbXMsIGNoaWxkLCBpbmRleCkgewogIHBhcmFtc1tpbmRleF0gPSBjaGlsZDsKICByZXR1cm4gcGFyYW1zOwp9CgpmdW5jdGlvbiB2bm9kZUhhc1BsYWNlQXR0cmlidXRlKHZub2RlKSB7CiAgcmV0dXJuIEJvb2xlYW4odm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLmF0dHJzICYmIHZub2RlLmRhdGEuYXR0cnMucGxhY2UpOwp9Ci8qICAqLwoKCnZhciBudW1iZXJDb21wb25lbnQgPSB7CiAgbmFtZTogJ2kxOG4tbicsCiAgZnVuY3Rpb25hbDogdHJ1ZSwKICBwcm9wczogewogICAgdGFnOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEJvb2xlYW4sIE9iamVjdF0sCiAgICAgICJkZWZhdWx0IjogJ3NwYW4nCiAgICB9LAogICAgdmFsdWU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGZvcm1hdDogewogICAgICB0eXBlOiBbU3RyaW5nLCBPYmplY3RdCiAgICB9LAogICAgbG9jYWxlOiB7CiAgICAgIHR5cGU6IFN0cmluZwogICAgfQogIH0sCiAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoaCwgcmVmKSB7CiAgICB2YXIgcHJvcHMgPSByZWYucHJvcHM7CiAgICB2YXIgcGFyZW50ID0gcmVmLnBhcmVudDsKICAgIHZhciBkYXRhID0gcmVmLmRhdGE7CiAgICB2YXIgaTE4biA9IHBhcmVudC4kaTE4bjsKCiAgICBpZiAoIWkxOG4pIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCdDYW5ub3QgZmluZCBWdWVJMThuIGluc3RhbmNlIScpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICB2YXIga2V5ID0gbnVsbDsKICAgIHZhciBvcHRpb25zID0gbnVsbDsKCiAgICBpZiAoaXNTdHJpbmcocHJvcHMuZm9ybWF0KSkgewogICAgICBrZXkgPSBwcm9wcy5mb3JtYXQ7CiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KHByb3BzLmZvcm1hdCkpIHsKICAgICAgaWYgKHByb3BzLmZvcm1hdC5rZXkpIHsKICAgICAgICBrZXkgPSBwcm9wcy5mb3JtYXQua2V5OwogICAgICB9IC8vIEZpbHRlciBvdXQgbnVtYmVyIGZvcm1hdCBvcHRpb25zIG9ubHkKCgogICAgICBvcHRpb25zID0gT2JqZWN0LmtleXMocHJvcHMuZm9ybWF0KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgcHJvcCkgewogICAgICAgIHZhciBvYmo7CgogICAgICAgIGlmIChpbmNsdWRlcyhudW1iZXJGb3JtYXRLZXlzLCBwcm9wKSkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGFjYywgKG9iaiA9IHt9LCBvYmpbcHJvcF0gPSBwcm9wcy5mb3JtYXRbcHJvcF0sIG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgdmFyIGxvY2FsZSA9IHByb3BzLmxvY2FsZSB8fCBpMThuLmxvY2FsZTsKCiAgICB2YXIgcGFydHMgPSBpMThuLl9udHAocHJvcHMudmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKCiAgICB2YXIgdmFsdWVzID0gcGFydHMubWFwKGZ1bmN0aW9uIChwYXJ0LCBpbmRleCkgewogICAgICB2YXIgb2JqOwogICAgICB2YXIgc2xvdCA9IGRhdGEuc2NvcGVkU2xvdHMgJiYgZGF0YS5zY29wZWRTbG90c1twYXJ0LnR5cGVdOwogICAgICByZXR1cm4gc2xvdCA/IHNsb3QoKG9iaiA9IHt9LCBvYmpbcGFydC50eXBlXSA9IHBhcnQudmFsdWUsIG9iai5pbmRleCA9IGluZGV4LCBvYmoucGFydHMgPSBwYXJ0cywgb2JqKSkgOiBwYXJ0LnZhbHVlOwogICAgfSk7CiAgICB2YXIgdGFnID0gISFwcm9wcy50YWcgJiYgcHJvcHMudGFnICE9PSB0cnVlIHx8IHByb3BzLnRhZyA9PT0gZmFsc2UgPyBwcm9wcy50YWcgOiAnc3Bhbic7CiAgICByZXR1cm4gdGFnID8gaCh0YWcsIHsKICAgICAgYXR0cnM6IGRhdGEuYXR0cnMsCiAgICAgICdjbGFzcyc6IGRhdGFbJ2NsYXNzJ10sCiAgICAgIHN0YXRpY0NsYXNzOiBkYXRhLnN0YXRpY0NsYXNzCiAgICB9LCB2YWx1ZXMpIDogdmFsdWVzOwogIH0KfTsKLyogICovCgpmdW5jdGlvbiBiaW5kKGVsLCBiaW5kaW5nLCB2bm9kZSkgewogIGlmICghYXNzZXJ0KGVsLCB2bm9kZSkpIHsKICAgIHJldHVybjsKICB9CgogIHQoZWwsIGJpbmRpbmcsIHZub2RlKTsKfQoKZnVuY3Rpb24gdXBkYXRlKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVk5vZGUpIHsKICBpZiAoIWFzc2VydChlbCwgdm5vZGUpKSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgaTE4biA9IHZub2RlLmNvbnRleHQuJGkxOG47CgogIGlmIChsb2NhbGVFcXVhbChlbCwgdm5vZGUpICYmIGxvb3NlRXF1YWwoYmluZGluZy52YWx1ZSwgYmluZGluZy5vbGRWYWx1ZSkgJiYgbG9vc2VFcXVhbChlbC5fbG9jYWxlTWVzc2FnZSwgaTE4bi5nZXRMb2NhbGVNZXNzYWdlKGkxOG4ubG9jYWxlKSkpIHsKICAgIHJldHVybjsKICB9CgogIHQoZWwsIGJpbmRpbmcsIHZub2RlKTsKfQoKZnVuY3Rpb24gdW5iaW5kKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVk5vZGUpIHsKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwoKICBpZiAoIXZtKSB7CiAgICB3YXJuKCdWdWUgaW5zdGFuY2UgZG9lcyBub3QgZXhpc3RzIGluIFZOb2RlIGNvbnRleHQnKTsKICAgIHJldHVybjsKICB9CgogIHZhciBpMThuID0gdm5vZGUuY29udGV4dC4kaTE4biB8fCB7fTsKCiAgaWYgKCFiaW5kaW5nLm1vZGlmaWVycy5wcmVzZXJ2ZSAmJiAhaTE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQpIHsKICAgIGVsLnRleHRDb250ZW50ID0gJyc7CiAgfQoKICBlbC5fdnQgPSB1bmRlZmluZWQ7CiAgZGVsZXRlIGVsWydfdnQnXTsKICBlbC5fbG9jYWxlID0gdW5kZWZpbmVkOwogIGRlbGV0ZSBlbFsnX2xvY2FsZSddOwogIGVsLl9sb2NhbGVNZXNzYWdlID0gdW5kZWZpbmVkOwogIGRlbGV0ZSBlbFsnX2xvY2FsZU1lc3NhZ2UnXTsKfQoKZnVuY3Rpb24gYXNzZXJ0KGVsLCB2bm9kZSkgewogIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CgogIGlmICghdm0pIHsKICAgIHdhcm4oJ1Z1ZSBpbnN0YW5jZSBkb2VzIG5vdCBleGlzdHMgaW4gVk5vZGUgY29udGV4dCcpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgaWYgKCF2bS4kaTE4bikgewogICAgd2FybignVnVlSTE4biBpbnN0YW5jZSBkb2VzIG5vdCBleGlzdHMgaW4gVnVlIGluc3RhbmNlJyk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gbG9jYWxlRXF1YWwoZWwsIHZub2RlKSB7CiAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKICByZXR1cm4gZWwuX2xvY2FsZSA9PT0gdm0uJGkxOG4ubG9jYWxlOwp9CgpmdW5jdGlvbiB0KGVsLCBiaW5kaW5nLCB2bm9kZSkgewogIHZhciByZWYkMSwgcmVmJDI7CiAgdmFyIHZhbHVlID0gYmluZGluZy52YWx1ZTsKICB2YXIgcmVmID0gcGFyc2VWYWx1ZSh2YWx1ZSk7CiAgdmFyIHBhdGggPSByZWYucGF0aDsKICB2YXIgbG9jYWxlID0gcmVmLmxvY2FsZTsKICB2YXIgYXJncyA9IHJlZi5hcmdzOwogIHZhciBjaG9pY2UgPSByZWYuY2hvaWNlOwoKICBpZiAoIXBhdGggJiYgIWxvY2FsZSAmJiAhYXJncykgewogICAgd2FybigndmFsdWUgdHlwZSBub3Qgc3VwcG9ydGVkJyk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoIXBhdGgpIHsKICAgIHdhcm4oJ2BwYXRoYCBpcyByZXF1aXJlZCBpbiB2LXQgZGlyZWN0aXZlJyk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwoKICBpZiAoY2hvaWNlICE9IG51bGwpIHsKICAgIGVsLl92dCA9IGVsLnRleHRDb250ZW50ID0gKHJlZiQxID0gdm0uJGkxOG4pLnRjLmFwcGx5KHJlZiQxLCBbcGF0aCwgY2hvaWNlXS5jb25jYXQobWFrZVBhcmFtcyhsb2NhbGUsIGFyZ3MpKSk7CiAgfSBlbHNlIHsKICAgIGVsLl92dCA9IGVsLnRleHRDb250ZW50ID0gKHJlZiQyID0gdm0uJGkxOG4pLnQuYXBwbHkocmVmJDIsIFtwYXRoXS5jb25jYXQobWFrZVBhcmFtcyhsb2NhbGUsIGFyZ3MpKSk7CiAgfQoKICBlbC5fbG9jYWxlID0gdm0uJGkxOG4ubG9jYWxlOwogIGVsLl9sb2NhbGVNZXNzYWdlID0gdm0uJGkxOG4uZ2V0TG9jYWxlTWVzc2FnZSh2bS4kaTE4bi5sb2NhbGUpOwp9CgpmdW5jdGlvbiBwYXJzZVZhbHVlKHZhbHVlKSB7CiAgdmFyIHBhdGg7CiAgdmFyIGxvY2FsZTsKICB2YXIgYXJnczsKICB2YXIgY2hvaWNlOwoKICBpZiAoaXNTdHJpbmcodmFsdWUpKSB7CiAgICBwYXRoID0gdmFsdWU7CiAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgcGF0aCA9IHZhbHVlLnBhdGg7CiAgICBsb2NhbGUgPSB2YWx1ZS5sb2NhbGU7CiAgICBhcmdzID0gdmFsdWUuYXJnczsKICAgIGNob2ljZSA9IHZhbHVlLmNob2ljZTsKICB9CgogIHJldHVybiB7CiAgICBwYXRoOiBwYXRoLAogICAgbG9jYWxlOiBsb2NhbGUsCiAgICBhcmdzOiBhcmdzLAogICAgY2hvaWNlOiBjaG9pY2UKICB9Owp9CgpmdW5jdGlvbiBtYWtlUGFyYW1zKGxvY2FsZSwgYXJncykgewogIHZhciBwYXJhbXMgPSBbXTsKICBsb2NhbGUgJiYgcGFyYW1zLnB1c2gobG9jYWxlKTsKCiAgaWYgKGFyZ3MgJiYgKEFycmF5LmlzQXJyYXkoYXJncykgfHwgaXNQbGFpbk9iamVjdChhcmdzKSkpIHsKICAgIHBhcmFtcy5wdXNoKGFyZ3MpOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQoKdmFyIFZ1ZTsKCmZ1bmN0aW9uIGluc3RhbGwoX1Z1ZSkgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIGluc3RhbGwuaW5zdGFsbGVkICYmIF9WdWUgPT09IFZ1ZSkgewogICAgd2FybignYWxyZWFkeSBpbnN0YWxsZWQuJyk7CiAgICByZXR1cm47CiAgfQoKICBpbnN0YWxsLmluc3RhbGxlZCA9IHRydWU7CiAgVnVlID0gX1Z1ZTsKICB2YXIgdmVyc2lvbiA9IFZ1ZS52ZXJzaW9uICYmIE51bWJlcihWdWUudmVyc2lvbi5zcGxpdCgnLicpWzBdKSB8fCAtMTsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgdmVyc2lvbiA8IDIpIHsKICAgIHdhcm4oInZ1ZS1pMThuICgiICsgaW5zdGFsbC52ZXJzaW9uICsgIikgbmVlZCB0byB1c2UgVnVlIDIuMCBvciBsYXRlciAoVnVlOiAiICsgVnVlLnZlcnNpb24gKyAiKS4iKTsKICAgIHJldHVybjsKICB9CgogIGV4dGVuZChWdWUpOwogIFZ1ZS5taXhpbihtaXhpbik7CiAgVnVlLmRpcmVjdGl2ZSgndCcsIHsKICAgIGJpbmQ6IGJpbmQsCiAgICB1cGRhdGU6IHVwZGF0ZSwKICAgIHVuYmluZDogdW5iaW5kCiAgfSk7CiAgVnVlLmNvbXBvbmVudChpbnRlcnBvbGF0aW9uQ29tcG9uZW50Lm5hbWUsIGludGVycG9sYXRpb25Db21wb25lbnQpOwogIFZ1ZS5jb21wb25lbnQobnVtYmVyQ29tcG9uZW50Lm5hbWUsIG51bWJlckNvbXBvbmVudCk7IC8vIHVzZSBzaW1wbGUgbWVyZ2VTdHJhdGVnaWVzIHRvIHByZXZlbnQgaTE4biBpbnN0YW5jZSBsb3NlICdfX3Byb3RvX18nCgogIHZhciBzdHJhdHMgPSBWdWUuY29uZmlnLm9wdGlvbk1lcmdlU3RyYXRlZ2llczsKCiAgc3RyYXRzLmkxOG4gPSBmdW5jdGlvbiAocGFyZW50VmFsLCBjaGlsZFZhbCkgewogICAgcmV0dXJuIGNoaWxkVmFsID09PSB1bmRlZmluZWQgPyBwYXJlbnRWYWwgOiBjaGlsZFZhbDsKICB9Owp9Ci8qICAqLwoKCnZhciBCYXNlRm9ybWF0dGVyID0gZnVuY3Rpb24gQmFzZUZvcm1hdHRlcigpIHsKICB0aGlzLl9jYWNoZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9OwoKQmFzZUZvcm1hdHRlci5wcm90b3R5cGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiBpbnRlcnBvbGF0ZShtZXNzYWdlLCB2YWx1ZXMpIHsKICBpZiAoIXZhbHVlcykgewogICAgcmV0dXJuIFttZXNzYWdlXTsKICB9CgogIHZhciB0b2tlbnMgPSB0aGlzLl9jYWNoZXNbbWVzc2FnZV07CgogIGlmICghdG9rZW5zKSB7CiAgICB0b2tlbnMgPSBwYXJzZShtZXNzYWdlKTsKICAgIHRoaXMuX2NhY2hlc1ttZXNzYWdlXSA9IHRva2VuczsKICB9CgogIHJldHVybiBjb21waWxlKHRva2VucywgdmFsdWVzKTsKfTsKCnZhciBSRV9UT0tFTl9MSVNUX1ZBTFVFID0gL14oPzpcZCkrLzsKdmFyIFJFX1RPS0VOX05BTUVEX1ZBTFVFID0gL14oPzpcdykrLzsKCmZ1bmN0aW9uIHBhcnNlKGZvcm1hdCkgewogIHZhciB0b2tlbnMgPSBbXTsKICB2YXIgcG9zaXRpb24gPSAwOwogIHZhciB0ZXh0ID0gJyc7CgogIHdoaWxlIChwb3NpdGlvbiA8IGZvcm1hdC5sZW5ndGgpIHsKICAgIHZhciBfY2hhciA9IGZvcm1hdFtwb3NpdGlvbisrXTsKCiAgICBpZiAoX2NoYXIgPT09ICd7JykgewogICAgICBpZiAodGV4dCkgewogICAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgIHZhbHVlOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRleHQgPSAnJzsKICAgICAgdmFyIHN1YiA9ICcnOwogICAgICBfY2hhciA9IGZvcm1hdFtwb3NpdGlvbisrXTsKCiAgICAgIHdoaWxlIChfY2hhciAhPT0gdW5kZWZpbmVkICYmIF9jaGFyICE9PSAnfScpIHsKICAgICAgICBzdWIgKz0gX2NoYXI7CiAgICAgICAgX2NoYXIgPSBmb3JtYXRbcG9zaXRpb24rK107CiAgICAgIH0KCiAgICAgIHZhciBpc0Nsb3NlZCA9IF9jaGFyID09PSAnfSc7CiAgICAgIHZhciB0eXBlID0gUkVfVE9LRU5fTElTVF9WQUxVRS50ZXN0KHN1YikgPyAnbGlzdCcgOiBpc0Nsb3NlZCAmJiBSRV9UT0tFTl9OQU1FRF9WQUxVRS50ZXN0KHN1YikgPyAnbmFtZWQnIDogJ3Vua25vd24nOwogICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgdmFsdWU6IHN1YiwKICAgICAgICB0eXBlOiB0eXBlCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChfY2hhciA9PT0gJyUnKSB7CiAgICAgIC8vIHdoZW4gZm91bmQgcmFpbHMgaTE4biBzeW50YXgsIHNraXAgdGV4dCBjYXB0dXJlCiAgICAgIGlmIChmb3JtYXRbcG9zaXRpb25dICE9PSAneycpIHsKICAgICAgICB0ZXh0ICs9IF9jaGFyOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0ZXh0ICs9IF9jaGFyOwogICAgfQogIH0KCiAgdGV4dCAmJiB0b2tlbnMucHVzaCh7CiAgICB0eXBlOiAndGV4dCcsCiAgICB2YWx1ZTogdGV4dAogIH0pOwogIHJldHVybiB0b2tlbnM7Cn0KCmZ1bmN0aW9uIGNvbXBpbGUodG9rZW5zLCB2YWx1ZXMpIHsKICB2YXIgY29tcGlsZWQgPSBbXTsKICB2YXIgaW5kZXggPSAwOwogIHZhciBtb2RlID0gQXJyYXkuaXNBcnJheSh2YWx1ZXMpID8gJ2xpc3QnIDogaXNPYmplY3QodmFsdWVzKSA/ICduYW1lZCcgOiAndW5rbm93bic7CgogIGlmIChtb2RlID09PSAndW5rbm93bicpIHsKICAgIHJldHVybiBjb21waWxlZDsKICB9CgogIHdoaWxlIChpbmRleCA8IHRva2Vucy5sZW5ndGgpIHsKICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpbmRleF07CgogICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgIGNvbXBpbGVkLnB1c2godG9rZW4udmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbGlzdCc6CiAgICAgICAgY29tcGlsZWQucHVzaCh2YWx1ZXNbcGFyc2VJbnQodG9rZW4udmFsdWUsIDEwKV0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbmFtZWQnOgogICAgICAgIGlmIChtb2RlID09PSAnbmFtZWQnKSB7CiAgICAgICAgICBjb21waWxlZC5wdXNoKHZhbHVlc1t0b2tlbi52YWx1ZV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICB3YXJuKCJUeXBlIG9mIHRva2VuICciICsgdG9rZW4udHlwZSArICInIGFuZCBmb3JtYXQgb2YgdmFsdWUgJyIgKyBtb2RlICsgIicgZG9uJ3QgbWF0Y2ghIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3Vua25vd24nOgogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJEZXRlY3QgJ3Vua25vd24nIHR5cGUgb2YgdG9rZW4hIik7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KCiAgICBpbmRleCsrOwogIH0KCiAgcmV0dXJuIGNvbXBpbGVkOwp9Ci8qICAqLwoKLyoqCiAqICBQYXRoIHBhcnNlcgogKiAgLSBJbnNwaXJlZDoKICogICAgVnVlLmpzIFBhdGggcGFyc2VyCiAqLwovLyBhY3Rpb25zCgoKdmFyIEFQUEVORCA9IDA7CnZhciBQVVNIID0gMTsKdmFyIElOQ19TVUJfUEFUSF9ERVBUSCA9IDI7CnZhciBQVVNIX1NVQl9QQVRIID0gMzsgLy8gc3RhdGVzCgp2YXIgQkVGT1JFX1BBVEggPSAwOwp2YXIgSU5fUEFUSCA9IDE7CnZhciBCRUZPUkVfSURFTlQgPSAyOwp2YXIgSU5fSURFTlQgPSAzOwp2YXIgSU5fU1VCX1BBVEggPSA0Owp2YXIgSU5fU0lOR0xFX1FVT1RFID0gNTsKdmFyIElOX0RPVUJMRV9RVU9URSA9IDY7CnZhciBBRlRFUl9QQVRIID0gNzsKdmFyIEVSUk9SID0gODsKdmFyIHBhdGhTdGF0ZU1hY2hpbmUgPSBbXTsKcGF0aFN0YXRlTWFjaGluZVtCRUZPUkVfUEFUSF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9QQVRIXSwKICAnaWRlbnQnOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ1snOiBbSU5fU1VCX1BBVEhdLAogICdlb2YnOiBbQUZURVJfUEFUSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9QQVRIXSA9IHsKICAnd3MnOiBbSU5fUEFUSF0sCiAgJy4nOiBbQkVGT1JFX0lERU5UXSwKICAnWyc6IFtJTl9TVUJfUEFUSF0sCiAgJ2VvZic6IFtBRlRFUl9QQVRIXQp9OwpwYXRoU3RhdGVNYWNoaW5lW0JFRk9SRV9JREVOVF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9JREVOVF0sCiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9JREVOVF0gPSB7CiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ3dzJzogW0lOX1BBVEgsIFBVU0hdLAogICcuJzogW0JFRk9SRV9JREVOVCwgUFVTSF0sCiAgJ1snOiBbSU5fU1VCX1BBVEgsIFBVU0hdLAogICdlb2YnOiBbQUZURVJfUEFUSCwgUFVTSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TVUJfUEFUSF0gPSB7CiAgIiciOiBbSU5fU0lOR0xFX1FVT1RFLCBBUFBFTkRdLAogICciJzogW0lOX0RPVUJMRV9RVU9URSwgQVBQRU5EXSwKICAnWyc6IFtJTl9TVUJfUEFUSCwgSU5DX1NVQl9QQVRIX0RFUFRIXSwKICAnXSc6IFtJTl9QQVRILCBQVVNIX1NVQl9QQVRIXSwKICAnZW9mJzogRVJST1IsCiAgJ2Vsc2UnOiBbSU5fU1VCX1BBVEgsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TSU5HTEVfUVVPVEVdID0gewogICInIjogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9TSU5HTEVfUVVPVEUsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9ET1VCTEVfUVVPVEVdID0gewogICciJzogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9ET1VCTEVfUVVPVEUsIEFQUEVORF0KfTsKLyoqCiAqIENoZWNrIGlmIGFuIGV4cHJlc3Npb24gaXMgYSBsaXRlcmFsIHZhbHVlLgogKi8KCnZhciBsaXRlcmFsVmFsdWVSRSA9IC9eXHM/KD86dHJ1ZXxmYWxzZXwtP1tcZC5dK3wnW14nXSonfCJbXiJdKiIpXHM/JC87CgpmdW5jdGlvbiBpc0xpdGVyYWwoZXhwKSB7CiAgcmV0dXJuIGxpdGVyYWxWYWx1ZVJFLnRlc3QoZXhwKTsKfQovKioKICogU3RyaXAgcXVvdGVzIGZyb20gYSBzdHJpbmcKICovCgoKZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgdmFyIGEgPSBzdHIuY2hhckNvZGVBdCgwKTsKICB2YXIgYiA9IHN0ci5jaGFyQ29kZUF0KHN0ci5sZW5ndGggLSAxKTsKICByZXR1cm4gYSA9PT0gYiAmJiAoYSA9PT0gMHgyMiB8fCBhID09PSAweDI3KSA/IHN0ci5zbGljZSgxLCAtMSkgOiBzdHI7Cn0KLyoqCiAqIERldGVybWluZSB0aGUgdHlwZSBvZiBhIGNoYXJhY3RlciBpbiBhIGtleXBhdGguCiAqLwoKCmZ1bmN0aW9uIGdldFBhdGhDaGFyVHlwZShjaCkgewogIGlmIChjaCA9PT0gdW5kZWZpbmVkIHx8IGNoID09PSBudWxsKSB7CiAgICByZXR1cm4gJ2VvZic7CiAgfQoKICB2YXIgY29kZSA9IGNoLmNoYXJDb2RlQXQoMCk7CgogIHN3aXRjaCAoY29kZSkgewogICAgY2FzZSAweDVCOiAvLyBbCgogICAgY2FzZSAweDVEOiAvLyBdCgogICAgY2FzZSAweDJFOiAvLyAuCgogICAgY2FzZSAweDIyOiAvLyAiCgogICAgY2FzZSAweDI3OgogICAgICAvLyAnCiAgICAgIHJldHVybiBjaDsKCiAgICBjYXNlIDB4NUY6IC8vIF8KCiAgICBjYXNlIDB4MjQ6IC8vICQKCiAgICBjYXNlIDB4MkQ6CiAgICAgIC8vIC0KICAgICAgcmV0dXJuICdpZGVudCc7CgogICAgY2FzZSAweDA5OiAvLyBUYWIKCiAgICBjYXNlIDB4MEE6IC8vIE5ld2xpbmUKCiAgICBjYXNlIDB4MEQ6IC8vIFJldHVybgoKICAgIGNhc2UgMHhBMDogLy8gTm8tYnJlYWsgc3BhY2UKCiAgICBjYXNlIDB4RkVGRjogLy8gQnl0ZSBPcmRlciBNYXJrCgogICAgY2FzZSAweDIwMjg6IC8vIExpbmUgU2VwYXJhdG9yCgogICAgY2FzZSAweDIwMjk6CiAgICAgIC8vIFBhcmFncmFwaCBTZXBhcmF0b3IKICAgICAgcmV0dXJuICd3cyc7CiAgfQoKICByZXR1cm4gJ2lkZW50JzsKfQovKioKICogRm9ybWF0IGEgc3ViUGF0aCwgcmV0dXJuIGl0cyBwbGFpbiBmb3JtIGlmIGl0IGlzCiAqIGEgbGl0ZXJhbCBzdHJpbmcgb3IgbnVtYmVyLiBPdGhlcndpc2UgcHJlcGVuZCB0aGUKICogZHluYW1pYyBpbmRpY2F0b3IgKCopLgogKi8KCgpmdW5jdGlvbiBmb3JtYXRTdWJQYXRoKHBhdGgpIHsKICB2YXIgdHJpbW1lZCA9IHBhdGgudHJpbSgpOyAvLyBpbnZhbGlkIGxlYWRpbmcgMAoKICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICcwJyAmJiBpc05hTihwYXRoKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGlzTGl0ZXJhbCh0cmltbWVkKSA/IHN0cmlwUXVvdGVzKHRyaW1tZWQpIDogJyonICsgdHJpbW1lZDsKfQovKioKICogUGFyc2UgYSBzdHJpbmcgcGF0aCBpbnRvIGFuIGFycmF5IG9mIHNlZ21lbnRzCiAqLwoKCmZ1bmN0aW9uIHBhcnNlJDEocGF0aCkgewogIHZhciBrZXlzID0gW107CiAgdmFyIGluZGV4ID0gLTE7CiAgdmFyIG1vZGUgPSBCRUZPUkVfUEFUSDsKICB2YXIgc3ViUGF0aERlcHRoID0gMDsKICB2YXIgYzsKICB2YXIga2V5OwogIHZhciBuZXdDaGFyOwogIHZhciB0eXBlOwogIHZhciB0cmFuc2l0aW9uOwogIHZhciBhY3Rpb247CiAgdmFyIHR5cGVNYXA7CiAgdmFyIGFjdGlvbnMgPSBbXTsKCiAgYWN0aW9uc1tQVVNIXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkgewogICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAga2V5ID0gdW5kZWZpbmVkOwogICAgfQogIH07CgogIGFjdGlvbnNbQVBQRU5EXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICBrZXkgPSBuZXdDaGFyOwogICAgfSBlbHNlIHsKICAgICAga2V5ICs9IG5ld0NoYXI7CiAgICB9CiAgfTsKCiAgYWN0aW9uc1tJTkNfU1VCX1BBVEhfREVQVEhdID0gZnVuY3Rpb24gKCkgewogICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICBzdWJQYXRoRGVwdGgrKzsKICB9OwoKICBhY3Rpb25zW1BVU0hfU1VCX1BBVEhdID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHN1YlBhdGhEZXB0aCA+IDApIHsKICAgICAgc3ViUGF0aERlcHRoLS07CiAgICAgIG1vZGUgPSBJTl9TVUJfUEFUSDsKICAgICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICB9IGVsc2UgewogICAgICBzdWJQYXRoRGVwdGggPSAwOwoKICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBrZXkgPSBmb3JtYXRTdWJQYXRoKGtleSk7CgogICAgICBpZiAoa2V5ID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3Rpb25zW1BVU0hdKCk7CiAgICAgIH0KICAgIH0KICB9OwoKICBmdW5jdGlvbiBtYXliZVVuZXNjYXBlUXVvdGUoKSB7CiAgICB2YXIgbmV4dENoYXIgPSBwYXRoW2luZGV4ICsgMV07CgogICAgaWYgKG1vZGUgPT09IElOX1NJTkdMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gIiciIHx8IG1vZGUgPT09IElOX0RPVUJMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gJyInKSB7CiAgICAgIGluZGV4Kys7CiAgICAgIG5ld0NoYXIgPSAnXFwnICsgbmV4dENoYXI7CiAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CgogIHdoaWxlIChtb2RlICE9PSBudWxsKSB7CiAgICBpbmRleCsrOwogICAgYyA9IHBhdGhbaW5kZXhdOwoKICAgIGlmIChjID09PSAnXFwnICYmIG1heWJlVW5lc2NhcGVRdW90ZSgpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHR5cGUgPSBnZXRQYXRoQ2hhclR5cGUoYyk7CiAgICB0eXBlTWFwID0gcGF0aFN0YXRlTWFjaGluZVttb2RlXTsKICAgIHRyYW5zaXRpb24gPSB0eXBlTWFwW3R5cGVdIHx8IHR5cGVNYXBbJ2Vsc2UnXSB8fCBFUlJPUjsKCiAgICBpZiAodHJhbnNpdGlvbiA9PT0gRVJST1IpIHsKICAgICAgcmV0dXJuOyAvLyBwYXJzZSBlcnJvcgogICAgfQoKICAgIG1vZGUgPSB0cmFuc2l0aW9uWzBdOwogICAgYWN0aW9uID0gYWN0aW9uc1t0cmFuc2l0aW9uWzFdXTsKCiAgICBpZiAoYWN0aW9uKSB7CiAgICAgIG5ld0NoYXIgPSB0cmFuc2l0aW9uWzJdOwogICAgICBuZXdDaGFyID0gbmV3Q2hhciA9PT0gdW5kZWZpbmVkID8gYyA6IG5ld0NoYXI7CgogICAgICBpZiAoYWN0aW9uKCkgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgaWYgKG1vZGUgPT09IEFGVEVSX1BBVEgpIHsKICAgICAgcmV0dXJuIGtleXM7CiAgICB9CiAgfQp9Cgp2YXIgSTE4blBhdGggPSBmdW5jdGlvbiBJMThuUGF0aCgpIHsKICB0aGlzLl9jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn07Ci8qKgogKiBFeHRlcm5hbCBwYXJzZSB0aGF0IGNoZWNrIGZvciBhIGNhY2hlIGhpdCBmaXJzdAogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUucGFyc2VQYXRoID0gZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICB2YXIgaGl0ID0gdGhpcy5fY2FjaGVbcGF0aF07CgogIGlmICghaGl0KSB7CiAgICBoaXQgPSBwYXJzZSQxKHBhdGgpOwoKICAgIGlmIChoaXQpIHsKICAgICAgdGhpcy5fY2FjaGVbcGF0aF0gPSBoaXQ7CiAgICB9CiAgfQoKICByZXR1cm4gaGl0IHx8IFtdOwp9OwovKioKICogR2V0IHBhdGggdmFsdWUgZnJvbSBwYXRoIHN0cmluZwogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUuZ2V0UGF0aFZhbHVlID0gZnVuY3Rpb24gZ2V0UGF0aFZhbHVlKG9iaiwgcGF0aCkgewogIGlmICghaXNPYmplY3Qob2JqKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgcGF0aHMgPSB0aGlzLnBhcnNlUGF0aChwYXRoKTsKCiAgaWYgKHBhdGhzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfSBlbHNlIHsKICAgIHZhciBsZW5ndGggPSBwYXRocy5sZW5ndGg7CiAgICB2YXIgbGFzdCA9IG9iajsKICAgIHZhciBpID0gMDsKCiAgICB3aGlsZSAoaSA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBsYXN0W3BhdGhzW2ldXTsKCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGxhc3QgPSB2YWx1ZTsKICAgICAgaSsrOwogICAgfQoKICAgIHJldHVybiBsYXN0OwogIH0KfTsKLyogICovCgoKdmFyIGh0bWxUYWdNYXRjaGVyID0gLzxcLz9bXHdccz0iLy4nOjsjLVwvXSs+LzsKdmFyIGxpbmtLZXlNYXRjaGVyID0gLyg/OkAoPzpcLlthLXpdKyk/Oig/Oltcd1wtX3wuXSt8XChbXHdcLV98Ll0rXCkpKS9nOwp2YXIgbGlua0tleVByZWZpeE1hdGNoZXIgPSAvXkAoPzpcLihbYS16XSspKT86LzsKdmFyIGJyYWNrZXRzTWF0Y2hlciA9IC9bKCldL2c7CnZhciBkZWZhdWx0TW9kaWZpZXJzID0gewogICd1cHBlcic6IGZ1bmN0aW9uIHVwcGVyKHN0cikgewogICAgcmV0dXJuIHN0ci50b0xvY2FsZVVwcGVyQ2FzZSgpOwogIH0sCiAgJ2xvd2VyJzogZnVuY3Rpb24gbG93ZXIoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvTG9jYWxlTG93ZXJDYXNlKCk7CiAgfSwKICAnY2FwaXRhbGl6ZSc6IGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyKSB7CiAgICByZXR1cm4gIiIgKyBzdHIuY2hhckF0KDApLnRvTG9jYWxlVXBwZXJDYXNlKCkgKyBzdHIuc3Vic3RyKDEpOwogIH0KfTsKdmFyIGRlZmF1bHRGb3JtYXR0ZXIgPSBuZXcgQmFzZUZvcm1hdHRlcigpOwoKdmFyIFZ1ZUkxOG4gPSBmdW5jdGlvbiBWdWVJMThuKG9wdGlvbnMpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSBvcHRpb25zID0ge307IC8vIEF1dG8gaW5zdGFsbCBpZiBpdCBpcyBub3QgZG9uZSB5ZXQgYW5kIGB3aW5kb3dgIGhhcyBgVnVlYC4KICAvLyBUbyBhbGxvdyB1c2VycyB0byBhdm9pZCBhdXRvLWluc3RhbGxhdGlvbiBpbiBzb21lIGNhc2VzLAogIC8vIHRoaXMgY29kZSBzaG91bGQgYmUgcGxhY2VkIGhlcmUuIFNlZSAjMjkwCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICBpZiAoIVZ1ZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVnVlKSB7CiAgICBpbnN0YWxsKHdpbmRvdy5WdWUpOwogIH0KCiAgdmFyIGxvY2FsZSA9IG9wdGlvbnMubG9jYWxlIHx8ICdlbi1VUyc7CiAgdmFyIGZhbGxiYWNrTG9jYWxlID0gb3B0aW9ucy5mYWxsYmFja0xvY2FsZSA9PT0gZmFsc2UgPyBmYWxzZSA6IG9wdGlvbnMuZmFsbGJhY2tMb2NhbGUgfHwgJ2VuLVVTJzsKICB2YXIgbWVzc2FnZXMgPSBvcHRpb25zLm1lc3NhZ2VzIHx8IHt9OwogIHZhciBkYXRlVGltZUZvcm1hdHMgPSBvcHRpb25zLmRhdGVUaW1lRm9ybWF0cyB8fCB7fTsKICB2YXIgbnVtYmVyRm9ybWF0cyA9IG9wdGlvbnMubnVtYmVyRm9ybWF0cyB8fCB7fTsKICB0aGlzLl92bSA9IG51bGw7CiAgdGhpcy5fZm9ybWF0dGVyID0gb3B0aW9ucy5mb3JtYXR0ZXIgfHwgZGVmYXVsdEZvcm1hdHRlcjsKICB0aGlzLl9tb2RpZmllcnMgPSBvcHRpb25zLm1vZGlmaWVycyB8fCB7fTsKICB0aGlzLl9taXNzaW5nID0gb3B0aW9ucy5taXNzaW5nIHx8IG51bGw7CiAgdGhpcy5fcm9vdCA9IG9wdGlvbnMucm9vdCB8fCBudWxsOwogIHRoaXMuX3N5bmMgPSBvcHRpb25zLnN5bmMgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIW9wdGlvbnMuc3luYzsKICB0aGlzLl9mYWxsYmFja1Jvb3QgPSBvcHRpb25zLmZhbGxiYWNrUm9vdCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6ICEhb3B0aW9ucy5mYWxsYmFja1Jvb3Q7CiAgdGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9IG9wdGlvbnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlczsKICB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4gPSBvcHRpb25zLnNpbGVudFRyYW5zbGF0aW9uV2FybiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zLnNpbGVudFRyYW5zbGF0aW9uV2FybjsKICB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm4gPSBvcHRpb25zLnNpbGVudEZhbGxiYWNrV2FybiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMuc2lsZW50RmFsbGJhY2tXYXJuOwogIHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVycyA9IHt9OwogIHRoaXMuX251bWJlckZvcm1hdHRlcnMgPSB7fTsKICB0aGlzLl9wYXRoID0gbmV3IEkxOG5QYXRoKCk7CiAgdGhpcy5fZGF0YUxpc3RlbmVycyA9IFtdOwogIHRoaXMuX2NvbXBvbmVudEluc3RhbmNlQ3JlYXRlZExpc3RlbmVyID0gb3B0aW9ucy5jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lciB8fCBudWxsOwogIHRoaXMuX3ByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9IG9wdGlvbnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50ID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICEhb3B0aW9ucy5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7CiAgdGhpcy5wbHVyYWxpemF0aW9uUnVsZXMgPSBvcHRpb25zLnBsdXJhbGl6YXRpb25SdWxlcyB8fCB7fTsKICB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9IG9wdGlvbnMud2Fybkh0bWxJbk1lc3NhZ2UgfHwgJ29mZic7CiAgdGhpcy5fcG9zdFRyYW5zbGF0aW9uID0gb3B0aW9ucy5wb3N0VHJhbnNsYXRpb24gfHwgbnVsbDsKICB0aGlzLl9lc2NhcGVQYXJhbWV0ZXJIdG1sID0gb3B0aW9ucy5lc2NhcGVQYXJhbWV0ZXJIdG1sIHx8IGZhbHNlOwogIC8qKgogICAqIEBwYXJhbSBjaG9pY2Uge251bWJlcn0gYSBjaG9pY2UgaW5kZXggZ2l2ZW4gYnkgdGhlIGlucHV0IHRvICR0YzogYCR0YygncGF0aC50by5ydWxlJywgY2hvaWNlSW5kZXgpYAogICAqIEBwYXJhbSBjaG9pY2VzTGVuZ3RoIHtudW1iZXJ9IGFuIG92ZXJhbGwgYW1vdW50IG9mIGF2YWlsYWJsZSBjaG9pY2VzCiAgICogQHJldHVybnMgYSBmaW5hbCBjaG9pY2UgaW5kZXgKICAqLwoKICB0aGlzLmdldENob2ljZUluZGV4ID0gZnVuY3Rpb24gKGNob2ljZSwgY2hvaWNlc0xlbmd0aCkgewogICAgdmFyIHRoaXNQcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyQxKTsKCiAgICBpZiAodGhpc1Byb3RvdHlwZSAmJiB0aGlzUHJvdG90eXBlLmdldENob2ljZUluZGV4KSB7CiAgICAgIHZhciBwcm90b3R5cGVHZXRDaG9pY2VJbmRleCA9IHRoaXNQcm90b3R5cGUuZ2V0Q2hvaWNlSW5kZXg7CiAgICAgIHJldHVybiBwcm90b3R5cGVHZXRDaG9pY2VJbmRleC5jYWxsKHRoaXMkMSwgY2hvaWNlLCBjaG9pY2VzTGVuZ3RoKTsKICAgIH0gLy8gRGVmYXVsdCAob2xkKSBnZXRDaG9pY2VJbmRleCBpbXBsZW1lbnRhdGlvbiAtIGVuZ2xpc2gtY29tcGF0aWJsZQoKCiAgICB2YXIgZGVmYXVsdEltcGwgPSBmdW5jdGlvbiBkZWZhdWx0SW1wbChfY2hvaWNlLCBfY2hvaWNlc0xlbmd0aCkgewogICAgICBfY2hvaWNlID0gTWF0aC5hYnMoX2Nob2ljZSk7CgogICAgICBpZiAoX2Nob2ljZXNMZW5ndGggPT09IDIpIHsKICAgICAgICByZXR1cm4gX2Nob2ljZSA/IF9jaG9pY2UgPiAxID8gMSA6IDAgOiAxOwogICAgICB9CgogICAgICByZXR1cm4gX2Nob2ljZSA/IE1hdGgubWluKF9jaG9pY2UsIDIpIDogMDsKICAgIH07CgogICAgaWYgKHRoaXMkMS5sb2NhbGUgaW4gdGhpcyQxLnBsdXJhbGl6YXRpb25SdWxlcykgewogICAgICByZXR1cm4gdGhpcyQxLnBsdXJhbGl6YXRpb25SdWxlc1t0aGlzJDEubG9jYWxlXS5hcHBseSh0aGlzJDEsIFtjaG9pY2UsIGNob2ljZXNMZW5ndGhdKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW1wbChjaG9pY2UsIGNob2ljZXNMZW5ndGgpOwogICAgfQogIH07CgogIHRoaXMuX2V4aXN0ID0gZnVuY3Rpb24gKG1lc3NhZ2UsIGtleSkgewogICAgaWYgKCFtZXNzYWdlIHx8ICFrZXkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGlmICghaXNOdWxsKHRoaXMkMS5fcGF0aC5nZXRQYXRoVmFsdWUobWVzc2FnZSwga2V5KSkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IC8vIGZhbGxiYWNrIGZvciBmbGF0IGtleQoKCiAgICBpZiAobWVzc2FnZVtrZXldKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9OwoKICBpZiAodGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICd3YXJuJyB8fCB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9PT0gJ2Vycm9yJykgewogICAgT2JqZWN0LmtleXMobWVzc2FnZXMpLmZvckVhY2goZnVuY3Rpb24gKGxvY2FsZSkgewogICAgICB0aGlzJDEuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMkMS5fd2Fybkh0bWxJbk1lc3NhZ2UsIG1lc3NhZ2VzW2xvY2FsZV0pOwogICAgfSk7CiAgfQoKICB0aGlzLl9pbml0Vk0oewogICAgbG9jYWxlOiBsb2NhbGUsCiAgICBmYWxsYmFja0xvY2FsZTogZmFsbGJhY2tMb2NhbGUsCiAgICBtZXNzYWdlczogbWVzc2FnZXMsCiAgICBkYXRlVGltZUZvcm1hdHM6IGRhdGVUaW1lRm9ybWF0cywKICAgIG51bWJlckZvcm1hdHM6IG51bWJlckZvcm1hdHMKICB9KTsKfTsKCnZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7CiAgdm06IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbWVzc2FnZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgZGF0ZVRpbWVGb3JtYXRzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIG51bWJlckZvcm1hdHM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgYXZhaWxhYmxlTG9jYWxlczogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBsb2NhbGU6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgZmFsbGJhY2tMb2NhbGU6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgZm9ybWF0RmFsbGJhY2tNZXNzYWdlczogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBtaXNzaW5nOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZvcm1hdHRlcjogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBzaWxlbnRUcmFuc2xhdGlvbldhcm46IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgc2lsZW50RmFsbGJhY2tXYXJuOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIHByZXNlcnZlRGlyZWN0aXZlQ29udGVudDogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICB3YXJuSHRtbEluTWVzc2FnZTogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBwb3N0VHJhbnNsYXRpb246IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jaGVja0xvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBfY2hlY2tMb2NhbGVNZXNzYWdlKGxvY2FsZSwgbGV2ZWwsIG1lc3NhZ2UpIHsKICB2YXIgcGF0aHMgPSBbXTsKCiAgdmFyIGZuID0gZnVuY3Rpb24gZm4obGV2ZWwsIGxvY2FsZSwgbWVzc2FnZSwgcGF0aHMpIHsKICAgIGlmIChpc1BsYWluT2JqZWN0KG1lc3NhZ2UpKSB7CiAgICAgIE9iamVjdC5rZXlzKG1lc3NhZ2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgIHZhciB2YWwgPSBtZXNzYWdlW2tleV07CgogICAgICAgIGlmIChpc1BsYWluT2JqZWN0KHZhbCkpIHsKICAgICAgICAgIHBhdGhzLnB1c2goa2V5KTsKICAgICAgICAgIHBhdGhzLnB1c2goJy4nKTsKICAgICAgICAgIGZuKGxldmVsLCBsb2NhbGUsIHZhbCwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGF0aHMucHVzaChrZXkpOwogICAgICAgICAgZm4obGV2ZWwsIGxvY2FsZSwgdmFsLCBwYXRocyk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChpc0FycmF5KG1lc3NhZ2UpKSB7CiAgICAgIG1lc3NhZ2UuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICBpZiAoaXNQbGFpbk9iamVjdChpdGVtKSkgewogICAgICAgICAgcGF0aHMucHVzaCgiWyIgKyBpbmRleCArICJdIik7CiAgICAgICAgICBwYXRocy5wdXNoKCcuJyk7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCBpdGVtLCBwYXRocyk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICAgIHBhdGhzLnBvcCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwYXRocy5wdXNoKCJbIiArIGluZGV4ICsgIl0iKTsKICAgICAgICAgIGZuKGxldmVsLCBsb2NhbGUsIGl0ZW0sIHBhdGhzKTsKICAgICAgICAgIHBhdGhzLnBvcCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGlzU3RyaW5nKG1lc3NhZ2UpKSB7CiAgICAgIHZhciByZXQgPSBodG1sVGFnTWF0Y2hlci50ZXN0KG1lc3NhZ2UpOwoKICAgICAgaWYgKHJldCkgewogICAgICAgIHZhciBtc2cgPSAiRGV0ZWN0ZWQgSFRNTCBpbiBtZXNzYWdlICciICsgbWVzc2FnZSArICInIG9mIGtleXBhdGggJyIgKyBwYXRocy5qb2luKCcnKSArICInIGF0ICciICsgbG9jYWxlICsgIicuIENvbnNpZGVyIGNvbXBvbmVudCBpbnRlcnBvbGF0aW9uIHdpdGggJzxpMThuPicgdG8gYXZvaWQgWFNTLiBTZWUgaHR0cHM6Ly9iaXQubHkvMlpxSnprcCI7CgogICAgICAgIGlmIChsZXZlbCA9PT0gJ3dhcm4nKSB7CiAgICAgICAgICB3YXJuKG1zZyk7CiAgICAgICAgfSBlbHNlIGlmIChsZXZlbCA9PT0gJ2Vycm9yJykgewogICAgICAgICAgZXJyb3IobXNnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICBmbihsZXZlbCwgbG9jYWxlLCBtZXNzYWdlLCBwYXRocyk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faW5pdFZNID0gZnVuY3Rpb24gX2luaXRWTShkYXRhKSB7CiAgdmFyIHNpbGVudCA9IFZ1ZS5jb25maWcuc2lsZW50OwogIFZ1ZS5jb25maWcuc2lsZW50ID0gdHJ1ZTsKICB0aGlzLl92bSA9IG5ldyBWdWUoewogICAgZGF0YTogZGF0YQogIH0pOwogIFZ1ZS5jb25maWcuc2lsZW50ID0gc2lsZW50Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZGVzdHJveVZNID0gZnVuY3Rpb24gZGVzdHJveVZNKCkgewogIHRoaXMuX3ZtLiRkZXN0cm95KCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcgPSBmdW5jdGlvbiBzdWJzY3JpYmVEYXRhQ2hhbmdpbmcodm0pIHsKICB0aGlzLl9kYXRhTGlzdGVuZXJzLnB1c2godm0pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUudW5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcgPSBmdW5jdGlvbiB1bnN1YnNjcmliZURhdGFDaGFuZ2luZyh2bSkgewogIHJlbW92ZSh0aGlzLl9kYXRhTGlzdGVuZXJzLCB2bSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS53YXRjaEkxOG5EYXRhID0gZnVuY3Rpb24gd2F0Y2hJMThuRGF0YSgpIHsKICB2YXIgc2VsZiA9IHRoaXM7CiAgcmV0dXJuIHRoaXMuX3ZtLiR3YXRjaCgnJGRhdGEnLCBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaSA9IHNlbGYuX2RhdGFMaXN0ZW5lcnMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgVnVlLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBzZWxmLl9kYXRhTGlzdGVuZXJzW2ldICYmIHNlbGYuX2RhdGFMaXN0ZW5lcnNbaV0uJGZvcmNlVXBkYXRlKCk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGRlZXA6IHRydWUKICB9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLndhdGNoTG9jYWxlID0gZnVuY3Rpb24gd2F0Y2hMb2NhbGUoKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCF0aGlzLl9zeW5jIHx8ICF0aGlzLl9yb290KSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIHZhciB0YXJnZXQgPSB0aGlzLl92bTsKICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi52bS4kd2F0Y2goJ2xvY2FsZScsIGZ1bmN0aW9uICh2YWwpIHsKICAgIHRhcmdldC4kc2V0KHRhcmdldCwgJ2xvY2FsZScsIHZhbCk7CiAgICB0YXJnZXQuJGZvcmNlVXBkYXRlKCk7CiAgfSwgewogICAgaW1tZWRpYXRlOiB0cnVlCiAgfSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5vbkNvbXBvbmVudEluc3RhbmNlQ3JlYXRlZCA9IGZ1bmN0aW9uIG9uQ29tcG9uZW50SW5zdGFuY2VDcmVhdGVkKG5ld0kxOG4pIHsKICBpZiAodGhpcy5fY29tcG9uZW50SW5zdGFuY2VDcmVhdGVkTGlzdGVuZXIpIHsKICAgIHRoaXMuX2NvbXBvbmVudEluc3RhbmNlQ3JlYXRlZExpc3RlbmVyKG5ld0kxOG4sIHRoaXMpOwogIH0KfTsKCnByb3RvdHlwZUFjY2Vzc29ycy52bS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1lc3NhZ2VzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl9nZXRNZXNzYWdlcygpKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5kYXRlVGltZUZvcm1hdHMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX2dldERhdGVUaW1lRm9ybWF0cygpKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5udW1iZXJGb3JtYXRzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl9nZXROdW1iZXJGb3JtYXRzKCkpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmF2YWlsYWJsZUxvY2FsZXMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLm1lc3NhZ2VzKS5zb3J0KCk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubG9jYWxlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fdm0ubG9jYWxlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmxvY2FsZS5zZXQgPSBmdW5jdGlvbiAobG9jYWxlKSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bSwgJ2xvY2FsZScsIGxvY2FsZSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZmFsbGJhY2tMb2NhbGUuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl92bS5mYWxsYmFja0xvY2FsZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mYWxsYmFja0xvY2FsZS5zZXQgPSBmdW5jdGlvbiAobG9jYWxlKSB7CiAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSA9IHt9OwoKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLCAnZmFsbGJhY2tMb2NhbGUnLCBsb2NhbGUpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9mb3JtYXRGYWxsYmFja01lc3NhZ2VzOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMuc2V0ID0gZnVuY3Rpb24gKGZhbGxiYWNrKSB7CiAgdGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9IGZhbGxiYWNrOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1pc3NpbmcuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9taXNzaW5nOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1pc3Npbmcuc2V0ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHsKICB0aGlzLl9taXNzaW5nID0gaGFuZGxlcjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mb3JtYXR0ZXIuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9mb3JtYXR0ZXI7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZm9ybWF0dGVyLnNldCA9IGZ1bmN0aW9uIChmb3JtYXR0ZXIpIHsKICB0aGlzLl9mb3JtYXR0ZXIgPSBmb3JtYXR0ZXI7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuc2lsZW50VHJhbnNsYXRpb25XYXJuLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudFRyYW5zbGF0aW9uV2Fybi5zZXQgPSBmdW5jdGlvbiAoc2lsZW50KSB7CiAgdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuID0gc2lsZW50Owp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudEZhbGxiYWNrV2Fybi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5zaWxlbnRGYWxsYmFja1dhcm4uc2V0ID0gZnVuY3Rpb24gKHNpbGVudCkgewogIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybiA9IHNpbGVudDsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50LnNldCA9IGZ1bmN0aW9uIChwcmVzZXJ2ZSkgewogIHRoaXMuX3ByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9IHByZXNlcnZlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLndhcm5IdG1sSW5NZXNzYWdlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2U7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMud2Fybkh0bWxJbk1lc3NhZ2Uuc2V0ID0gZnVuY3Rpb24gKGxldmVsKSB7CiAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgdmFyIG9yZ0xldmVsID0gdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2U7CiAgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPSBsZXZlbDsKCiAgaWYgKG9yZ0xldmVsICE9PSBsZXZlbCAmJiAobGV2ZWwgPT09ICd3YXJuJyB8fCBsZXZlbCA9PT0gJ2Vycm9yJykpIHsKICAgIHZhciBtZXNzYWdlcyA9IHRoaXMuX2dldE1lc3NhZ2VzKCk7CgogICAgT2JqZWN0LmtleXMobWVzc2FnZXMpLmZvckVhY2goZnVuY3Rpb24gKGxvY2FsZSkgewogICAgICB0aGlzJDEuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMkMS5fd2Fybkh0bWxJbk1lc3NhZ2UsIG1lc3NhZ2VzW2xvY2FsZV0pOwogICAgfSk7CiAgfQp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnBvc3RUcmFuc2xhdGlvbi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3Bvc3RUcmFuc2xhdGlvbjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wb3N0VHJhbnNsYXRpb24uc2V0ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHsKICB0aGlzLl9wb3N0VHJhbnNsYXRpb24gPSBoYW5kbGVyOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldE1lc3NhZ2VzID0gZnVuY3Rpb24gX2dldE1lc3NhZ2VzKCkgewogIHJldHVybiB0aGlzLl92bS5tZXNzYWdlczsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXREYXRlVGltZUZvcm1hdHMgPSBmdW5jdGlvbiBfZ2V0RGF0ZVRpbWVGb3JtYXRzKCkgewogIHJldHVybiB0aGlzLl92bS5kYXRlVGltZUZvcm1hdHM7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0TnVtYmVyRm9ybWF0cyA9IGZ1bmN0aW9uIF9nZXROdW1iZXJGb3JtYXRzKCkgewogIHJldHVybiB0aGlzLl92bS5udW1iZXJGb3JtYXRzOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3dhcm5EZWZhdWx0ID0gZnVuY3Rpb24gX3dhcm5EZWZhdWx0KGxvY2FsZSwga2V5LCByZXN1bHQsIHZtLCB2YWx1ZXMsIGludGVycG9sYXRlTW9kZSkgewogIGlmICghaXNOdWxsKHJlc3VsdCkpIHsKICAgIHJldHVybiByZXN1bHQ7CiAgfQoKICBpZiAodGhpcy5fbWlzc2luZykgewogICAgdmFyIG1pc3NpbmdSZXQgPSB0aGlzLl9taXNzaW5nLmFwcGx5KG51bGwsIFtsb2NhbGUsIGtleSwgdm0sIHZhbHVlc10pOwoKICAgIGlmIChpc1N0cmluZyhtaXNzaW5nUmV0KSkgewogICAgICByZXR1cm4gbWlzc2luZ1JldDsKICAgIH0KICB9IGVsc2UgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkpIHsKICAgICAgd2FybigiQ2Fubm90IHRyYW5zbGF0ZSB0aGUgdmFsdWUgb2Yga2V5cGF0aCAnIiArIGtleSArICInLiAiICsgJ1VzZSB0aGUgdmFsdWUgb2Yga2V5cGF0aCBhcyBkZWZhdWx0LicpOwogICAgfQogIH0KCiAgaWYgKHRoaXMuX2Zvcm1hdEZhbGxiYWNrTWVzc2FnZXMpIHsKICAgIHZhciBwYXJzZWRBcmdzID0gcGFyc2VBcmdzLmFwcGx5KHZvaWQgMCwgdmFsdWVzKTsKICAgIHJldHVybiB0aGlzLl9yZW5kZXIoa2V5LCBpbnRlcnBvbGF0ZU1vZGUsIHBhcnNlZEFyZ3MucGFyYW1zLCBrZXkpOwogIH0gZWxzZSB7CiAgICByZXR1cm4ga2V5OwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc0ZhbGxiYWNrUm9vdCA9IGZ1bmN0aW9uIF9pc0ZhbGxiYWNrUm9vdCh2YWwpIHsKICByZXR1cm4gIXZhbCAmJiAhaXNOdWxsKHRoaXMuX3Jvb3QpICYmIHRoaXMuX2ZhbGxiYWNrUm9vdDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc1NpbGVudEZhbGxiYWNrV2FybiA9IGZ1bmN0aW9uIF9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuIGluc3RhbmNlb2YgUmVnRXhwID8gdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuLnRlc3Qoa2V5KSA6IHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc1NpbGVudEZhbGxiYWNrID0gZnVuY3Rpb24gX2lzU2lsZW50RmFsbGJhY2sobG9jYWxlLCBrZXkpIHsKICByZXR1cm4gdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSAmJiAodGhpcy5faXNGYWxsYmFja1Jvb3QoKSB8fCBsb2NhbGUgIT09IHRoaXMuZmFsbGJhY2tMb2NhbGUpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuID0gZnVuY3Rpb24gX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgewogIHJldHVybiB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4gaW5zdGFuY2VvZiBSZWdFeHAgPyB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4udGVzdChrZXkpIDogdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2ludGVycG9sYXRlID0gZnVuY3Rpb24gX2ludGVycG9sYXRlKGxvY2FsZSwgbWVzc2FnZSwga2V5LCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywgdmlzaXRlZExpbmtTdGFjaykgewogIGlmICghbWVzc2FnZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgcGF0aFJldCA9IHRoaXMuX3BhdGguZ2V0UGF0aFZhbHVlKG1lc3NhZ2UsIGtleSk7CgogIGlmIChpc0FycmF5KHBhdGhSZXQpIHx8IGlzUGxhaW5PYmplY3QocGF0aFJldCkpIHsKICAgIHJldHVybiBwYXRoUmV0OwogIH0KCiAgdmFyIHJldDsKCiAgaWYgKGlzTnVsbChwYXRoUmV0KSkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChpc1BsYWluT2JqZWN0KG1lc3NhZ2UpKSB7CiAgICAgIHJldCA9IG1lc3NhZ2Vba2V5XTsKCiAgICAgIGlmICghKGlzU3RyaW5nKHJldCkgfHwgaXNGdW5jdGlvbihyZXQpKSkgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrKGxvY2FsZSwga2V5KSkgewogICAgICAgICAgd2FybigiVmFsdWUgb2Yga2V5ICciICsga2V5ICsgIicgaXMgbm90IGEgc3RyaW5nIG9yIGZ1bmN0aW9uICEiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9IGVsc2UgewogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChpc1N0cmluZyhwYXRoUmV0KSB8fCBpc0Z1bmN0aW9uKHBhdGhSZXQpKSB7CiAgICAgIHJldCA9IHBhdGhSZXQ7CiAgICB9IGVsc2UgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFjayhsb2NhbGUsIGtleSkpIHsKICAgICAgICB3YXJuKCJWYWx1ZSBvZiBrZXkgJyIgKyBrZXkgKyAiJyBpcyBub3QgYSBzdHJpbmcgb3IgZnVuY3Rpb24hIik7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0gLy8gQ2hlY2sgZm9yIHRoZSBleGlzdGVuY2Ugb2YgbGlua3Mgd2l0aGluIHRoZSB0cmFuc2xhdGVkIHN0cmluZwoKCiAgaWYgKGlzU3RyaW5nKHJldCkgJiYgKHJldC5pbmRleE9mKCdAOicpID49IDAgfHwgcmV0LmluZGV4T2YoJ0AuJykgPj0gMCkpIHsKICAgIHJldCA9IHRoaXMuX2xpbmsobG9jYWxlLCBtZXNzYWdlLCByZXQsIGhvc3QsICdyYXcnLCB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spOwogIH0KCiAgcmV0dXJuIHRoaXMuX3JlbmRlcihyZXQsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzLCBrZXkpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2xpbmsgPSBmdW5jdGlvbiBfbGluayhsb2NhbGUsIG1lc3NhZ2UsIHN0ciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spIHsKICB2YXIgcmV0ID0gc3RyOyAvLyBNYXRjaCBhbGwgdGhlIGxpbmtzIHdpdGhpbiB0aGUgbG9jYWwKICAvLyBXZSBhcmUgZ29pbmcgdG8gcmVwbGFjZSBlYWNoIG9mCiAgLy8gdGhlbSB3aXRoIGl0cyB0cmFuc2xhdGlvbgoKICB2YXIgbWF0Y2hlcyA9IHJldC5tYXRjaChsaW5rS2V5TWF0Y2hlcik7CgogIGZvciAodmFyIGlkeCBpbiBtYXRjaGVzKSB7CiAgICAvLyBpZSBjb21wYXRpYmxlOiBmaWx0ZXIgY3VzdG9tIGFycmF5CiAgICAvLyBwcm90b3R5cGUgbWV0aG9kCiAgICBpZiAoIW1hdGNoZXMuaGFzT3duUHJvcGVydHkoaWR4KSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICB2YXIgbGluayA9IG1hdGNoZXNbaWR4XTsKICAgIHZhciBsaW5rS2V5UHJlZml4TWF0Y2hlcyA9IGxpbmsubWF0Y2gobGlua0tleVByZWZpeE1hdGNoZXIpOwogICAgdmFyIGxpbmtQcmVmaXggPSBsaW5rS2V5UHJlZml4TWF0Y2hlc1swXTsKICAgIHZhciBmb3JtYXR0ZXJOYW1lID0gbGlua0tleVByZWZpeE1hdGNoZXNbMV07IC8vIFJlbW92ZSB0aGUgbGVhZGluZyBAOiwgQC5jYXNlOiBhbmQgdGhlIGJyYWNrZXRzCgogICAgdmFyIGxpbmtQbGFjZWhvbGRlciA9IGxpbmsucmVwbGFjZShsaW5rUHJlZml4LCAnJykucmVwbGFjZShicmFja2V0c01hdGNoZXIsICcnKTsKCiAgICBpZiAoaW5jbHVkZXModmlzaXRlZExpbmtTdGFjaywgbGlua1BsYWNlaG9sZGVyKSkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4oIkNpcmN1bGFyIHJlZmVyZW5jZSBmb3VuZC4gXCIiICsgbGluayArICJcIiBpcyBhbHJlYWR5IHZpc2l0ZWQgaW4gdGhlIGNoYWluIG9mICIgKyB2aXNpdGVkTGlua1N0YWNrLnJldmVyc2UoKS5qb2luKCcgPC0gJykpOwogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfQoKICAgIHZpc2l0ZWRMaW5rU3RhY2sucHVzaChsaW5rUGxhY2Vob2xkZXIpOyAvLyBUcmFuc2xhdGUgdGhlIGxpbmsKCiAgICB2YXIgdHJhbnNsYXRlZCA9IHRoaXMuX2ludGVycG9sYXRlKGxvY2FsZSwgbWVzc2FnZSwgbGlua1BsYWNlaG9sZGVyLCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUgPT09ICdyYXcnID8gJ3N0cmluZycgOiBpbnRlcnBvbGF0ZU1vZGUsIGludGVycG9sYXRlTW9kZSA9PT0gJ3JhdycgPyB1bmRlZmluZWQgOiB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spOwoKICAgIGlmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdCh0cmFuc2xhdGVkKSkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4obGlua1BsYWNlaG9sZGVyKSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byB0cmFuc2xhdGUgdGhlIGxpbmsgcGxhY2Vob2xkZXIgJyIgKyBsaW5rUGxhY2Vob2xkZXIgKyAiJyB3aXRoIHJvb3QgbG9jYWxlLiIpOwogICAgICB9CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICAgIH0KCiAgICAgIHZhciByb290ID0gdGhpcy5fcm9vdC4kaTE4bjsKICAgICAgdHJhbnNsYXRlZCA9IHJvb3QuX3RyYW5zbGF0ZShyb290Ll9nZXRNZXNzYWdlcygpLCByb290LmxvY2FsZSwgcm9vdC5mYWxsYmFja0xvY2FsZSwgbGlua1BsYWNlaG9sZGVyLCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcyk7CiAgICB9CgogICAgdHJhbnNsYXRlZCA9IHRoaXMuX3dhcm5EZWZhdWx0KGxvY2FsZSwgbGlua1BsYWNlaG9sZGVyLCB0cmFuc2xhdGVkLCBob3N0LCBpc0FycmF5KHZhbHVlcykgPyB2YWx1ZXMgOiBbdmFsdWVzXSwgaW50ZXJwb2xhdGVNb2RlKTsKCiAgICBpZiAodGhpcy5fbW9kaWZpZXJzLmhhc093blByb3BlcnR5KGZvcm1hdHRlck5hbWUpKSB7CiAgICAgIHRyYW5zbGF0ZWQgPSB0aGlzLl9tb2RpZmllcnNbZm9ybWF0dGVyTmFtZV0odHJhbnNsYXRlZCk7CiAgICB9IGVsc2UgaWYgKGRlZmF1bHRNb2RpZmllcnMuaGFzT3duUHJvcGVydHkoZm9ybWF0dGVyTmFtZSkpIHsKICAgICAgdHJhbnNsYXRlZCA9IGRlZmF1bHRNb2RpZmllcnNbZm9ybWF0dGVyTmFtZV0odHJhbnNsYXRlZCk7CiAgICB9CgogICAgdmlzaXRlZExpbmtTdGFjay5wb3AoKTsgLy8gUmVwbGFjZSB0aGUgbGluayB3aXRoIHRoZSB0cmFuc2xhdGVkCgogICAgcmV0ID0gIXRyYW5zbGF0ZWQgPyByZXQgOiByZXQucmVwbGFjZShsaW5rLCB0cmFuc2xhdGVkKTsKICB9CgogIHJldHVybiByZXQ7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fY3JlYXRlTWVzc2FnZUNvbnRleHQgPSBmdW5jdGlvbiBfY3JlYXRlTWVzc2FnZUNvbnRleHQodmFsdWVzKSB7CiAgdmFyIF9saXN0ID0gaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW107CgogIHZhciBfbmFtZWQgPSBpc09iamVjdCh2YWx1ZXMpID8gdmFsdWVzIDoge307CgogIHZhciBsaXN0ID0gZnVuY3Rpb24gbGlzdChpbmRleCkgewogICAgcmV0dXJuIF9saXN0W2luZGV4XTsKICB9OwoKICB2YXIgbmFtZWQgPSBmdW5jdGlvbiBuYW1lZChrZXkpIHsKICAgIHJldHVybiBfbmFtZWRba2V5XTsKICB9OwoKICByZXR1cm4gewogICAgbGlzdDogbGlzdCwKICAgIG5hbWVkOiBuYW1lZAogIH07Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gX3JlbmRlcihtZXNzYWdlLCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywgcGF0aCkgewogIGlmIChpc0Z1bmN0aW9uKG1lc3NhZ2UpKSB7CiAgICByZXR1cm4gbWVzc2FnZSh0aGlzLl9jcmVhdGVNZXNzYWdlQ29udGV4dCh2YWx1ZXMpKTsKICB9CgogIHZhciByZXQgPSB0aGlzLl9mb3JtYXR0ZXIuaW50ZXJwb2xhdGUobWVzc2FnZSwgdmFsdWVzLCBwYXRoKTsgLy8gSWYgdGhlIGN1c3RvbSBmb3JtYXR0ZXIgcmVmdXNlcyB0byB3b3JrIC0gYXBwbHkgdGhlIGRlZmF1bHQgb25lCgoKICBpZiAoIXJldCkgewogICAgcmV0ID0gZGVmYXVsdEZvcm1hdHRlci5pbnRlcnBvbGF0ZShtZXNzYWdlLCB2YWx1ZXMsIHBhdGgpOwogIH0gLy8gaWYgaW50ZXJwb2xhdGVNb2RlIGlzICoqbm90KiogJ3N0cmluZycgKCdyb3cnKSwKICAvLyByZXR1cm4gdGhlIGNvbXBpbGVkIGRhdGEgKGUuZy4gWydmb28nLCBWTm9kZSwgJ2JhciddKSB3aXRoIGZvcm1hdHRlcgoKCiAgcmV0dXJuIGludGVycG9sYXRlTW9kZSA9PT0gJ3N0cmluZycgJiYgIWlzU3RyaW5nKHJldCkgPyByZXQuam9pbignJykgOiByZXQ7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fYXBwZW5kSXRlbVRvQ2hhaW4gPSBmdW5jdGlvbiBfYXBwZW5kSXRlbVRvQ2hhaW4oY2hhaW4sIGl0ZW0sIGJsb2NrcykgewogIHZhciBmb2xsb3cgPSBmYWxzZTsKCiAgaWYgKCFpbmNsdWRlcyhjaGFpbiwgaXRlbSkpIHsKICAgIGZvbGxvdyA9IHRydWU7CgogICAgaWYgKGl0ZW0pIHsKICAgICAgZm9sbG93ID0gaXRlbVtpdGVtLmxlbmd0aCAtIDFdICE9PSAnISc7CiAgICAgIGl0ZW0gPSBpdGVtLnJlcGxhY2UoLyEvZywgJycpOwogICAgICBjaGFpbi5wdXNoKGl0ZW0pOwoKICAgICAgaWYgKGJsb2NrcyAmJiBibG9ja3NbaXRlbV0pIHsKICAgICAgICBmb2xsb3cgPSBibG9ja3NbaXRlbV07CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBmb2xsb3c7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fYXBwZW5kTG9jYWxlVG9DaGFpbiA9IGZ1bmN0aW9uIF9hcHBlbmRMb2NhbGVUb0NoYWluKGNoYWluLCBsb2NhbGUsIGJsb2NrcykgewogIHZhciBmb2xsb3c7CiAgdmFyIHRva2VucyA9IGxvY2FsZS5zcGxpdCgnLScpOwoKICBkbyB7CiAgICB2YXIgaXRlbSA9IHRva2Vucy5qb2luKCctJyk7CiAgICBmb2xsb3cgPSB0aGlzLl9hcHBlbmRJdGVtVG9DaGFpbihjaGFpbiwgaXRlbSwgYmxvY2tzKTsKICAgIHRva2Vucy5zcGxpY2UoLTEsIDEpOwogIH0gd2hpbGUgKHRva2Vucy5sZW5ndGggJiYgZm9sbG93ID09PSB0cnVlKTsKCiAgcmV0dXJuIGZvbGxvdzsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9hcHBlbmRCbG9ja1RvQ2hhaW4gPSBmdW5jdGlvbiBfYXBwZW5kQmxvY2tUb0NoYWluKGNoYWluLCBibG9jaywgYmxvY2tzKSB7CiAgdmFyIGZvbGxvdyA9IHRydWU7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2subGVuZ3RoICYmIGlzQm9vbGVhbihmb2xsb3cpOyBpKyspIHsKICAgIHZhciBsb2NhbGUgPSBibG9ja1tpXTsKCiAgICBpZiAoaXNTdHJpbmcobG9jYWxlKSkgewogICAgICBmb2xsb3cgPSB0aGlzLl9hcHBlbmRMb2NhbGVUb0NoYWluKGNoYWluLCBsb2NhbGUsIGJsb2Nrcyk7CiAgICB9CiAgfQoKICByZXR1cm4gZm9sbG93Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldExvY2FsZUNoYWluID0gZnVuY3Rpb24gX2dldExvY2FsZUNoYWluKHN0YXJ0LCBmYWxsYmFja0xvY2FsZSkgewogIGlmIChzdGFydCA9PT0gJycpIHsKICAgIHJldHVybiBbXTsKICB9CgogIGlmICghdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSkgewogICAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSA9IHt9OwogIH0KCiAgdmFyIGNoYWluID0gdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZVtzdGFydF07CgogIGlmICghY2hhaW4pIHsKICAgIGlmICghZmFsbGJhY2tMb2NhbGUpIHsKICAgICAgZmFsbGJhY2tMb2NhbGUgPSB0aGlzLmZhbGxiYWNrTG9jYWxlOwogICAgfQoKICAgIGNoYWluID0gW107IC8vIGZpcnN0IGJsb2NrIGRlZmluZWQgYnkgc3RhcnQKCiAgICB2YXIgYmxvY2sgPSBbc3RhcnRdOyAvLyB3aGlsZSBhbnkgaW50ZXJ2ZW5pbmcgYmxvY2sgZm91bmQKCiAgICB3aGlsZSAoaXNBcnJheShibG9jaykpIHsKICAgICAgYmxvY2sgPSB0aGlzLl9hcHBlbmRCbG9ja1RvQ2hhaW4oY2hhaW4sIGJsb2NrLCBmYWxsYmFja0xvY2FsZSk7CiAgICB9IC8vIGxhc3QgYmxvY2sgZGVmaW5lZCBieSBkZWZhdWx0CgoKICAgIHZhciBkZWZhdWx0czsKCiAgICBpZiAoaXNBcnJheShmYWxsYmFja0xvY2FsZSkpIHsKICAgICAgZGVmYXVsdHMgPSBmYWxsYmFja0xvY2FsZTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoZmFsbGJhY2tMb2NhbGUpKSB7CiAgICAgIC8qICRGbG93Rml4TWUgKi8KICAgICAgaWYgKGZhbGxiYWNrTG9jYWxlWydkZWZhdWx0J10pIHsKICAgICAgICBkZWZhdWx0cyA9IGZhbGxiYWNrTG9jYWxlWydkZWZhdWx0J107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVmYXVsdHMgPSBudWxsOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkZWZhdWx0cyA9IGZhbGxiYWNrTG9jYWxlOwogICAgfSAvLyBjb252ZXJ0IGRlZmF1bHRzIHRvIGFycmF5CgoKICAgIGlmIChpc1N0cmluZyhkZWZhdWx0cykpIHsKICAgICAgYmxvY2sgPSBbZGVmYXVsdHNdOwogICAgfSBlbHNlIHsKICAgICAgYmxvY2sgPSBkZWZhdWx0czsKICAgIH0KCiAgICBpZiAoYmxvY2spIHsKICAgICAgdGhpcy5fYXBwZW5kQmxvY2tUb0NoYWluKGNoYWluLCBibG9jaywgbnVsbCk7CiAgICB9CgogICAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZVtzdGFydF0gPSBjaGFpbjsKICB9CgogIHJldHVybiBjaGFpbjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90cmFuc2xhdGUgPSBmdW5jdGlvbiBfdHJhbnNsYXRlKG1lc3NhZ2VzLCBsb2NhbGUsIGZhbGxiYWNrLCBrZXksIGhvc3QsIGludGVycG9sYXRlTW9kZSwgYXJncykgewogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICB2YXIgcmVzOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgcmVzID0gdGhpcy5faW50ZXJwb2xhdGUoc3RlcCwgbWVzc2FnZXNbc3RlcF0sIGtleSwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCBhcmdzLCBba2V5XSk7CgogICAgaWYgKCFpc051bGwocmVzKSkgewogICAgICBpZiAoc3RlcCAhPT0gbG9jYWxlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCAnIiArIHN0ZXAgKyAiJyBsb2NhbGUuIik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90ID0gZnVuY3Rpb24gX3Qoa2V5LCBfbG9jYWxlLCBtZXNzYWdlcywgaG9zdCkgewogIHZhciByZWY7CiAgdmFyIHZhbHVlcyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gNDsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgdmFsdWVzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgNF07CiAgfQoKICBpZiAoIWtleSkgewogICAgcmV0dXJuICcnOwogIH0KCiAgdmFyIHBhcnNlZEFyZ3MgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCB2YWx1ZXMpOwoKICBpZiAodGhpcy5fZXNjYXBlUGFyYW1ldGVySHRtbCkgewogICAgcGFyc2VkQXJncy5wYXJhbXMgPSBlc2NhcGVQYXJhbXMocGFyc2VkQXJncy5wYXJhbXMpOwogIH0KCiAgdmFyIGxvY2FsZSA9IHBhcnNlZEFyZ3MubG9jYWxlIHx8IF9sb2NhbGU7CgogIHZhciByZXQgPSB0aGlzLl90cmFuc2xhdGUobWVzc2FnZXMsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwga2V5LCBob3N0LCAnc3RyaW5nJywgcGFyc2VkQXJncy5wYXJhbXMpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIHRyYW5zbGF0ZSB0aGUga2V5cGF0aCAnIiArIGtleSArICInIHdpdGggcm9vdCBsb2NhbGUuIik7CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICB9CgogICAgcmV0dXJuIChyZWYgPSB0aGlzLl9yb290KS4kdC5hcHBseShyZWYsIFtrZXldLmNvbmNhdCh2YWx1ZXMpKTsKICB9IGVsc2UgewogICAgcmV0ID0gdGhpcy5fd2FybkRlZmF1bHQobG9jYWxlLCBrZXksIHJldCwgaG9zdCwgdmFsdWVzLCAnc3RyaW5nJyk7CgogICAgaWYgKHRoaXMuX3Bvc3RUcmFuc2xhdGlvbiAmJiByZXQgIT09IG51bGwgJiYgcmV0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0ID0gdGhpcy5fcG9zdFRyYW5zbGF0aW9uKHJldCwga2V5KTsKICAgIH0KCiAgICByZXR1cm4gcmV0OwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnQgPSBmdW5jdGlvbiB0KGtleSkgewogIHZhciByZWY7CiAgdmFyIHZhbHVlcyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgdmFsdWVzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CiAgfQoKICByZXR1cm4gKHJlZiA9IHRoaXMpLl90LmFwcGx5KHJlZiwgW2tleSwgdGhpcy5sb2NhbGUsIHRoaXMuX2dldE1lc3NhZ2VzKCksIG51bGxdLmNvbmNhdCh2YWx1ZXMpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pID0gZnVuY3Rpb24gX2koa2V5LCBsb2NhbGUsIG1lc3NhZ2VzLCBob3N0LCB2YWx1ZXMpIHsKICB2YXIgcmV0ID0gdGhpcy5fdHJhbnNsYXRlKG1lc3NhZ2VzLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIGtleSwgaG9zdCwgJ3JhdycsIHZhbHVlcyk7CgogIGlmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdChyZXQpKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSkgewogICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gaW50ZXJwb2xhdGUgdGhlIGtleXBhdGggJyIgKyBrZXkgKyAiJyB3aXRoIHJvb3QgbG9jYWxlLiIpOwogICAgfQoKICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9yb290LiRpMThuLmkoa2V5LCBsb2NhbGUsIHZhbHVlcyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiB0aGlzLl93YXJuRGVmYXVsdChsb2NhbGUsIGtleSwgcmV0LCBob3N0LCBbdmFsdWVzXSwgJ3JhdycpOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmkgPSBmdW5jdGlvbiBpKGtleSwgbG9jYWxlLCB2YWx1ZXMpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAoIWtleSkgewogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKCFpc1N0cmluZyhsb2NhbGUpKSB7CiAgICBsb2NhbGUgPSB0aGlzLmxvY2FsZTsKICB9CgogIHJldHVybiB0aGlzLl9pKGtleSwgbG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBudWxsLCB2YWx1ZXMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3RjID0gZnVuY3Rpb24gX3RjKGtleSwgX2xvY2FsZSwgbWVzc2FnZXMsIGhvc3QsIGNob2ljZSkgewogIHZhciByZWY7CiAgdmFyIHZhbHVlcyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gNTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgdmFsdWVzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgNV07CiAgfQoKICBpZiAoIWtleSkgewogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKGNob2ljZSA9PT0gdW5kZWZpbmVkKSB7CiAgICBjaG9pY2UgPSAxOwogIH0KCiAgdmFyIHByZWRlZmluZWQgPSB7CiAgICAnY291bnQnOiBjaG9pY2UsCiAgICAnbic6IGNob2ljZQogIH07CiAgdmFyIHBhcnNlZEFyZ3MgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCB2YWx1ZXMpOwogIHBhcnNlZEFyZ3MucGFyYW1zID0gT2JqZWN0LmFzc2lnbihwcmVkZWZpbmVkLCBwYXJzZWRBcmdzLnBhcmFtcyk7CiAgdmFsdWVzID0gcGFyc2VkQXJncy5sb2NhbGUgPT09IG51bGwgPyBbcGFyc2VkQXJncy5wYXJhbXNdIDogW3BhcnNlZEFyZ3MubG9jYWxlLCBwYXJzZWRBcmdzLnBhcmFtc107CiAgcmV0dXJuIHRoaXMuZmV0Y2hDaG9pY2UoKHJlZiA9IHRoaXMpLl90LmFwcGx5KHJlZiwgW2tleSwgX2xvY2FsZSwgbWVzc2FnZXMsIGhvc3RdLmNvbmNhdCh2YWx1ZXMpKSwgY2hvaWNlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmZldGNoQ2hvaWNlID0gZnVuY3Rpb24gZmV0Y2hDaG9pY2UobWVzc2FnZSwgY2hvaWNlKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFtZXNzYWdlIHx8ICFpc1N0cmluZyhtZXNzYWdlKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgY2hvaWNlcyA9IG1lc3NhZ2Uuc3BsaXQoJ3wnKTsKICBjaG9pY2UgPSB0aGlzLmdldENob2ljZUluZGV4KGNob2ljZSwgY2hvaWNlcy5sZW5ndGgpOwoKICBpZiAoIWNob2ljZXNbY2hvaWNlXSkgewogICAgcmV0dXJuIG1lc3NhZ2U7CiAgfQoKICByZXR1cm4gY2hvaWNlc1tjaG9pY2VdLnRyaW0oKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnRjID0gZnVuY3Rpb24gdGMoa2V5LCBjaG9pY2UpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDJdOwogIH0KCiAgcmV0dXJuIChyZWYgPSB0aGlzKS5fdGMuYXBwbHkocmVmLCBba2V5LCB0aGlzLmxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbnVsbCwgY2hvaWNlXS5jb25jYXQodmFsdWVzKSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fdGUgPSBmdW5jdGlvbiBfdGUoa2V5LCBsb2NhbGUsIG1lc3NhZ2VzKSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDM7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAzXTsKICB9CgogIHZhciBfbG9jYWxlID0gcGFyc2VBcmdzLmFwcGx5KHZvaWQgMCwgYXJncykubG9jYWxlIHx8IGxvY2FsZTsKCiAgcmV0dXJuIHRoaXMuX2V4aXN0KG1lc3NhZ2VzW19sb2NhbGVdLCBrZXkpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUudGUgPSBmdW5jdGlvbiB0ZShrZXksIGxvY2FsZSkgewogIHJldHVybiB0aGlzLl90ZShrZXksIHRoaXMubG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBsb2NhbGUpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZ2V0TG9jYWxlTWVzc2FnZSA9IGZ1bmN0aW9uIGdldExvY2FsZU1lc3NhZ2UobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0ubWVzc2FnZXNbbG9jYWxlXSB8fCB7fSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5zZXRMb2NhbGVNZXNzYWdlID0gZnVuY3Rpb24gc2V0TG9jYWxlTWVzc2FnZShsb2NhbGUsIG1lc3NhZ2UpIHsKICBpZiAodGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICd3YXJuJyB8fCB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9PT0gJ2Vycm9yJykgewogICAgdGhpcy5fY2hlY2tMb2NhbGVNZXNzYWdlKGxvY2FsZSwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UsIG1lc3NhZ2UpOwogIH0KCiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5tZXNzYWdlcywgbG9jYWxlLCBtZXNzYWdlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLm1lcmdlTG9jYWxlTWVzc2FnZSA9IGZ1bmN0aW9uIG1lcmdlTG9jYWxlTWVzc2FnZShsb2NhbGUsIG1lc3NhZ2UpIHsKICBpZiAodGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICd3YXJuJyB8fCB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9PT0gJ2Vycm9yJykgewogICAgdGhpcy5fY2hlY2tMb2NhbGVNZXNzYWdlKGxvY2FsZSwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UsIG1lc3NhZ2UpOwogIH0KCiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5tZXNzYWdlcywgbG9jYWxlLCBtZXJnZSh0eXBlb2YgdGhpcy5fdm0ubWVzc2FnZXNbbG9jYWxlXSAhPT0gJ3VuZGVmaW5lZCcgJiYgT2JqZWN0LmtleXModGhpcy5fdm0ubWVzc2FnZXNbbG9jYWxlXSkubGVuZ3RoID8gdGhpcy5fdm0ubWVzc2FnZXNbbG9jYWxlXSA6IHt9LCBtZXNzYWdlKSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5nZXREYXRlVGltZUZvcm1hdCA9IGZ1bmN0aW9uIGdldERhdGVUaW1lRm9ybWF0KGxvY2FsZSkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0c1tsb2NhbGVdIHx8IHt9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnNldERhdGVUaW1lRm9ybWF0ID0gZnVuY3Rpb24gc2V0RGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0cywgbG9jYWxlLCBmb3JtYXQpOwoKICB0aGlzLl9jbGVhckRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgZm9ybWF0KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLm1lcmdlRGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBtZXJnZURhdGVUaW1lRm9ybWF0KGxvY2FsZSwgZm9ybWF0KSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5kYXRlVGltZUZvcm1hdHMsIGxvY2FsZSwgbWVyZ2UodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzW2xvY2FsZV0gfHwge30sIGZvcm1hdCkpOwoKICB0aGlzLl9jbGVhckRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgZm9ybWF0KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jbGVhckRhdGVUaW1lRm9ybWF0ID0gZnVuY3Rpb24gX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICBmb3IgKHZhciBrZXkgaW4gZm9ybWF0KSB7CiAgICB2YXIgaWQgPSBsb2NhbGUgKyAiX18iICsga2V5OwoKICAgIGlmICghdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBkZWxldGUgdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzW2lkXTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fbG9jYWxpemVEYXRlVGltZSA9IGZ1bmN0aW9uIF9sb2NhbGl6ZURhdGVUaW1lKHZhbHVlLCBsb2NhbGUsIGZhbGxiYWNrLCBkYXRlVGltZUZvcm1hdHMsIGtleSkgewogIHZhciBfbG9jYWxlID0gbG9jYWxlOwogIHZhciBmb3JtYXRzID0gZGF0ZVRpbWVGb3JtYXRzW19sb2NhbGVdOwoKICB2YXIgY2hhaW4gPSB0aGlzLl9nZXRMb2NhbGVDaGFpbihsb2NhbGUsIGZhbGxiYWNrKTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFpbi5sZW5ndGg7IGkrKykgewogICAgdmFyIGN1cnJlbnQgPSBfbG9jYWxlOwogICAgdmFyIHN0ZXAgPSBjaGFpbltpXTsKICAgIGZvcm1hdHMgPSBkYXRlVGltZUZvcm1hdHNbc3RlcF07CiAgICBfbG9jYWxlID0gc3RlcDsgLy8gZmFsbGJhY2sgbG9jYWxlCgogICAgaWYgKGlzTnVsbChmb3JtYXRzKSB8fCBpc051bGwoZm9ybWF0c1trZXldKSkgewogICAgICBpZiAoc3RlcCAhPT0gbG9jYWxlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gJyIgKyBzdGVwICsgIicgZGF0ZXRpbWUgZm9ybWF0cyBmcm9tICciICsgY3VycmVudCArICInIGRhdGV0aW1lIGZvcm1hdHMuIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgaWYgKGlzTnVsbChmb3JtYXRzKSB8fCBpc051bGwoZm9ybWF0c1trZXldKSkgewogICAgcmV0dXJuIG51bGw7CiAgfSBlbHNlIHsKICAgIHZhciBmb3JtYXQgPSBmb3JtYXRzW2tleV07CiAgICB2YXIgaWQgPSBfbG9jYWxlICsgIl9fIiArIGtleTsKICAgIHZhciBmb3JtYXR0ZXIgPSB0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnNbaWRdOwoKICAgIGlmICghZm9ybWF0dGVyKSB7CiAgICAgIGZvcm1hdHRlciA9IHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVyc1tpZF0gPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChfbG9jYWxlLCBmb3JtYXQpOwogICAgfQoKICAgIHJldHVybiBmb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZCA9IGZ1bmN0aW9uIF9kKHZhbHVlLCBsb2NhbGUsIGtleSkgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICFWdWVJMThuLmF2YWlsYWJpbGl0aWVzLmRhdGVUaW1lRm9ybWF0KSB7CiAgICB3YXJuKCdDYW5ub3QgZm9ybWF0IGEgRGF0ZSB2YWx1ZSBkdWUgdG8gbm90IHN1cHBvcnRlZCBJbnRsLkRhdGVUaW1lRm9ybWF0LicpOwogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHJldHVybiBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUpLmZvcm1hdCh2YWx1ZSk7CiAgfQoKICB2YXIgcmV0ID0gdGhpcy5fbG9jYWxpemVEYXRlVGltZSh2YWx1ZSwgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCB0aGlzLl9nZXREYXRlVGltZUZvcm1hdHMoKSwga2V5KTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byBkYXRldGltZSBsb2NhbGl6YXRpb24gb2Ygcm9vdDoga2V5ICciICsga2V5ICsgIicuIik7CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4uZCh2YWx1ZSwga2V5LCBsb2NhbGUpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcmV0IHx8ICcnOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmQgPSBmdW5jdGlvbiBkKHZhbHVlKSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICB9CgogIHZhciBsb2NhbGUgPSB0aGlzLmxvY2FsZTsKICB2YXIga2V5ID0gbnVsbDsKCiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7CiAgICBpZiAoaXNTdHJpbmcoYXJnc1swXSkpIHsKICAgICAga2V5ID0gYXJnc1swXTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoYXJnc1swXSkpIHsKICAgICAgaWYgKGFyZ3NbMF0ubG9jYWxlKSB7CiAgICAgICAgbG9jYWxlID0gYXJnc1swXS5sb2NhbGU7CiAgICAgIH0KCiAgICAgIGlmIChhcmdzWzBdLmtleSkgewogICAgICAgIGtleSA9IGFyZ3NbMF0ua2V5OwogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMikgewogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMF0pKSB7CiAgICAgIGtleSA9IGFyZ3NbMF07CiAgICB9CgogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMV0pKSB7CiAgICAgIGxvY2FsZSA9IGFyZ3NbMV07CiAgICB9CiAgfQoKICByZXR1cm4gdGhpcy5fZCh2YWx1ZSwgbG9jYWxlLCBrZXkpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZ2V0TnVtYmVyRm9ybWF0ID0gZnVuY3Rpb24gZ2V0TnVtYmVyRm9ybWF0KGxvY2FsZSkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX3ZtLm51bWJlckZvcm1hdHNbbG9jYWxlXSB8fCB7fSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5zZXROdW1iZXJGb3JtYXQgPSBmdW5jdGlvbiBzZXROdW1iZXJGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLm51bWJlckZvcm1hdHMsIGxvY2FsZSwgZm9ybWF0KTsKCiAgdGhpcy5fY2xlYXJOdW1iZXJGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUubWVyZ2VOdW1iZXJGb3JtYXQgPSBmdW5jdGlvbiBtZXJnZU51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubnVtYmVyRm9ybWF0cywgbG9jYWxlLCBtZXJnZSh0aGlzLl92bS5udW1iZXJGb3JtYXRzW2xvY2FsZV0gfHwge30sIGZvcm1hdCkpOwoKICB0aGlzLl9jbGVhck51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fY2xlYXJOdW1iZXJGb3JtYXQgPSBmdW5jdGlvbiBfY2xlYXJOdW1iZXJGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICBmb3IgKHZhciBrZXkgaW4gZm9ybWF0KSB7CiAgICB2YXIgaWQgPSBsb2NhbGUgKyAiX18iICsga2V5OwoKICAgIGlmICghdGhpcy5fbnVtYmVyRm9ybWF0dGVycy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgZGVsZXRlIHRoaXMuX251bWJlckZvcm1hdHRlcnNbaWRdOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXROdW1iZXJGb3JtYXR0ZXIgPSBmdW5jdGlvbiBfZ2V0TnVtYmVyRm9ybWF0dGVyKHZhbHVlLCBsb2NhbGUsIGZhbGxiYWNrLCBudW1iZXJGb3JtYXRzLCBrZXksIG9wdGlvbnMpIHsKICB2YXIgX2xvY2FsZSA9IGxvY2FsZTsKICB2YXIgZm9ybWF0cyA9IG51bWJlckZvcm1hdHNbX2xvY2FsZV07CgogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY3VycmVudCA9IF9sb2NhbGU7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgZm9ybWF0cyA9IG51bWJlckZvcm1hdHNbc3RlcF07CiAgICBfbG9jYWxlID0gc3RlcDsgLy8gZmFsbGJhY2sgbG9jYWxlCgogICAgaWYgKGlzTnVsbChmb3JtYXRzKSB8fCBpc051bGwoZm9ybWF0c1trZXldKSkgewogICAgICBpZiAoc3RlcCAhPT0gbG9jYWxlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gJyIgKyBzdGVwICsgIicgbnVtYmVyIGZvcm1hdHMgZnJvbSAnIiArIGN1cnJlbnQgKyAiJyBudW1iZXIgZm9ybWF0cy4iKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICByZXR1cm4gbnVsbDsKICB9IGVsc2UgewogICAgdmFyIGZvcm1hdCA9IGZvcm1hdHNba2V5XTsKICAgIHZhciBmb3JtYXR0ZXI7CgogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgLy8gSWYgb3B0aW9ucyBzcGVjaWZpZWQgLSBjcmVhdGUgb25lIHRpbWUgbnVtYmVyIGZvcm1hdHRlcgogICAgICBmb3JtYXR0ZXIgPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoX2xvY2FsZSwgT2JqZWN0LmFzc2lnbih7fSwgZm9ybWF0LCBvcHRpb25zKSk7CiAgICB9IGVsc2UgewogICAgICB2YXIgaWQgPSBfbG9jYWxlICsgIl9fIiArIGtleTsKICAgICAgZm9ybWF0dGVyID0gdGhpcy5fbnVtYmVyRm9ybWF0dGVyc1tpZF07CgogICAgICBpZiAoIWZvcm1hdHRlcikgewogICAgICAgIGZvcm1hdHRlciA9IHRoaXMuX251bWJlckZvcm1hdHRlcnNbaWRdID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KF9sb2NhbGUsIGZvcm1hdCk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZm9ybWF0dGVyOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9uID0gZnVuY3Rpb24gX24odmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFWdWVJMThuLmF2YWlsYWJpbGl0aWVzLm51bWJlckZvcm1hdCkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgd2FybignQ2Fubm90IGZvcm1hdCBhIE51bWJlciB2YWx1ZSBkdWUgdG8gbm90IHN1cHBvcnRlZCBJbnRsLk51bWJlckZvcm1hdC4nKTsKICAgIH0KCiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoIWtleSkgewogICAgdmFyIG5mID0gIW9wdGlvbnMgPyBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlKSA6IG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIG9wdGlvbnMpOwogICAgcmV0dXJuIG5mLmZvcm1hdCh2YWx1ZSk7CiAgfQoKICB2YXIgZm9ybWF0dGVyID0gdGhpcy5fZ2V0TnVtYmVyRm9ybWF0dGVyKHZhbHVlLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIHRoaXMuX2dldE51bWJlckZvcm1hdHMoKSwga2V5LCBvcHRpb25zKTsKCiAgdmFyIHJldCA9IGZvcm1hdHRlciAmJiBmb3JtYXR0ZXIuZm9ybWF0KHZhbHVlKTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byBudW1iZXIgbG9jYWxpemF0aW9uIG9mIHJvb3Q6IGtleSAnIiArIGtleSArICInLiIpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9yb290LiRpMThuLm4odmFsdWUsIE9iamVjdC5hc3NpZ24oe30sIHsKICAgICAga2V5OiBrZXksCiAgICAgIGxvY2FsZTogbG9jYWxlCiAgICB9LCBvcHRpb25zKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgJyc7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUubiA9IGZ1bmN0aW9uIG4odmFsdWUpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogIH0KCiAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlOwogIHZhciBrZXkgPSBudWxsOwogIHZhciBvcHRpb25zID0gbnVsbDsKCiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7CiAgICBpZiAoaXNTdHJpbmcoYXJnc1swXSkpIHsKICAgICAga2V5ID0gYXJnc1swXTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoYXJnc1swXSkpIHsKICAgICAgaWYgKGFyZ3NbMF0ubG9jYWxlKSB7CiAgICAgICAgbG9jYWxlID0gYXJnc1swXS5sb2NhbGU7CiAgICAgIH0KCiAgICAgIGlmIChhcmdzWzBdLmtleSkgewogICAgICAgIGtleSA9IGFyZ3NbMF0ua2V5OwogICAgICB9IC8vIEZpbHRlciBvdXQgbnVtYmVyIGZvcm1hdCBvcHRpb25zIG9ubHkKCgogICAgICBvcHRpb25zID0gT2JqZWN0LmtleXMoYXJnc1swXSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkgewogICAgICAgIHZhciBvYmo7CgogICAgICAgIGlmIChpbmNsdWRlcyhudW1iZXJGb3JtYXRLZXlzLCBrZXkpKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgYWNjLCAob2JqID0ge30sIG9ialtrZXldID0gYXJnc1swXVtrZXldLCBvYmopKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0sIG51bGwpOwogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfQoKICAgIGlmIChpc1N0cmluZyhhcmdzWzFdKSkgewogICAgICBsb2NhbGUgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHRoaXMuX24odmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9udHAgPSBmdW5jdGlvbiBfbnRwKHZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucykgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICghVnVlSTE4bi5hdmFpbGFiaWxpdGllcy5udW1iZXJGb3JtYXQpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgdG8gcGFydHMgYSBOdW1iZXIgdmFsdWUgZHVlIHRvIG5vdCBzdXBwb3J0ZWQgSW50bC5OdW1iZXJGb3JtYXQuJyk7CiAgICB9CgogICAgcmV0dXJuIFtdOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHZhciBuZiA9ICFvcHRpb25zID8gbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSkgOiBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlLCBvcHRpb25zKTsKICAgIHJldHVybiBuZi5mb3JtYXRUb1BhcnRzKHZhbHVlKTsKICB9CgogIHZhciBmb3JtYXR0ZXIgPSB0aGlzLl9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwgdGhpcy5fZ2V0TnVtYmVyRm9ybWF0cygpLCBrZXksIG9wdGlvbnMpOwoKICB2YXIgcmV0ID0gZm9ybWF0dGVyICYmIGZvcm1hdHRlci5mb3JtYXRUb1BhcnRzKHZhbHVlKTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byBmb3JtYXQgbnVtYmVyIHRvIHBhcnRzIG9mIHJvb3Q6IGtleSAnIiArIGtleSArICInIC4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5fbnRwKHZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgW107CiAgfQp9OwoKT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoVnVlSTE4bi5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyk7CnZhciBhdmFpbGFiaWxpdGllczsgLy8gJEZsb3dGaXhNZQoKT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZUkxOG4sICdhdmFpbGFiaWxpdGllcycsIHsKICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgIGlmICghYXZhaWxhYmlsaXRpZXMpIHsKICAgICAgdmFyIGludGxEZWZpbmVkID0gdHlwZW9mIEludGwgIT09ICd1bmRlZmluZWQnOwogICAgICBhdmFpbGFiaWxpdGllcyA9IHsKICAgICAgICBkYXRlVGltZUZvcm1hdDogaW50bERlZmluZWQgJiYgdHlwZW9mIEludGwuRGF0ZVRpbWVGb3JtYXQgIT09ICd1bmRlZmluZWQnLAogICAgICAgIG51bWJlckZvcm1hdDogaW50bERlZmluZWQgJiYgdHlwZW9mIEludGwuTnVtYmVyRm9ybWF0ICE9PSAndW5kZWZpbmVkJwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBhdmFpbGFiaWxpdGllczsKICB9Cn0pOwpWdWVJMThuLmluc3RhbGwgPSBpbnN0YWxsOwpWdWVJMThuLnZlcnNpb24gPSAnOC4yMi40JzsKZXhwb3J0IGRlZmF1bHQgVnVlSTE4bjs="},null]}