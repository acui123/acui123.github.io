{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\@vssue\\api-github-v4\\lib\\index.js","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\@vssue\\api-github-v4\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\qd\\blog\\vuepress-blog-demo\\xcui-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvcWQvYmxvZy92dWVwcmVzcy1ibG9nLWRlbW8veGN1aS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvcWQvYmxvZy92dWVwcmVzcy1ibG9nLWRlbW8veGN1aS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJDOi9Vc2Vycy9BZG1pbmlzdHJhdG9yL0Rlc2t0b3AvcWQvYmxvZy92dWVwcmVzcy1ibG9nLWRlbW8veGN1aS1ibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiQzovVXNlcnMvQWRtaW5pc3RyYXRvci9EZXNrdG9wL3FkL2Jsb2cvdnVlcHJlc3MtYmxvZy1kZW1vL3hjdWktYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5jb25jYXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZXZlcnNlLmpzIjsKaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsKaW1wb3J0IHsgYnVpbGRVUkwsIGNvbmNhdFVSTCwgZ2V0Q2xlYW5VUkwsIHBhcnNlUXVlcnkgfSBmcm9tICdAdnNzdWUvdXRpbHMnOwppbXBvcnQgeyBub3JtYWxpemVVc2VyLCBub3JtYWxpemVJc3N1ZSwgbm9ybWFsaXplQ29tbWVudCwgbm9ybWFsaXplUmVhY3Rpb25zLCBtYXBSZWFjdGlvbk5hbWUgfSBmcm9tICcuL3V0aWxzJzsKLyoqCiAqIEdpdGh1YiBHcmFwaFFMIEFQSSB2NAogKgogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvCiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9leHBsb3Jlci8KICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy8KICovCgp2YXIgR2l0aHViVjQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEdpdGh1YlY0KF9yZWYpIHsKICAgIHZhciBfcmVmJGJhc2VVUkwgPSBfcmVmLmJhc2VVUkwsCiAgICAgICAgYmFzZVVSTCA9IF9yZWYkYmFzZVVSTCA9PT0gdm9pZCAwID8gJ2h0dHBzOi8vZ2l0aHViLmNvbScgOiBfcmVmJGJhc2VVUkwsCiAgICAgICAgb3duZXIgPSBfcmVmLm93bmVyLAogICAgICAgIHJlcG8gPSBfcmVmLnJlcG8sCiAgICAgICAgbGFiZWxzID0gX3JlZi5sYWJlbHMsCiAgICAgICAgY2xpZW50SWQgPSBfcmVmLmNsaWVudElkLAogICAgICAgIGNsaWVudFNlY3JldCA9IF9yZWYuY2xpZW50U2VjcmV0LAogICAgICAgIHN0YXRlID0gX3JlZi5zdGF0ZSwKICAgICAgICBwcm94eSA9IF9yZWYucHJveHk7CgogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEdpdGh1YlY0KTsKCiAgICBpZiAodHlwZW9mIGNsaWVudFNlY3JldCA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb3h5ID09PSAndW5kZWZpbmVkJykgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NsaWVudFNlY3JldCBhbmQgcHJveHkgaXMgcmVxdWlyZWQgZm9yIEdpdEh1YiBWNCcpOwogICAgfQoKICAgIHRoaXMuYmFzZVVSTCA9IGJhc2VVUkw7CiAgICB0aGlzLm93bmVyID0gb3duZXI7CiAgICB0aGlzLnJlcG8gPSByZXBvOwogICAgdGhpcy5sYWJlbHMgPSBsYWJlbHM7CiAgICB0aGlzLmNsaWVudElkID0gY2xpZW50SWQ7CiAgICB0aGlzLmNsaWVudFNlY3JldCA9IGNsaWVudFNlY3JldDsKICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKICAgIHRoaXMucHJveHkgPSBwcm94eTsKICAgIHRoaXMuX3BhZ2VJbmZvID0gewogICAgICBwYWdlOiAxLAogICAgICBzdGFydEN1cnNvcjogbnVsbCwKICAgICAgZW5kQ3Vyc29yOiBudWxsLAogICAgICBzb3J0OiBudWxsLAogICAgICBwZXJQYWdlOiBudWxsCiAgICB9OwogICAgdGhpcy5faXNzdWVOb2RlSWQgPSBudWxsOwogICAgdGhpcy4kaHR0cCA9IGF4aW9zLmNyZWF0ZSh7CiAgICAgIGJhc2VVUkw6IGJhc2VVUkwgPT09ICdodHRwczovL2dpdGh1Yi5jb20nID8gJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20nIDogY29uY2F0VVJMKGJhc2VVUkwsICdhcGknKSwKICAgICAgaGVhZGVyczogewogICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMranNvbicKICAgICAgfQogICAgfSk7CiAgICB0aGlzLiRodHRwLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIGlmIChyZXNwb25zZS5kYXRhLmVycm9yKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlLmRhdGEuZXJyb3JfZGVzY3JpcHRpb24pOwogICAgICB9CgogICAgICBpZiAocmVzcG9uc2UuZGF0YS5lcnJvcnMpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UuZGF0YS5lcnJvcnNbMF0ubWVzc2FnZSk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0pOwogIH0KICAvKioKICAgKiBUaGUgcGxhdGZvcm0gYXBpIGluZm8KICAgKi8KCgogIF9jcmVhdGVDbGFzcyhHaXRodWJWNCwgW3sKICAgIGtleTogInBsYXRmb3JtIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6ICdHaXRIdWInLAogICAgICAgIGxpbms6IHRoaXMuYmFzZVVSTCwKICAgICAgICB2ZXJzaW9uOiAndjQnLAogICAgICAgIG1ldGE6IHsKICAgICAgICAgIHJlYWN0YWJsZTogdHJ1ZSwKICAgICAgICAgIHNvcnRhYmxlOiB0cnVlCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBSZWRpcmVjdCB0byB0aGUgYXV0aG9yaXphdGlvbiBwYWdlIG9mIHBsYXRmb3JtLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS9hcHBzL2J1aWxkaW5nLW9hdXRoLWFwcHMvYXV0aG9yaXppbmctb2F1dGgtYXBwcy8jMS1yZXF1ZXN0LWEtdXNlcnMtZ2l0aHViLWlkZW50aXR5CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVkaXJlY3RBdXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWRpcmVjdEF1dGgoKSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYnVpbGRVUkwoY29uY2F0VVJMKHRoaXMuYmFzZVVSTCwgJ2xvZ2luL29hdXRoL2F1dGhvcml6ZScpLCB7CiAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLAogICAgICAgIHJlZGlyZWN0X3VyaTogd2luZG93LmxvY2F0aW9uLmhyZWYsCiAgICAgICAgc2NvcGU6ICdwdWJsaWNfcmVwbycsCiAgICAgICAgc3RhdGU6IHRoaXMuc3RhdGUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIEhhbmRsZSBhdXRob3JpemF0aW9uLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS9hcHBzL2J1aWxkaW5nLW9hdXRoLWFwcHMvYXV0aG9yaXppbmctb2F1dGgtYXBwcy8KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogSWYgdGhlIGBjb2RlYCBhbmQgYHN0YXRlYCBleGlzdCBpbiB0aGUgcXVlcnksIGFuZCB0aGUgYHN0YXRlYCBtYXRjaGVzLCByZW1vdmUgdGhlbSBmcm9tIHF1ZXJ5LCBhbmQgdHJ5IHRvIGdldCB0aGUgYWNjZXNzIHRva2VuLgogICAgICovCgogIH0sIHsKICAgIGtleTogImhhbmRsZUF1dGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9oYW5kbGVBdXRoID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBxdWVyeSwgY29kZSwgcmVwbGFjZVVSTCwgYWNjZXNzVG9rZW47CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcXVlcnkgPSBwYXJzZVF1ZXJ5KHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOwoKICAgICAgICAgICAgICAgIGlmICghcXVlcnkuY29kZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghKHF1ZXJ5LnN0YXRlICE9PSB0aGlzLnN0YXRlKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIGNvZGUgPSBxdWVyeS5jb2RlOwogICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5LmNvZGU7CiAgICAgICAgICAgICAgICBkZWxldGUgcXVlcnkuc3RhdGU7CiAgICAgICAgICAgICAgICByZXBsYWNlVVJMID0gYnVpbGRVUkwoZ2V0Q2xlYW5VUkwod2luZG93LmxvY2F0aW9uLmhyZWYpLCBxdWVyeSkgKyB3aW5kb3cubG9jYXRpb24uaGFzaDsKICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZShudWxsLCAnJywgcmVwbGFjZVVSTCk7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTE7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRBY2Nlc3NUb2tlbih7CiAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgYWNjZXNzVG9rZW4pOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gaGFuZGxlQXV0aCgpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZUF1dGguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGhhbmRsZUF1dGg7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHVzZXIgYWNjZXNzIHRva2VuIHZpYSBgY29kZWAKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzL2F1dGhvcml6aW5nLW9hdXRoLWFwcHMvIzItdXNlcnMtYXJlLXJlZGlyZWN0ZWQtYmFjay10by15b3VyLXNpdGUtYnktZ2l0aHViCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0QWNjZXNzVG9rZW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRBY2Nlc3NUb2tlbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoX3JlZjIpIHsKICAgICAgICB2YXIgY29kZSwgb3JpZ2luYWxVUkwsIHByb3h5VVJMLCBfeWllbGQkdGhpcyQkaHR0cCRwb3MsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb2RlID0gX3JlZjIuY29kZTsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIGFjY2Vzc190b2tlbiBhcGkgZG9lcyBub3Qgc3VwcG9ydCBjb3JzCiAgICAgICAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9pc2FhY3MvZ2l0aHViL2lzc3Vlcy8zMzAKICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgb3JpZ2luYWxVUkwgPSBjb25jYXRVUkwodGhpcy5iYXNlVVJMLCAnbG9naW4vb2F1dGgvYWNjZXNzX3Rva2VuJyk7CiAgICAgICAgICAgICAgICBwcm94eVVSTCA9IHR5cGVvZiB0aGlzLnByb3h5ID09PSAnZnVuY3Rpb24nID8gdGhpcy5wcm94eShvcmlnaW5hbFVSTCkgOiB0aGlzLnByb3h5OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdChwcm94eVVSTCwgewogICAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsCiAgICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQ6IHRoaXMuY2xpZW50U2VjcmV0LAogICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgZGF0YS5hY2Nlc3NfdG9rZW4pOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRBY2Nlc3NUb2tlbihfeCkgewogICAgICAgIHJldHVybiBfZ2V0QWNjZXNzVG9rZW4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldEFjY2Vzc1Rva2VuOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCB0aGUgbG9nZ2VkLWluIHVzZXIgd2l0aCBhY2Nlc3MgdG9rZW4uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L3F1ZXJ5LyB2aWV3ZXIKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9vYmplY3QvdXNlci8KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRVc2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0VXNlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX3JlZjMpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIF95aWVsZCR0aGlzJCRodHRwJHBvczIsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYzLmFjY2Vzc1Rva2VuOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgnZ3JhcGhxbCcsIHsKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJxdWVyeSBnZXRVc2VyIHtcbiAgdmlld2VyIHtcbiAgICBsb2dpblxuICAgIGF2YXRhclVybFxuICAgIHVybFxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMiA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczIuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVVc2VyKGRhdGEuZGF0YS52aWV3ZXIpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0VXNlcihfeDIpIHsKICAgICAgICByZXR1cm4gX2dldFVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldFVzZXI7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IGlzc3VlIG9mIHRoaXMgcGFnZSBhY2NvcmRpbmcgdG8gdGhlIGlzc3VlIGlkIG9yIHRoZSBpc3N1ZSB0aXRsZQogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9vYmplY3QvcmVwb3NpdG9yeS8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9vYmplY3QvaXNzdWVjb25uZWN0aW9uLwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L29iamVjdC9pc3N1ZS8KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogVGhlIElzc3VlQ29ubmVjdGlvbiBkb2VzIG5vdCBoYXZlIHRpdGxlIGZpbHRlciBmb3Igbm93LCBhbmQgdGhlIG51bWJlciBvZiByZXN1bHRzIGlzIGxpbWl0ZWQgdG8gMTAwLgogICAgICogRm9yIG5vdywgaWYgaXNzdWVzIHdpdGggdGhlIGxhYmVscyBhcmUgbW9yZSB0aGFuIDEwMCwgd2UgaGF2ZSB0byByZXF1ZXN0IHRoZSBuZXh0IHBhZ2Uobm90IGltcGxlbWVudGVkIHlldCkuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0SXNzdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRJc3N1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoX3JlZjQpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIGlzc3VlVGl0bGUsIG9wdGlvbnMsIF95aWVsZCR0aGlzJCRodHRwJHBvczMsIGRhdGEsIHF1ZXJ5LCBfeWllbGQkdGhpcyQkaHR0cCRwb3M0LCBfZGF0YSwgaXNzdWU7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY0LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjQuaXNzdWVJZCwgaXNzdWVUaXRsZSA9IF9yZWY0Lmlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFpc3N1ZUlkKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gNDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAicXVlcnkgZ2V0SXNzdWVCeUlkIHtcbiAgcmVwb3NpdG9yeShvd25lcjogXCIiLmNvbmNhdCh0aGlzLm93bmVyLCAiXCIsIG5hbWU6IFwiIikuY29uY2F0KHRoaXMucmVwbywgIlwiKSB7XG4gICAgaXNzdWUgKG51bWJlcjogIikuY29uY2F0KGlzc3VlSWQsICIpIHtcbiAgICAgIGlkXG4gICAgICBudW1iZXJcbiAgICAgIHRpdGxlXG4gICAgICBib2R5XG4gICAgICB1cmxcbiAgICB9XG4gIH1cbn0iKQogICAgICAgICAgICAgICAgfSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLmRhdGE7CiAgICAgICAgICAgICAgICAvLyBwb3N0Q29tbWVudCBuZWVkcyBpc3N1ZSBOb2RlSWQsIHNvIHdlIHN0b3JlIGl0IGludGVybmFsbHkKICAgICAgICAgICAgICAgIHRoaXMuX2lzc3VlTm9kZUlkID0gZGF0YS5kYXRhLnJlcG9zaXRvcnkuaXNzdWUuaWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoZGF0YS5kYXRhLnJlcG9zaXRvcnkuaXNzdWUpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTM7CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oNCk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQ0LnQwLnJlc3BvbnNlICYmIF9jb250ZXh0NC50MC5yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQ0LnQwOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgcXVlcnkgPSBbIlwiIi5jb25jYXQoaXNzdWVUaXRsZSwgIlwiIiksICJpbjp0aXRsZSIsICJyZXBvOiIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbyksICJpczpwdWJsaWMiXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMubGFiZWxzLm1hcChmdW5jdGlvbiAobGFiZWwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICJsYWJlbDoiLmNvbmNhdChsYWJlbCk7CiAgICAgICAgICAgICAgICB9KSkpLmpvaW4oJyAnKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJxdWVyeSBnZXRJc3N1ZUJ5VGl0bGUoXG4gICRxdWVyeTogU3RyaW5nIVxuKSB7XG4gIHNlYXJjaChcbiAgICBxdWVyeTogJHF1ZXJ5XG4gICAgdHlwZTogSVNTVUVcbiAgICBmaXJzdDogMjBcbiAgICApIHtcbiAgICAgIG5vZGVzIHtcbiAgICAgIC4uLiBvbiBJc3N1ZSB7XG4gICAgICAgIGlkXG4gICAgICAgIG51bWJlclxuICAgICAgICB0aXRsZVxuICAgICAgICBib2R5XG4gICAgICAgIHVybFxuICAgICAgfVxuICAgIH1cbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDI1OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNCA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgX2RhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M0LmRhdGE7CiAgICAgICAgICAgICAgICBpc3N1ZSA9IF9kYXRhLmRhdGEuc2VhcmNoLm5vZGVzLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGl0bGUgPT09IGlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICB9KTsgLy8gcG9zdENvbW1lbnQgbmVlZHMgaXNzdWUgTm9kZUlkLCBzbyB3ZSBzdG9yZSBpdCBpbnRlcm5hbGx5CgogICAgICAgICAgICAgICAgaWYgKCFpc3N1ZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDMxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLl9pc3N1ZU5vZGVJZCA9IGlzc3VlLmlkOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGlzc3VlKSk7CgogICAgICAgICAgICAgIGNhc2UgMzE6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMsIFtbNCwgMTNdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldElzc3VlKF94MykgewogICAgICAgIHJldHVybiBfZ2V0SXNzdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldElzc3VlOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpc3N1ZQogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi9jcmVhdGVpc3N1ZS8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9pbnB1dF9vYmplY3QvY3JlYXRlaXNzdWVpbnB1dC8KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogQ3JlYXRpbmcgaXNzdWUgcmVxdWlyZXMgcmVwb3NpdG9yeUlkLCB3aGljaCBzaG91bGQgYmUgcmVxdWVzdGVkIGluIGFuIGV4dHJhIHJlcXVlc3QuCiAgICAgKiBDcmVhdGluZyBpc3N1ZSB3aXRoIGxhYmVscyByZXF1aXJlcyBsYWJlbElkcywgd2hpY2ggc2hvdWxkIGJlIHJlcXVlc3RlZCBpbiBhbiBleHRyYSByZXF1ZXN0LCBvciBjcmVhdGUgdGhlIGxhYmVsIGlmIGl0IGRvZXMgbm90IGV4aXN0LgogICAgICogRW5kcG9pbnRzIGZvciBjcmVhdGluZyBsYWJlbHMgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkIGJ5IEdpdEh1YiB5ZXQgKHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL2NyZWF0ZWxhYmVsLykKICAgICAqCiAgICAgKiBGb3IgdGhlc2UgcmVhc29ucywgZmFsbGJhY2sgdG8gdjMgZm9yIG5vdwogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RJc3N1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RJc3N1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoX3JlZjUpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIHRpdGxlLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3M1LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNS5hY2Nlc3NUb2tlbiwgdGl0bGUgPSBfcmVmNS50aXRsZSwgY29udGVudCA9IF9yZWY1LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzIiksIHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50LAogICAgICAgICAgICAgICAgICBsYWJlbHM6IHRoaXMubGFiZWxzCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M1ID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zNS5kYXRhOwogICAgICAgICAgICAgICAgLy8gYGh0bWxfdXJsYCBpbiB2MwogICAgICAgICAgICAgICAgLy8gYHVybGAgaW4gdjQKICAgICAgICAgICAgICAgIGRhdGEudXJsID0gZGF0YS5odG1sX3VybDsgLy8gcG9zdENvbW1lbnQgbmVlZHMgaXNzdWUgTm9kZUlkLCBzbyB3ZSBzdG9yZSBpdCBpbnRlcm5hbGx5CgogICAgICAgICAgICAgICAgdGhpcy5faXNzdWVOb2RlSWQgPSBkYXRhLm5vZGVfaWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoZGF0YSkpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0SXNzdWUoX3g0KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0SXNzdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RJc3N1ZTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgY29tbWVudHMgb2YgdGhpcyBwYWdlIGFjY29yZGluZyB0byB0aGUgaXNzdWUgaWQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvb2JqZWN0L2lzc3VlY29tbWVudGNvbm5lY3Rpb24vCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIE5vIG9mZnNldCBpbXBsZW1lbnRlZCwgc28gaXQncyBkaWZmaWN1bHQgdG8gaW1wbGVtZW50IFJFU1QtbGlrZSBwYWdpbmF0aW9uCiAgICAgKiBGb3Igbm93LCB3ZSB1c2UgYW4gaW50ZXJuYWwgYF9wYWdlSW5mb2AgdmFyIHRvIGhhY2sgdGhhdAogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbW1lbnRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Q29tbWVudHMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KF9yZWY2KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBfcmVmNiRxdWVyeSwgX3JlZjYkcXVlcnkkcGFnZSwgcGFnZSwgX3JlZjYkcXVlcnkkcGVyUGFnZSwgcGVyUGFnZSwgX3JlZjYkcXVlcnkkc29ydCwgc29ydCwgb3B0aW9ucywgX3RoaXMkX2dldFF1ZXJ5UGFyYW1zLCBmaXJzdE9yTGFzdCwgYWZ0ZXJPckJlZm9yZSwgY3Vyc29yLCBfeWllbGQkdGhpcyQkaHR0cCRwb3M2LCBkYXRhLCBjb21tZW50czsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjYuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNi5pc3N1ZUlkLCBfcmVmNiRxdWVyeSA9IF9yZWY2LnF1ZXJ5OwogICAgICAgICAgICAgICAgX3JlZjYkcXVlcnkgPSBfcmVmNiRxdWVyeSA9PT0gdm9pZCAwID8ge30gOiBfcmVmNiRxdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY2JHF1ZXJ5JHBhZ2UgPSBfcmVmNiRxdWVyeS5wYWdlLCBwYWdlID0gX3JlZjYkcXVlcnkkcGFnZSA9PT0gdm9pZCAwID8gMSA6IF9yZWY2JHF1ZXJ5JHBhZ2UsIF9yZWY2JHF1ZXJ5JHBlclBhZ2UgPSBfcmVmNiRxdWVyeS5wZXJQYWdlLCBwZXJQYWdlID0gX3JlZjYkcXVlcnkkcGVyUGFnZSA9PT0gdm9pZCAwID8gMTAgOiBfcmVmNiRxdWVyeSRwZXJQYWdlLCBfcmVmNiRxdWVyeSRzb3J0ID0gX3JlZjYkcXVlcnkuc29ydCwgc29ydCA9IF9yZWY2JHF1ZXJ5JHNvcnQgPT09IHZvaWQgMCA/ICdkZXNjJyA6IF9yZWY2JHF1ZXJ5JHNvcnQ7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BhZ2VJbmZvLnNvcnQgIT09IG51bGwgJiYgc29ydCAhPT0gdGhpcy5fcGFnZUluZm8uc29ydCkgewogICAgICAgICAgICAgICAgICBwYWdlID0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMgPSB0aGlzLl9nZXRRdWVyeVBhcmFtcyh7CiAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgICAgICAgICAgIHNvcnQ6IHNvcnQKICAgICAgICAgICAgICAgIH0pLCBmaXJzdE9yTGFzdCA9IF90aGlzJF9nZXRRdWVyeVBhcmFtcy5maXJzdE9yTGFzdCwgYWZ0ZXJPckJlZm9yZSA9IF90aGlzJF9nZXRRdWVyeVBhcmFtcy5hZnRlck9yQmVmb3JlLCBjdXJzb3IgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMuY3Vyc29yOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgb3duZXI6IHRoaXMub3duZXIsCiAgICAgICAgICAgICAgICAgICAgcmVwbzogdGhpcy5yZXBvLAogICAgICAgICAgICAgICAgICAgIGlzc3VlSWQ6IGlzc3VlSWQsCiAgICAgICAgICAgICAgICAgICAgcGVyUGFnZTogcGVyUGFnZQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogInF1ZXJ5IGdldENvbW1lbnRzKFxuICAkb3duZXI6IFN0cmluZyFcbiAgJHJlcG86IFN0cmluZyFcbiAgJGlzc3VlSWQ6IEludCFcbiAgJHBlclBhZ2U6IEludCFcbikge1xuICByZXBvc2l0b3J5KG93bmVyOiAkb3duZXIsIG5hbWU6ICRyZXBvKSB7XG4gICAgaXNzdWUobnVtYmVyOiAkaXNzdWVJZCkge1xuICAgICAgY29tbWVudHMoXG4gICAgICAgICIuY29uY2F0KGZpcnN0T3JMYXN0LCAiOiAkcGVyUGFnZVxuICAgICAgICAiKS5jb25jYXQoYWZ0ZXJPckJlZm9yZSA9PT0gbnVsbCA/ICcnIDogIiIuY29uY2F0KGFmdGVyT3JCZWZvcmUsICI6IFwiIikuY29uY2F0KGN1cnNvciwgIlwiIiksICJcbiAgICAgICkge1xuICAgICAgICB0b3RhbENvdW50XG4gICAgICAgIHBhZ2VJbmZvIHtcbiAgICAgICAgICBlbmRDdXJzb3JcbiAgICAgICAgICBzdGFydEN1cnNvclxuICAgICAgICB9XG4gICAgICAgIG5vZGVzIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIGJvZHlcbiAgICAgICAgICBib2R5SFRNTFxuICAgICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICAgIHVwZGF0ZWRBdFxuICAgICAgICAgIGF1dGhvciB7XG4gICAgICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgICAgIGxvZ2luXG4gICAgICAgICAgICB1cmxcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVhY3Rpb25Hcm91cHMge1xuICAgICAgICAgICAgdXNlcnMgKGZpcnN0OiAwKSB7XG4gICAgICAgICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRlbnRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iKQogICAgICAgICAgICAgICAgfSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczYgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M2LmRhdGE7CiAgICAgICAgICAgICAgICBjb21tZW50cyA9IGRhdGEuZGF0YS5yZXBvc2l0b3J5Lmlzc3VlLmNvbW1lbnRzOwoKICAgICAgICAgICAgICAgIGlmIChzb3J0ID09PSAnZGVzYycpIHsKICAgICAgICAgICAgICAgICAgY29tbWVudHMubm9kZXMucmV2ZXJzZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX3BhZ2VJbmZvID0gewogICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLAogICAgICAgICAgICAgICAgICBzdGFydEN1cnNvcjogY29tbWVudHMucGFnZUluZm8uc3RhcnRDdXJzb3IsCiAgICAgICAgICAgICAgICAgIGVuZEN1cnNvcjogY29tbWVudHMucGFnZUluZm8uZW5kQ3Vyc29yLAogICAgICAgICAgICAgICAgICBzb3J0OiBzb3J0LAogICAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgY291bnQ6IGNvbW1lbnRzLnRvdGFsQ291bnQsCiAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnRzLm5vZGVzLm1hcChub3JtYWxpemVDb21tZW50KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50cyhfeDUpIHsKICAgICAgICByZXR1cm4gX2dldENvbW1lbnRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRDb21tZW50czsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi9hZGRjb21tZW50LwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L2lucHV0X29iamVjdC9hZGRjb21tZW50aW5wdXQvCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdENvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wb3N0Q29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoX3JlZjcpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHBvczcsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY3LmFjY2Vzc1Rva2VuLCBjb250ZW50ID0gX3JlZjcuY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIC8vIHBvc3RDb21tZW50IG5lZWRzIGlzc3VlIE5vZGVJZCwgc28gd2Ugc3RvcmUgaXQgaW50ZXJuYWxseQogICAgICAgICAgICAgICAgICAgIGlzc3VlTm9kZUlkOiB0aGlzLl9pc3N1ZU5vZGVJZCwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAibXV0YXRpb24gcG9zdENvbW1lbnQoXG4gICRpc3N1ZU5vZGVJZDogSUQhXG4gICRjb250ZW50OiBTdHJpbmchXG4pIHtcbiAgYWRkQ29tbWVudChcbiAgICBpbnB1dDoge1xuICAgICAgc3ViamVjdElkOiAkaXNzdWVOb2RlSWRcbiAgICAgIGJvZHk6ICRjb250ZW50XG4gICAgfVxuICApIHtcbiAgICBjb21tZW50RWRnZSB7XG4gICAgICBub2RlIHtcbiAgICAgICAgaWRcbiAgICAgICAgYm9keVxuICAgICAgICBib2R5SFRNTFxuICAgICAgICBjcmVhdGVkQXRcbiAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgIGF1dGhvciB7XG4gICAgICAgICAgYXZhdGFyVXJsXG4gICAgICAgICAgbG9naW5cbiAgICAgICAgICB1cmxcbiAgICAgICAgfVxuICAgICAgICByZWFjdGlvbkdyb3VwcyB7XG4gICAgICAgICAgdXNlcnMgKGZpcnN0OiAwKSB7XG4gICAgICAgICAgICB0b3RhbENvdW50XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnRlbnRcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczcgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M3LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhLmRhdGEuYWRkQ29tbWVudC5jb21tZW50RWRnZS5ub2RlKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RDb21tZW50KF94NikgewogICAgICAgIHJldHVybiBfcG9zdENvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEVkaXQgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL3VwZGF0ZWlzc3VlY29tbWVudC8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9pbnB1dF9vYmplY3QvdXBkYXRlaXNzdWVjb21tZW50aW5wdXQvCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicHV0Q29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3B1dENvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KF9yZWY4KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQsIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHBvczgsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY4LmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmOC5jb21tZW50SWQsIGNvbnRlbnQgPSBfcmVmOC5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudElkOiBjb21tZW50SWQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudAogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogIm11dGF0aW9uIHB1dENvbW1lbnQoXG4gICRjb21tZW50SWQ6IElEISxcbiAgJGNvbnRlbnQ6IFN0cmluZyEsXG4pIHtcbiAgdXBkYXRlSXNzdWVDb21tZW50KGlucHV0OiB7XG4gICAgaWQ6ICRjb21tZW50SWRcbiAgICBib2R5OiAkY29udGVudFxuICB9KSB7XG4gICAgaXNzdWVDb21tZW50IHtcbiAgICAgIGlkXG4gICAgICBib2R5XG4gICAgICBib2R5SFRNTFxuICAgICAgY3JlYXRlZEF0XG4gICAgICB1cGRhdGVkQXRcbiAgICAgIGF1dGhvciB7XG4gICAgICAgIGF2YXRhclVybFxuICAgICAgICBsb2dpblxuICAgICAgICB1cmxcbiAgICAgIH1cbiAgICAgIHJlYWN0aW9uR3JvdXBzIHtcbiAgICAgICAgdXNlcnMgKGZpcnN0OiAwKSB7XG4gICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICB9XG4gICAgICAgIGNvbnRlbnRcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M4ID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zOC5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUNvbW1lbnQoZGF0YS5kYXRhLnVwZGF0ZUlzc3VlQ29tbWVudC5pc3N1ZUNvbW1lbnQpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcHV0Q29tbWVudChfeDcpIHsKICAgICAgICByZXR1cm4gX3B1dENvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHB1dENvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogRGVsZXRlIGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi9kZWxldGVpc3N1ZWNvbW1lbnQvCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVsZXRlQ29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2RlbGV0ZUNvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWY5KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjkuYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCA9IF9yZWY5LmNvbW1lbnRJZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudElkCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAibXV0YXRpb24gZGVsZXRlQ29tbWVudChcbiAgJGNvbW1lbnRJZDogSUQhLFxuKSB7XG4gIGRlbGV0ZUlzc3VlQ29tbWVudChpbnB1dDoge1xuICAgIGlkOiAkY29tbWVudElkXG4gIH0pIHtcbiAgICBjbGllbnRNdXRhdGlvbklkXG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQoX3g4KSB7CiAgICAgICAgcmV0dXJuIF9kZWxldGVDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWxldGVDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCByZWFjdGlvbnMgb2YgYSBjb21tZW50CiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIFRoaXMgcXVlcnkgaGFzIG5vdCBiZWVuIGltcGxlbWVudGVkLCB1c2UgdGhlIGNvbW1lbnRzIHF1ZXJ5IGluc3RlYWQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb21tZW50UmVhY3Rpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Q29tbWVudFJlYWN0aW9ucyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKF9yZWYxMCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgaXNzdWVJZCwgY29tbWVudElkLCBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMyLCBmaXJzdE9yTGFzdCwgYWZ0ZXJPckJlZm9yZSwgY3Vyc29yLCBfeWllbGQkdGhpcyQkaHR0cCRwb3M5LCBkYXRhLCBjb21tZW50OwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjEwLmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjEwLmlzc3VlSWQsIGNvbW1lbnRJZCA9IF9yZWYxMC5jb21tZW50SWQ7CiAgICAgICAgICAgICAgICBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMyID0gdGhpcy5fZ2V0UXVlcnlQYXJhbXMoKSwgZmlyc3RPckxhc3QgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMyLmZpcnN0T3JMYXN0LCBhZnRlck9yQmVmb3JlID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zMi5hZnRlck9yQmVmb3JlLCBjdXJzb3IgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMyLmN1cnNvcjsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBvd25lcjogdGhpcy5vd25lciwKICAgICAgICAgICAgICAgICAgICByZXBvOiB0aGlzLnJlcG8sCiAgICAgICAgICAgICAgICAgICAgaXNzdWVJZDogaXNzdWVJZCwKICAgICAgICAgICAgICAgICAgICBwZXJQYWdlOiB0aGlzLl9wYWdlSW5mby5wZXJQYWdlCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAicXVlcnkgZ2V0Q29tbWVudHMoXG4gICRvd25lcjogU3RyaW5nIVxuICAkcmVwbzogU3RyaW5nIVxuICAkaXNzdWVJZDogSW50IVxuICAkcGVyUGFnZTogSW50IVxuKSB7XG4gIHJlcG9zaXRvcnkob3duZXI6ICRvd25lciwgbmFtZTogJHJlcG8pIHtcbiAgICBpc3N1ZShudW1iZXI6ICRpc3N1ZUlkKSB7XG4gICAgICBjb21tZW50cyhcbiAgICAgICAgIi5jb25jYXQoZmlyc3RPckxhc3QsICI6ICRwZXJQYWdlXG4gICAgICAgICIpLmNvbmNhdChhZnRlck9yQmVmb3JlID09PSBudWxsID8gJycgOiAiIi5jb25jYXQoYWZ0ZXJPckJlZm9yZSwgIjogXCIiKS5jb25jYXQoY3Vyc29yLCAiXCIiKSwgIlxuICAgICAgKSB7XG4gICAgICAgIG5vZGVzIHtcbiAgICAgICAgICBpZFxuICAgICAgICAgIHJlYWN0aW9uR3JvdXBzIHtcbiAgICAgICAgICAgIHVzZXJzIChmaXJzdDogMCkge1xuICAgICAgICAgICAgICB0b3RhbENvdW50XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb250ZW50XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59IikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczkgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zOS5kYXRhOwogICAgICAgICAgICAgICAgY29tbWVudCA9IGRhdGEuZGF0YS5yZXBvc2l0b3J5Lmlzc3VlLmNvbW1lbnRzLm5vZGVzLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uaWQgPT09IGNvbW1lbnRJZDsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVSZWFjdGlvbnMoY29tbWVudC5yZWFjdGlvbkdyb3VwcykpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldENvbW1lbnRSZWFjdGlvbnMoX3g5KSB7CiAgICAgICAgcmV0dXJuIF9nZXRDb21tZW50UmVhY3Rpb25zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRDb21tZW50UmVhY3Rpb25zOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyByZWFjdGlvbiBvZiBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vYWRkcmVhY3Rpb24vCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvaW5wdXRfb2JqZWN0L2FkZHJlYWN0aW9uaW5wdXQvCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdENvbW1lbnRSZWFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RDb21tZW50UmVhY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShfcmVmMTEpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgcmVhY3Rpb247CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYxMS5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjExLmNvbW1lbnRJZCwgcmVhY3Rpb24gPSBfcmVmMTEucmVhY3Rpb247CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudElkOiBjb21tZW50SWQsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogbWFwUmVhY3Rpb25OYW1lKHJlYWN0aW9uKQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogIm11dGF0aW9uIHBvc3RDb21tZW50UmVhY3Rpb24oXG4gICRjb21tZW50SWQ6IElEISxcbiAgJGNvbnRlbnQ6IFJlYWN0aW9uQ29udGVudCEsXG4pIHtcbiAgYWRkUmVhY3Rpb24oaW5wdXQ6IHtcbiAgICBzdWJqZWN0SWQ6ICRjb21tZW50SWRcbiAgICBjb250ZW50OiAkY29udGVudFxuICB9KSB7XG4gICAgcmVhY3Rpb24ge1xuICAgICAgZGF0YWJhc2VJZFxuICAgIH1cbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTExLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnRSZWFjdGlvbihfeDEwKSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tbWVudFJlYWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0Q29tbWVudFJlYWN0aW9uOwogICAgfSgpCiAgfSwgewogICAga2V5OiAiX2dldFF1ZXJ5UGFyYW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBfZ2V0UXVlcnlQYXJhbXMoKSB7CiAgICAgIHZhciBfcmVmMTIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9LAogICAgICAgICAgX3JlZjEyJHBhZ2UgPSBfcmVmMTIucGFnZSwKICAgICAgICAgIHBhZ2UgPSBfcmVmMTIkcGFnZSA9PT0gdm9pZCAwID8gdGhpcy5fcGFnZUluZm8ucGFnZSA6IF9yZWYxMiRwYWdlLAogICAgICAgICAgX3JlZjEyJHNvcnQgPSBfcmVmMTIuc29ydCwKICAgICAgICAgIHNvcnQgPSBfcmVmMTIkc29ydCA9PT0gdm9pZCAwID8gdGhpcy5fcGFnZUluZm8uc29ydCA6IF9yZWYxMiRzb3J0OwoKICAgICAgdmFyIGZpcnN0T3JMYXN0OwogICAgICB2YXIgYWZ0ZXJPckJlZm9yZTsKICAgICAgdmFyIGN1cnNvcjsKCiAgICAgIGlmIChwYWdlID09PSAxKSB7CiAgICAgICAgZmlyc3RPckxhc3QgPSBzb3J0ID09PSAnYXNjJyA/ICdmaXJzdCcgOiAnbGFzdCc7CiAgICAgICAgYWZ0ZXJPckJlZm9yZSA9IG51bGw7CiAgICAgICAgY3Vyc29yID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoc29ydCA9PT0gJ2FzYycpIHsKICAgICAgICAgIGlmIChwYWdlID4gdGhpcy5fcGFnZUluZm8ucGFnZSkgewogICAgICAgICAgICBmaXJzdE9yTGFzdCA9ICdmaXJzdCc7CiAgICAgICAgICAgIGFmdGVyT3JCZWZvcmUgPSAnYWZ0ZXInOwogICAgICAgICAgICBjdXJzb3IgPSB0aGlzLl9wYWdlSW5mby5lbmRDdXJzb3I7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaXJzdE9yTGFzdCA9ICdsYXN0JzsKICAgICAgICAgICAgYWZ0ZXJPckJlZm9yZSA9ICdiZWZvcmUnOwogICAgICAgICAgICBjdXJzb3IgPSB0aGlzLl9wYWdlSW5mby5zdGFydEN1cnNvcjsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHBhZ2UgPiB0aGlzLl9wYWdlSW5mby5wYWdlKSB7CiAgICAgICAgICAgIGZpcnN0T3JMYXN0ID0gJ2xhc3QnOwogICAgICAgICAgICBhZnRlck9yQmVmb3JlID0gJ2JlZm9yZSc7CiAgICAgICAgICAgIGN1cnNvciA9IHRoaXMuX3BhZ2VJbmZvLnN0YXJ0Q3Vyc29yOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZmlyc3RPckxhc3QgPSAnZmlyc3QnOwogICAgICAgICAgICBhZnRlck9yQmVmb3JlID0gJ2FmdGVyJzsKICAgICAgICAgICAgY3Vyc29yID0gdGhpcy5fcGFnZUluZm8uZW5kQ3Vyc29yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICBmaXJzdE9yTGFzdDogZmlyc3RPckxhc3QsCiAgICAgICAgYWZ0ZXJPckJlZm9yZTogYWZ0ZXJPckJlZm9yZSwKICAgICAgICBjdXJzb3I6IGN1cnNvcgogICAgICB9OwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEdpdGh1YlY0Owp9KCk7CgpleHBvcnQgeyBHaXRodWJWNCBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * Github GraphQL API v4\n *\n * @see https://developer.github.com/v4/\n * @see https://developer.github.com/v4/explorer/\n * @see https://developer.github.com/apps/building-oauth-apps/\n */\nexport default class GithubV4 {\n    constructor({ baseURL = 'https://github.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for GitHub V4');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this._pageInfo = {\n            page: 1,\n            startCursor: null,\n            endCursor: null,\n            sort: null,\n            perPage: null,\n        };\n        this._issueNodeId = null;\n        this.$http = axios.create({\n            baseURL: baseURL === 'https://github.com'\n                ? 'https://api.github.com'\n                : concatURL(baseURL, 'api'),\n            headers: {\n                Accept: 'application/vnd.github.v3+json',\n            },\n        });\n        this.$http.interceptors.response.use(response => {\n            if (response.data.error) {\n                return Promise.reject(response.data.error_description);\n            }\n            if (response.data.errors) {\n                return Promise.reject(response.data.errors[0].message);\n            }\n            return response;\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitHub',\n            link: this.baseURL,\n            version: 'v4',\n            meta: {\n                reactable: true,\n                sortable: true,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#1-request-a-users-github-identity\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'login/oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'public_repo',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github\n     */\n    async getAccessToken({ code }) {\n        /**\n         * access_token api does not support cors\n         * @see https://github.com/isaacs/github/issues/330\n         */\n        const originalURL = concatURL(this.baseURL, 'login/oauth/access_token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }, {\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://developer.github.com/v4/query/ viewer\n     * @see https://developer.github.com/v4/object/user/\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.post('graphql', {\n            query: `\\\nquery getUser {\n  viewer {\n    login\n    avatarUrl\n    url\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeUser(data.data.viewer);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://developer.github.com/v4/object/repository/\n     * @see https://developer.github.com/v4/object/issueconnection/\n     * @see https://developer.github.com/v4/object/issue/\n     *\n     * @remarks\n     * The IssueConnection does not have title filter for now, and the number of results is limited to 100.\n     * For now, if issues with the labels are more than 100, we have to request the next page(not implemented yet).\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                const { data } = await this.$http.post(`graphql`, {\n                    query: `\\\nquery getIssueById {\n  repository(owner: \"${this.owner}\", name: \"${this.repo}\") {\n    issue (number: ${issueId}) {\n      id\n      number\n      title\n      body\n      url\n    }\n  }\n}`,\n                }, options);\n                // postComment needs issue NodeId, so we store it internally\n                this._issueNodeId = data.data.repository.issue.id;\n                return normalizeIssue(data.data.repository.issue);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            const query = [\n                `\"${issueTitle}\"`,\n                `in:title`,\n                `repo:${this.owner}/${this.repo}`,\n                `is:public`,\n                ...this.labels.map(label => `label:${label}`),\n            ].join(' ');\n            const { data } = await this.$http.post(`graphql`, {\n                variables: {\n                    query,\n                },\n                query: `\\\nquery getIssueByTitle(\n  $query: String!\n) {\n  search(\n    query: $query\n    type: ISSUE\n    first: 20\n    ) {\n      nodes {\n      ... on Issue {\n        id\n        number\n        title\n        body\n        url\n      }\n    }\n  }\n}`,\n            }, options);\n            const issue = data.data.search.nodes.find(item => item.title === issueTitle);\n            // postComment needs issue NodeId, so we store it internally\n            if (issue) {\n                this._issueNodeId = issue.id;\n                return normalizeIssue(issue);\n            }\n            return null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://developer.github.com/v4/mutation/createissue/\n     * @see https://developer.github.com/v4/input_object/createissueinput/\n     *\n     * @remarks\n     * Creating issue requires repositoryId, which should be requested in an extra request.\n     * Creating issue with labels requires labelIds, which should be requested in an extra request, or create the label if it does not exist.\n     * Endpoints for creating labels has not been implemented by GitHub yet (see https://developer.github.com/v4/mutation/createlabel/)\n     *\n     * For these reasons, fallback to v3 for now\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues`, {\n            title,\n            body: content,\n            labels: this.labels,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        // `html_url` in v3\n        // `url` in v4\n        data.url = data.html_url;\n        // postComment needs issue NodeId, so we store it internally\n        this._issueNodeId = data.node_id;\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://developer.github.com/v4/object/issuecommentconnection/\n     *\n     * @remarks\n     * No offset implemented, so it's difficult to implement REST-like pagination\n     * For now, we use an internal `_pageInfo` var to hack that\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10, sort = 'desc' } = {}, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (this._pageInfo.sort !== null && sort !== this._pageInfo.sort) {\n            page = 1;\n        }\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams({\n            page,\n            sort,\n        });\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        totalCount\n        pageInfo {\n          endCursor\n          startCursor\n        }\n        nodes {\n          id\n          body\n          bodyHTML\n          createdAt\n          updatedAt\n          author {\n            avatarUrl\n            login\n            url\n          }\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, options);\n        const comments = data.data.repository.issue.comments;\n        if (sort === 'desc') {\n            comments.nodes.reverse();\n        }\n        this._pageInfo = {\n            page,\n            startCursor: comments.pageInfo.startCursor,\n            endCursor: comments.pageInfo.endCursor,\n            sort,\n            perPage,\n        };\n        return {\n            count: comments.totalCount,\n            page: page,\n            perPage: perPage,\n            data: comments.nodes.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://developer.github.com/v4/mutation/addcomment/\n     * @see https://developer.github.com/v4/input_object/addcommentinput/\n     */\n    async postComment({ accessToken, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                // postComment needs issue NodeId, so we store it internally\n                issueNodeId: this._issueNodeId,\n                content,\n            },\n            query: `\\\nmutation postComment(\n  $issueNodeId: ID!\n  $content: String!\n) {\n  addComment(\n    input: {\n      subjectId: $issueNodeId\n      body: $content\n    }\n  ) {\n    commentEdge {\n      node {\n        id\n        body\n        bodyHTML\n        createdAt\n        updatedAt\n        author {\n          avatarUrl\n          login\n          url\n        }\n        reactionGroups {\n          users (first: 0) {\n            totalCount\n          }\n          content\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.addComment.commentEdge.node);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://developer.github.com/v4/mutation/updateissuecomment/\n     * @see https://developer.github.com/v4/input_object/updateissuecommentinput/\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content,\n            },\n            query: `\\\nmutation putComment(\n  $commentId: ID!,\n  $content: String!,\n) {\n  updateIssueComment(input: {\n    id: $commentId\n    body: $content\n  }) {\n    issueComment {\n      id\n      body\n      bodyHTML\n      createdAt\n      updatedAt\n      author {\n        avatarUrl\n        login\n        url\n      }\n      reactionGroups {\n        users (first: 0) {\n          totalCount\n        }\n        content\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.updateIssueComment.issueComment);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v4/mutation/deleteissuecomment/\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n            },\n            query: `\\\nmutation deleteComment(\n  $commentId: ID!,\n) {\n  deleteIssueComment(input: {\n    id: $commentId\n  }) {\n    clientMutationId\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return true;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @remarks\n     * This query has not been implemented, use the comments query instead\n     */\n    async getCommentReactions({ accessToken, issueId, commentId, }) {\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams();\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage: this._pageInfo.perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        nodes {\n          id\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        const comment = data.data.repository.issue.comments.nodes.find(item => item.id === commentId);\n        return normalizeReactions(comment.reactionGroups);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://developer.github.com/v4/mutation/addreaction/\n     * @see https://developer.github.com/v4/input_object/addreactioninput/\n     */\n    async postCommentReaction({ accessToken, commentId, reaction, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content: mapReactionName(reaction),\n            },\n            query: `\\\nmutation postCommentReaction(\n  $commentId: ID!,\n  $content: ReactionContent!,\n) {\n  addReaction(input: {\n    subjectId: $commentId\n    content: $content\n  }) {\n    reaction {\n      databaseId\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return true;\n    }\n    _getQueryParams({ page = this._pageInfo.page, sort = this._pageInfo.sort, } = {}) {\n        let firstOrLast;\n        let afterOrBefore;\n        let cursor;\n        if (page === 1) {\n            firstOrLast = sort === 'asc' ? 'first' : 'last';\n            afterOrBefore = null;\n            cursor = null;\n        }\n        else {\n            if (sort === 'asc') {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n                else {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n            }\n            else {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n                else {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n            }\n        }\n        return {\n            firstOrLast,\n            afterOrBefore,\n            cursor,\n        };\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}